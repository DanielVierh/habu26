(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const ce of document.querySelectorAll('link[rel="modulepreload"]'))G(ce);new MutationObserver(ce=>{for(const re of ce)if(re.type==="childList")for(const me of re.addedNodes)me.tagName==="LINK"&&me.rel==="modulepreload"&&G(me)}).observe(document,{childList:!0,subtree:!0});function Se(ce){const re={};return ce.integrity&&(re.integrity=ce.integrity),ce.referrerPolicy&&(re.referrerPolicy=ce.referrerPolicy),ce.crossOrigin==="use-credentials"?re.credentials="include":ce.crossOrigin==="anonymous"?re.credentials="omit":re.credentials="same-origin",re}function G(ce){if(ce.ep)return;ce.ep=!0;const re=Se(ce);fetch(ce.href,re)}})();const ka=[1,2,3,4,5,6,7,8,9,10,11,12];function fa(){return new Date().toISOString()}function Rt(P){const g=Math.random().toString(36).slice(2,10);return`${P}_${Date.now()}_${g}`}function $a(P,g){const Se=new Date(P,g,0).getDate(),G=[];for(let ce=1;ce<=Se;ce+=1){const re=new Date(Date.UTC(P,g-1,ce));G.push({isoDate:re.toISOString().slice(0,10),foodCents:0,goingOutCents:0})}return G}function _a(P){return P.map(g=>({id:Rt("fixed"),templateId:g.id,name:g.name,plannedCents:g.plannedCents,actualCents:0}))}function ha(P,g,Se){const G=g.reduce((re,me)=>re+me.plannedCents,0),ce=ka.map(re=>({month:re,days:$a(P,re),foodBudgetCents:0,goingOutBudgetCents:0,incomes:[],fixedCosts:_a(g),fixedBudgetCents:G,variableCosts:[],variablePositions:[],variableBudgetCents:0,miscBudgetCents:0,miscCosts:[]}));return{year:P,createdAt:fa(),templateVersion:Se,months:ce}}function pa(P,g){return{id:Rt("expense"),description:P,amountCents:g,createdAt:fa()}}function va(P,g,Se){const G={id:Rt("income"),description:P,amountCents:g,createdAt:fa()};return Se?{...G,incomeSource:Se}:G}var Ea=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Sa(P){return P&&P.__esModule&&Object.prototype.hasOwnProperty.call(P,"default")?P.default:P}var Ur={exports:{}},Ba=Ur.exports,ma;function Pa(){return ma||(ma=1,(function(P,g){((Se,G)=>{P.exports=G()})(Ba,function(){var Se=function(e,t){return(Se=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(n,r){n.__proto__=r}:function(n,r){for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(n[a]=r[a])}))(e,t)},G=function(){return(G=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function ce(e,t,n){for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||((r=r||Array.prototype.slice.call(t,0,a))[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}var re=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:Ea,me=Object.keys,ae=Array.isArray;function de(e,t){return typeof t=="object"&&me(t).forEach(function(n){e[n]=t[n]}),e}typeof Promise>"u"||re.Promise||(re.Promise=Promise);var He=Object.getPrototypeOf,Xe={}.hasOwnProperty;function ie(e,t){return Xe.call(e,t)}function Qe(e,t){typeof t=="function"&&(t=t(He(e))),(typeof Reflect>"u"?me:Reflect.ownKeys)(t).forEach(function(n){vt(e,n,t[n])})}var Ze=Object.defineProperty;function vt(e,t,n,r){Ze(e,t,de(n&&ie(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function kt(e){return{from:function(t){return e.prototype=Object.create(t.prototype),vt(e.prototype,"constructor",e),{extend:Qe.bind(null,e.prototype)}}}}var Wr=Object.getOwnPropertyDescriptor,rr=[].slice;function Kn(e,t,n){return rr.call(e,t,n)}function _r(e,t){return t(e)}function dn(e){if(!e)throw new Error("Assertion Failed")}function Er(e){re.setImmediate?setImmediate(e):setTimeout(e,0)}function $t(e,t){if(typeof t=="string"&&ie(e,t))return e[t];if(!t)return e;if(typeof t!="string"){for(var n=[],r=0,a=t.length;r<a;++r){var s=$t(e,t[r]);n.push(s)}return n}var i,u=t.indexOf(".");return u===-1||(i=e[t.substr(0,u)])==null?void 0:$t(i,t.substr(u+1))}function st(e,t,n){if(e&&t!==void 0&&!("isFrozen"in Object&&Object.isFrozen(e)))if(typeof t!="string"&&"length"in t){dn(typeof n!="string"&&"length"in n);for(var r=0,a=t.length;r<a;++r)st(e,t[r],n[r])}else{var s,i,u=t.indexOf(".");u!==-1?(s=t.substr(0,u),(u=t.substr(u+1))===""?n===void 0?ae(e)&&!isNaN(parseInt(s))?e.splice(s,1):delete e[s]:e[s]=n:st(i=(i=e[s])&&ie(e,s)?i:e[s]={},u,n)):n===void 0?ae(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=n}}function Tt(e){var t,n={};for(t in e)ie(e,t)&&(n[t]=e[t]);return n}var Sr=[].concat;function ut(e){return Sr.apply([],e)}var Et="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(ut([8,16,32,64].map(function(e){return["Int","Uint","Float"].map(function(t){return t+e+"Array"})}))).filter(function(e){return re[e]}),xe=new Set(Et.map(function(e){return re[e]})),Yt=null;function en(e){return Yt=new WeakMap,e=(function t(n){if(!n||typeof n!="object")return n;var r=Yt.get(n);if(r)return r;if(ae(n)){r=[],Yt.set(n,r);for(var a=0,s=n.length;a<s;++a)r.push(t(n[a]))}else if(xe.has(n.constructor))r=n;else{var i,u=He(n);for(i in r=u===Object.prototype?{}:Object.create(u),Yt.set(n,r),n)ie(n,i)&&(r[i]=t(n[i]))}return r})(e),Yt=null,e}var Br={}.toString;function ar(e){return Br.call(e).slice(8,-1)}var qn=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Jr=typeof qn=="symbol"?function(e){var t;return e!=null&&(t=e[qn])&&t.apply(e)}:function(){return null};function Vt(e,t){t=e.indexOf(t),0<=t&&e.splice(t,1)}var fn={};function _t(e){var t,n,r,a;if(arguments.length===1){if(ae(e))return e.slice();if(this===fn&&typeof e=="string")return[e];if(a=Jr(e))for(n=[];!(r=a.next()).done;)n.push(r.value);else{if(e==null)return[e];if(typeof(t=e.length)!="number")return[e];for(n=new Array(t);t--;)n[t]=e[t]}}else for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var sr=typeof Symbol<"u"?function(e){return e[Symbol.toStringTag]==="AsyncFunction"}:function(){return!1},Et=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Ve=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Et),Hr={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function hn(e,t){this.name=e,this.message=t}function Pr(e,t){return e+". Errors: "+Object.keys(t).map(function(n){return t[n].toString()}).filter(function(n,r,a){return a.indexOf(n)===r}).join(`
`)}function xn(e,t,n,r){this.failures=t,this.failedKeys=r,this.successCount=n,this.message=Pr(e,t)}function pn(e,t){this.name="BulkError",this.failures=Object.keys(t).map(function(n){return t[n]}),this.failuresByPos=t,this.message=Pr(e,this.failures)}kt(hn).from(Error).extend({toString:function(){return this.name+": "+this.message}}),kt(xn).from(hn),kt(pn).from(hn);var ir=Ve.reduce(function(e,t){return e[t]=t+"Error",e},{}),or=hn,H=Ve.reduce(function(e,t){var n=t+"Error";function r(a,s){this.name=n,a?typeof a=="string"?(this.message="".concat(a).concat(s?`
 `+s:""),this.inner=s||null):typeof a=="object"&&(this.message="".concat(a.name," ").concat(a.message),this.inner=a):(this.message=Hr[t]||n,this.inner=null)}return kt(r).from(or),e[t]=r,e},{}),kn=(H.Syntax=SyntaxError,H.Type=TypeError,H.Range=RangeError,Et.reduce(function(e,t){return e[t+"Error"]=H[t],e},{}));Et=Ve.reduce(function(e,t){return["Syntax","Type","Range"].indexOf(t)===-1&&(e[t+"Error"]=H[t]),e},{});function ge(){}function zt(e){return e}function Ke(e,t){return e==null||e===zt?t:function(n){return t(e(n))}}function St(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Ln(e,t){return e===ge?t:function(){var n=e.apply(this,arguments),r=(n!==void 0&&(arguments[0]=n),this.onsuccess),a=this.onerror,s=(this.onsuccess=null,this.onerror=null,t.apply(this,arguments));return r&&(this.onsuccess=this.onsuccess?St(r,this.onsuccess):r),a&&(this.onerror=this.onerror?St(a,this.onerror):a),s!==void 0?s:n}}function jn(e,t){return e===ge?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?St(n,this.onsuccess):n),r&&(this.onerror=this.onerror?St(r,this.onerror):r)}}function Xr(e,t){return e===ge?t:function(a){var r=e.apply(this,arguments),a=(de(a,r),this.onsuccess),s=this.onerror,i=(this.onsuccess=null,this.onerror=null,t.apply(this,arguments));return a&&(this.onsuccess=this.onsuccess?St(a,this.onsuccess):a),s&&(this.onerror=this.onerror?St(s,this.onerror):s),r===void 0?i===void 0?void 0:i:de(r,i)}}function lr(e,t){return e===ge?t:function(){return t.apply(this,arguments)!==!1&&e.apply(this,arguments)}}function $n(e,t){return e===ge?t:function(){var n=e.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,a=arguments.length,s=new Array(a);a--;)s[a]=arguments[a];return n.then(function(){return t.apply(r,s)})}return t.apply(this,arguments)}}Et.ModifyError=xn,Et.DexieError=hn,Et.BulkError=pn;var mt=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Or(e){mt=e}var et={},vn=100,_n=typeof Promise>"u"?[]:(Ve=Promise.resolve(),typeof crypto<"u"&&crypto.subtle?[_n=crypto.subtle.digest("SHA-512",new Uint8Array([0])),He(_n),Ve]:[Ve,He(Ve),Ve]),Ve=_n[0],Lt=_n[1],Lt=Lt&&Lt.then,tn=Ve&&Ve.constructor,Rn=!!_n[2],Be=function(e,t){En.push([e,t]),ue&&(queueMicrotask(Zr),ue=!1)},Ct=!0,ue=!0,gt=[],Bt=[],ur=zt,Dt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ge,pgp:!1,env:{},finalize:ge},J=Dt,En=[],nn=0,Yn=[];function R(e){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this._lib=!1;var t=this._PSD=J;if(typeof e!="function"){if(e!==et)throw new TypeError("Not a function");this._state=arguments[1],this._value=arguments[2],this._state===!1&&Vn(this,this._value)}else this._state=null,this._value=null,++t.ref,(function n(r,a){try{a(function(s){if(r._state===null){if(s===r)throw new TypeError("A promise cannot be resolved with itself.");var i=r._lib&&mn();s&&typeof s.then=="function"?n(r,function(u,h){s instanceof R?s._then(u,h):s.then(u,h)}):(r._state=!0,r._value=s,Ar(r)),i&&gn()}},Vn.bind(null,r))}catch(s){Vn(r,s)}})(this,e)}var cr={get:function(){var e=J,t=Gn;function n(r,a){var s=this,i=!e.global&&(e!==J||t!==Gn),u=i&&!Gt(),h=new R(function(x,p){dr(s,new Mr(se(r,e,i,u),se(a,e,i,u),x,p,e))});return this._consoleTask&&(h._consoleTask=this._consoleTask),h}return n.prototype=et,n},set:function(e){vt(this,"then",e&&e.prototype===et?cr:{get:function(){return e},set:cr.set})}};function Mr(e,t,n,r,a){this.onFulfilled=typeof e=="function"?e:null,this.onRejected=typeof t=="function"?t:null,this.resolve=n,this.reject=r,this.psd=a}function Vn(e,t){var n,r;Bt.push(t),e._state===null&&(n=e._lib&&mn(),t=ur(t),e._state=!1,e._value=t,r=e,gt.some(function(a){return a._value===r._value})||gt.push(r),Ar(e),n)&&gn()}function Ar(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)dr(e,t[n]);var a=e._PSD;--a.ref||a.finalize(),nn===0&&(++nn,Be(function(){--nn==0&&fr()},[]))}function dr(e,t){if(e._state===null)e._listeners.push(t);else{var n=e._state?t.onFulfilled:t.onRejected;if(n===null)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++nn,Be(Qr,[n,e,t])}}function Qr(e,t,n){try{var r,a=t._value;!t._state&&Bt.length&&(Bt=[]),r=mt&&t._consoleTask?t._consoleTask.run(function(){return e(a)}):e(a),t._state||Bt.indexOf(a)!==-1||(s=>{for(var i=gt.length;i;)if(gt[--i]._value===s._value)return gt.splice(i,1)})(t),n.resolve(r)}catch(s){n.reject(s)}finally{--nn==0&&fr(),--n.psd.ref||n.psd.finalize()}}function Zr(){an(Dt,function(){mn()&&gn()})}function mn(){var e=Ct;return ue=Ct=!1,e}function gn(){var e,t,n;do for(;0<En.length;)for(e=En,En=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}while(0<En.length);ue=Ct=!0}function fr(){for(var e=gt,t=(gt=[],e.forEach(function(r){r._PSD.onunhandled.call(null,r._value,r)}),Yn.slice(0)),n=t.length;n;)t[--n]()}function zn(e){return new R(et,!1,e)}function we(e,t){var n=J;return function(){var r=mn(),a=J;try{return Wt(n,!0),e.apply(this,arguments)}catch(s){t&&t(s)}finally{Wt(a,!1),r&&gn()}}}Qe(R.prototype,{then:cr,_then:function(e,t){dr(this,new Mr(null,null,e,t,J))},catch:function(e){var t,n;return arguments.length===1?this.then(null,e):(t=e,n=arguments[1],typeof t=="function"?this.then(null,function(r){return(r instanceof t?n:zn)(r)}):this.then(null,function(r){return(r&&r.name===t?n:zn)(r)}))},finally:function(e){return this.then(function(t){return R.resolve(e()).then(function(){return t})},function(t){return R.resolve(e()).then(function(){return zn(t)})})},timeout:function(e,t){var n=this;return e<1/0?new R(function(r,a){var s=setTimeout(function(){return a(new H.Timeout(t))},e);n.then(r,a).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&vt(R.prototype,Symbol.toStringTag,"Dexie.Promise"),Dt.env=Dr(),Qe(R,{all:function(){var e=_t.apply(null,arguments).map(Bn);return new R(function(t,n){e.length===0&&t([]);var r=e.length;e.forEach(function(a,s){return R.resolve(a).then(function(i){e[s]=i,--r||t(e)},n)})})},resolve:function(e){return e instanceof R?e:e&&typeof e.then=="function"?new R(function(t,n){e.then(t,n)}):new R(et,!0,e)},reject:zn,race:function(){var e=_t.apply(null,arguments).map(Bn);return new R(function(t,n){e.map(function(r){return R.resolve(r).then(t,n)})})},PSD:{get:function(){return J},set:function(e){return J=e}},totalEchoes:{get:function(){return Gn}},newPSD:Ut,usePSD:an,scheduler:{get:function(){return Be},set:function(e){Be=e}},rejectionMapper:{get:function(){return ur},set:function(e){ur=e}},follow:function(e,t){return new R(function(n,r){return Ut(function(a,s){var i=J;i.unhandleds=[],i.onunhandled=s,i.finalize=St(function(){var u,h=this;u=function(){h.unhandleds.length===0?a():s(h.unhandleds[0])},Yn.push(function x(){u(),Yn.splice(Yn.indexOf(x),1)}),++nn,Be(function(){--nn==0&&fr()},[])},i.finalize),e()},t,n,r)})}}),tn&&(tn.allSettled&&vt(R,"allSettled",function(){var e=_t.apply(null,arguments).map(Bn);return new R(function(t){e.length===0&&t([]);var n=e.length,r=new Array(n);e.forEach(function(a,s){return R.resolve(a).then(function(i){return r[s]={status:"fulfilled",value:i}},function(i){return r[s]={status:"rejected",reason:i}}).then(function(){return--n||t(r)})})})}),tn.any&&typeof AggregateError<"u"&&vt(R,"any",function(){var e=_t.apply(null,arguments).map(Bn);return new R(function(t,n){e.length===0&&n(new AggregateError([]));var r=e.length,a=new Array(r);e.forEach(function(s,i){return R.resolve(s).then(function(u){return t(u)},function(u){a[i]=u,--r||n(new AggregateError(a))})})})}),tn.withResolvers)&&(R.withResolvers=tn.withResolvers);var _e={awaits:0,echoes:0,id:0},Tr=0,Sn=[],Un=0,Gn=0,ea=0;function Ut(e,i,n,r){var a=J,s=Object.create(a),i=(s.parent=a,s.ref=0,s.global=!1,s.id=++ea,Dt.env,s.env=Rn?{Promise:R,PromiseProp:{value:R,configurable:!0,writable:!0},all:R.all,race:R.race,allSettled:R.allSettled,any:R.any,resolve:R.resolve,reject:R.reject}:{},i&&de(s,i),++a.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()},an(s,e,n,r));return s.ref===0&&s.finalize(),i}function rn(){return _e.id||(_e.id=++Tr),++_e.awaits,_e.echoes+=vn,_e.id}function Gt(){return!!_e.awaits&&(--_e.awaits==0&&(_e.id=0),_e.echoes=_e.awaits*vn,!0)}function Bn(e){return _e.echoes&&e&&e.constructor===tn?(rn(),e.then(function(t){return Gt(),t},function(t){return Gt(),l(t)})):e}function ta(){var e=Sn[Sn.length-1];Sn.pop(),Wt(e,!1)}function Wt(e,t){var n,r,a=J;(t?!_e.echoes||Un++&&e===J:!Un||--Un&&e===J)||queueMicrotask(t?(function(s){++Gn,_e.echoes&&--_e.echoes!=0||(_e.echoes=_e.awaits=_e.id=0),Sn.push(J),Wt(s,!0)}).bind(null,e):ta),e!==J&&(J=e,a===Dt&&(Dt.env=Dr()),Rn)&&(n=Dt.env.Promise,r=e.env,a.global||e.global)&&(Object.defineProperty(re,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any)&&(n.any=r.any)}function Dr(){var e=re.Promise;return Rn?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(re,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject}:{}}function an(e,t,n,r,a){var s=J;try{return Wt(e,!0),t(n,r,a)}finally{Wt(s,!1)}}function se(e,t,n,r){return typeof e!="function"?e:function(){var a=J;n&&rn(),Wt(t,!0);try{return e.apply(this,arguments)}finally{Wt(a,!1),r&&queueMicrotask(Gt)}}}function hr(e){Promise===tn&&_e.echoes===0?Un===0?e():enqueueNativeMicroTask(e):setTimeout(e,0)}(""+Lt).indexOf("[native code]")===-1&&(rn=Gt=ge);var l=R.reject,c="ï¿¿",b="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",y="String expected.",w=[],T="__dbnames",L="readonly",j="readwrite";function F(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var X={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function U(e){return typeof e!="string"||/\./.test(e)?function(t){return t}:function(t){return t[e]===void 0&&e in t&&delete(t=en(t))[e],t}}function Z(){throw H.Type("Entity instances must never be new:ed. Instances are generated by the framework bypassing the constructor.")}function W(e,t){try{var n=Pe(e),r=Pe(t);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t<e?1:e<t?-1:0;case"binary":for(var a=tt(e),s=tt(t),i=a.length,u=s.length,h=i<u?i:u,x=0;x<h;++x)if(a[x]!==s[x])return a[x]<s[x]?-1:1;return i===u?0:i<u?-1:1;case"Array":for(var p=e,d=t,f=p.length,C=d.length,m=f<C?f:C,v=0;v<m;++v){var $=W(p[v],d[v]);if($!==0)return $}return f===C?0:f<C?-1:1}}catch{}return NaN}function Pe(e){var t=typeof e;return t=="object"&&(ArrayBuffer.isView(e)||(t=ar(e))==="ArrayBuffer")?"binary":t}function tt(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}function Fe(e,t,n){var r=e.schema.yProps;return r?(t&&0<n.numFailures&&(t=t.filter(function(a,s){return!n.failures[s]})),Promise.all(r.map(function(a){return a=a.updatesTable,t?e.db.table(a).where("k").anyOf(t).delete():e.db.table(a).clear()})).then(function(){return n})):n}bt.prototype.execute=function(e){var t=this["@@propmod"];if(t.add!==void 0){var n=t.add;if(ae(n))return ce(ce([],ae(e)?e:[],!0),n).sort();if(typeof n=="number")return(Number(e)||0)+n;if(typeof n=="bigint")try{return BigInt(e)+n}catch{return BigInt(0)+n}throw new TypeError("Invalid term ".concat(n))}if(t.remove!==void 0){var r=t.remove;if(ae(r))return ae(e)?e.filter(function(a){return!r.includes(a)}).sort():[];if(typeof r=="number")return Number(e)-r;if(typeof r=="bigint")try{return BigInt(e)-r}catch{return BigInt(0)-r}throw new TypeError("Invalid subtrahend ".concat(r))}return n=(n=t.replacePrefix)==null?void 0:n[0],n&&typeof e=="string"&&e.startsWith(n)?t.replacePrefix[1]+e.substring(n.length):e};var fe=bt;function bt(e){this["@@propmod"]=e}function Ne(e,t){for(var n=me(t),r=n.length,a=!1,s=0;s<r;++s){var i=n[s],u=t[i],h=$t(e,i);u instanceof fe?(st(e,i,u.execute(h)),a=!0):h!==u&&(st(e,i,u),a=!0)}return a}le.prototype._trans=function(e,t,n){var r=this._tx||J.trans,a=this.name,s=mt&&typeof console<"u"&&console.createTask&&console.createTask("Dexie: ".concat(e==="readonly"?"read":"write"," ").concat(this.name));function i(x,p,d){if(d.schema[a])return t(d.idbtrans,d);throw new H.NotFound("Table "+a+" not part of transaction")}var u=mn();try{var h=r&&r.db._novip===this.db._novip?r===J.trans?r._promise(e,i,n):Ut(function(){return r._promise(e,i,n)},{trans:r,transless:J.transless||J}):(function x(p,d,f,C){if(p.idbdb&&(p._state.openComplete||J.letThrough||p._vip)){var m=p._createTransaction(d,f,p._dbSchema);try{m.create(),p._state.PR1398_maxLoop=3}catch(v){return v.name===ir.InvalidState&&p.isOpen()&&0<--p._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),p.close({disableAutoOpen:!1}),p.open().then(function(){return x(p,d,f,C)})):l(v)}return m._promise(d,function(v,$){return Ut(function(){return J.trans=m,C(v,$,m)})}).then(function(v){if(d==="readwrite")try{m.idbtrans.commit()}catch{}return d==="readonly"?v:m._completion.then(function(){return v})})}if(p._state.openComplete)return l(new H.DatabaseClosed(p._state.dbOpenError));if(!p._state.isBeingOpened){if(!p._state.autoOpen)return l(new H.DatabaseClosed);p.open().catch(ge)}return p._state.dbReadyPromise.then(function(){return x(p,d,f,C)})})(this.db,e,[this.name],i);return s&&(h._consoleTask=s,h=h.catch(function(x){return console.trace(x),l(x)})),h}finally{u&&gn()}},le.prototype.get=function(e,t){var n=this;return e&&e.constructor===Object?this.where(e).first(t):e==null?l(new H.Type("Invalid argument to Table.get()")):this._trans("readonly",function(r){return n.core.get({trans:r,key:e}).then(function(a){return n.hook.reading.fire(a)})}).then(t)},le.prototype.where=function(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(ae(e))return new this.db.WhereClause(this,"[".concat(e.join("+"),"]"));var t=me(e);if(t.length===1)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter(function(u){if(u.compound&&t.every(function(x){return 0<=u.keyPath.indexOf(x)})){for(var h=0;h<t.length;++h)if(t.indexOf(u.keyPath[h])===-1)return!1;return!0}return!1}).sort(function(u,h){return u.keyPath.length-h.keyPath.length})[0];if(n&&this.db._maxKey!==c)return i=n.keyPath.slice(0,t.length),this.where(i).equals(i.map(function(u){return e[u]}));!n&&mt&&console.warn("The query ".concat(JSON.stringify(e)," on ").concat(this.name," would benefit from a ")+"compound index [".concat(t.join("+"),"]"));var r=this.schema.idxByName;function a(u,h){return W(u,h)===0}var i=t.reduce(function(p,h){var x=p[0],p=p[1],d=r[h],f=e[h];return[x||d,x||!d?F(p,d&&d.multi?function(C){return C=$t(C,h),ae(C)&&C.some(function(m){return a(f,m)})}:function(C){return a(f,$t(C,h))}):p]},[null,null]),s=i[0],i=i[1];return s?this.where(s.name).equals(e[s.keyPath]).filter(i):n?this.filter(i):this.where(t).equals("")},le.prototype.filter=function(e){return this.toCollection().and(e)},le.prototype.count=function(e){return this.toCollection().count(e)},le.prototype.offset=function(e){return this.toCollection().offset(e)},le.prototype.limit=function(e){return this.toCollection().limit(e)},le.prototype.each=function(e){return this.toCollection().each(e)},le.prototype.toArray=function(e){return this.toCollection().toArray(e)},le.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},le.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,ae(e)?"[".concat(e.join("+"),"]"):e))},le.prototype.reverse=function(){return this.toCollection().reverse()},le.prototype.mapToClass=function(e){for(var t=this.db,n=this.name,r=((this.schema.mappedClass=e).prototype instanceof Z&&(e=(i=>{var u=p,h=i;if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");function x(){this.constructor=u}function p(){return i!==null&&i.apply(this,arguments)||this}return Se(u,h),u.prototype=h===null?Object.create(h):(x.prototype=h.prototype,new x),Object.defineProperty(p.prototype,"db",{get:function(){return t},enumerable:!1,configurable:!0}),p.prototype.table=function(){return n},p})(e)),new Set),a=e.prototype;a;a=He(a))Object.getOwnPropertyNames(a).forEach(function(i){return r.add(i)});function s(i){if(!i)return i;var u,h=Object.create(e.prototype);for(u in i)if(!r.has(u))try{h[u]=i[u]}catch{}return h}return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=s,this.hook("reading",s),e},le.prototype.defineClass=function(){return this.mapToClass(function(e){de(this,e)})},le.prototype.add=function(e,t){var n=this,r=this.schema.primKey,a=r.auto,s=r.keyPath,i=e;return s&&a&&(i=U(s)(e)),this._trans("readwrite",function(u){return n.core.mutate({trans:u,type:"add",keys:t!=null?[t]:null,values:[i]})}).then(function(u){return u.numFailures?R.reject(u.failures[0]):u.lastResult}).then(function(u){if(s)try{st(e,s,u)}catch{}return u})},le.prototype.upsert=function(e,t){var n=this,r=this.schema.primKey.keyPath;return this._trans("readwrite",function(a){return n.core.get({trans:a,key:e}).then(function(s){var i=s??{};return Ne(i,t),r&&st(i,r,e),n.core.mutate({trans:a,type:"put",values:[i],keys:[e],upsert:!0,updates:{keys:[e],changeSpecs:[t]}}).then(function(u){return u.numFailures?R.reject(u.failures[0]):!!s})})})},le.prototype.update=function(e,t){return typeof e!="object"||ae(e)?this.where(":id").equals(e).modify(t):(e=$t(e,this.schema.primKey.keyPath))===void 0?l(new H.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(e).modify(t)},le.prototype.put=function(e,t){var n=this,r=this.schema.primKey,a=r.auto,s=r.keyPath,i=e;return s&&a&&(i=U(s)(e)),this._trans("readwrite",function(u){return n.core.mutate({trans:u,type:"put",values:[i],keys:t!=null?[t]:null})}).then(function(u){return u.numFailures?R.reject(u.failures[0]):u.lastResult}).then(function(u){if(s)try{st(e,s,u)}catch{}return u})},le.prototype.delete=function(e){var t=this;return this._trans("readwrite",function(n){return t.core.mutate({trans:n,type:"delete",keys:[e]}).then(function(r){return Fe(t,[e],r)}).then(function(r){return r.numFailures?R.reject(r.failures[0]):void 0})})},le.prototype.clear=function(){var e=this;return this._trans("readwrite",function(t){return e.core.mutate({trans:t,type:"deleteRange",range:X}).then(function(n){return Fe(e,null,n)})}).then(function(t){return t.numFailures?R.reject(t.failures[0]):void 0})},le.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",function(n){return t.core.getMany({keys:e,trans:n}).then(function(r){return r.map(function(a){return t.hook.reading.fire(a)})})})},le.prototype.bulkAdd=function(e,t,n){var r=this,a=Array.isArray(t)?t:void 0,s=(n=n||(a?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(i){var u=r.schema.primKey,x=u.auto,u=u.keyPath;if(u&&a)throw new H.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new H.InvalidArgument("Arguments objects and keys must have the same length");var h=e.length,x=u&&x?e.map(U(u)):e;return r.core.mutate({trans:i,type:"add",keys:a,values:x,wantResults:s}).then(function(p){var d=p.numFailures,f=p.failures;if(d===0)return s?p.results:p.lastResult;throw new pn("".concat(r.name,".bulkAdd(): ").concat(d," of ").concat(h," operations failed"),f)})})},le.prototype.bulkPut=function(e,t,n){var r=this,a=Array.isArray(t)?t:void 0,s=(n=n||(a?void 0:t))?n.allKeys:void 0;return this._trans("readwrite",function(i){var u=r.schema.primKey,x=u.auto,u=u.keyPath;if(u&&a)throw new H.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new H.InvalidArgument("Arguments objects and keys must have the same length");var h=e.length,x=u&&x?e.map(U(u)):e;return r.core.mutate({trans:i,type:"put",keys:a,values:x,wantResults:s}).then(function(p){var d=p.numFailures,f=p.failures;if(d===0)return s?p.results:p.lastResult;throw new pn("".concat(r.name,".bulkPut(): ").concat(d," of ").concat(h," operations failed"),f)})})},le.prototype.bulkUpdate=function(e){var t=this,n=this.core,r=e.map(function(i){return i.key}),a=e.map(function(i){return i.changes}),s=[];return this._trans("readwrite",function(i){return n.getMany({trans:i,keys:r,cache:"clone"}).then(function(u){var h=[],x=[],p=(e.forEach(function(d,f){var C=d.key,m=d.changes,v=u[f];if(v){for(var $=0,_=Object.keys(m);$<_.length;$++){var k=_[$],B=m[k];if(k===t.schema.primKey.keyPath){if(W(B,C)!==0)throw new H.Constraint("Cannot update primary key in bulkUpdate()")}else st(v,k,B)}s.push(f),h.push(C),x.push(v)}}),h.length);return n.mutate({trans:i,type:"put",keys:h,values:x,updates:{keys:r,changeSpecs:a}}).then(function(d){var f=d.numFailures,C=d.failures;if(f===0)return p;for(var m=0,v=Object.keys(C);m<v.length;m++){var $,_=v[m],k=s[Number(_)];k!=null&&($=C[_],delete C[_],C[k]=$)}throw new pn("".concat(t.name,".bulkUpdate(): ").concat(f," of ").concat(p," operations failed"),C)})})})},le.prototype.bulkDelete=function(e){var t=this,n=e.length;return this._trans("readwrite",function(r){return t.core.mutate({trans:r,type:"delete",keys:e}).then(function(a){return Fe(t,e,a)})}).then(function(r){var a=r.numFailures,s=r.failures;if(a===0)return r.lastResult;throw new pn("".concat(t.name,".bulkDelete(): ").concat(a," of ").concat(n," operations failed"),s)})};var ze=le;function le(){}function qe(e){function t(i,u){if(u){for(var h=arguments.length,x=new Array(h-1);--h;)x[h-1]=arguments[h];return n[i].subscribe.apply(null,x),e}if(typeof i=="string")return n[i]}var n={};t.addEventType=s;for(var r=1,a=arguments.length;r<a;++r)s(arguments[r]);return t;function s(i,u,h){var x,p;if(typeof i!="object")return u=u||lr,p={subscribers:[],fire:h=h||ge,subscribe:function(d){p.subscribers.indexOf(d)===-1&&(p.subscribers.push(d),p.fire=u(p.fire,d))},unsubscribe:function(d){p.subscribers=p.subscribers.filter(function(f){return f!==d}),p.fire=p.subscribers.reduce(u,h)}},n[i]=t[i]=p;me(x=i).forEach(function(d){var f=x[d];if(ae(f))s(d,x[d][0],x[d][1]);else{if(f!=="asap")throw new H.InvalidArgument("Invalid event config");var C=s(d,zt,function(){for(var m=arguments.length,v=new Array(m);m--;)v[m]=arguments[m];C.subscribers.forEach(function($){Er(function(){$.apply(null,v)})})})}})}}function N(e,t){return kt(t).from({prototype:e}),t}function Ae(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function yt(e,t){e.filter=F(e.filter,t)}function It(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return F(r(),t())}:t,e.justLimit=n&&!r}function ct(e,t){if(e.isPrimKey)return t.primaryKey;var n=t.getIndexByKeyPath(e.index);if(n)return n;throw new H.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed")}function nt(e,t,n){var r=ct(e,t.schema);return t.openCursor({trans:n,values:!e.keysOnly,reverse:e.dir==="prev",unique:!!e.unique,query:{index:r,range:e.range}})}function it(e,t,n,r){var a,s,i=e.replayFilter?F(e.filter,e.replayFilter()):e.filter;return e.or?(a={},s=function(u,h,x){var p,d;i&&!i(h,x,function(f){return h.stop(f)},function(f){return h.fail(f)})||((d=""+(p=h.primaryKey))=="[object ArrayBuffer]"&&(d=""+new Uint8Array(p)),ie(a,d))||(a[d]=!0,t(u,h,x))},Promise.all([e.or._iterate(s,n),Te(nt(e,r,n),e.algorithm,s,!e.keysOnly&&e.valueMapper)])):Te(nt(e,r,n),F(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function Te(e,t,n,r){var a=we(r?function(s,i,u){return n(r(s),i,u)}:n);return e.then(function(s){if(s)return s.start(function(){var i=function(){return s.continue()};t&&!t(s,function(u){return i=u},function(u){s.stop(u),i=ge},function(u){s.fail(u),i=ge})||a(s.value,s,function(u){return i=u}),i()})})}ee.prototype._read=function(e,t){var n=this._ctx;return n.error?n.table._trans(null,l.bind(null,n.error)):n.table._trans("readonly",e).then(t)},ee.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,l.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},ee.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=F(t.algorithm,e)},ee.prototype._iterate=function(e,t){return it(this._ctx,e,t,this._ctx.table.core)},ee.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&de(n,e),t._ctx=n,t},ee.prototype.raw=function(){return this._ctx.valueMapper=null,this},ee.prototype.each=function(e){var t=this._ctx;return this._read(function(n){return it(t,e,n,t.table.core)})},ee.prototype.count=function(e){var t=this;return this._read(function(n){var r,a=t._ctx,s=a.table.core;return Ae(a,!0)?s.count({trans:n,query:{index:ct(a,s.schema),range:a.range}}).then(function(i){return Math.min(i,a.limit)}):(r=0,it(a,function(){return++r,!1},n,s).then(function(){return r}))}).then(e)},ee.prototype.sortBy=function(e,t){var n=e.split(".").reverse(),r=n[0],a=n.length-1;function s(h,x){return x?s(h[n[x]],x-1):h[r]}var i=this._ctx.dir==="next"?1:-1;function u(h,x){return W(s(h,a),s(x,a))*i}return this.toArray(function(h){return h.sort(u)}).then(t)},ee.prototype.toArray=function(e){var t=this;return this._read(function(n){var r,a,s,i=t._ctx;return i.dir==="next"&&Ae(i,!0)&&0<i.limit?(r=i.valueMapper,a=ct(i,i.table.core.schema),i.table.core.query({trans:n,limit:i.limit,values:!0,query:{index:a,range:i.range}}).then(function(u){return u=u.result,r?u.map(r):u})):(s=[],it(i,function(u){return s.push(u)},n,i.table.core).then(function(){return s}))},e)},ee.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Ae(t)?It(t,function(){var n=e;return function(r,a){return n===0||(n===1?--n:a(function(){r.advance(n),n=0}),!1)}}):It(t,function(){var n=e;return function(){return--n<0}})),this},ee.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),It(this._ctx,function(){var t=e;return function(n,r,a){return--t<=0&&r(a),0<=t}},!0),this},ee.prototype.until=function(e,t){return yt(this._ctx,function(n,r,a){return!e(n.value)||(r(a),t)}),this},ee.prototype.first=function(e){return this.limit(1).toArray(function(t){return t[0]}).then(e)},ee.prototype.last=function(e){return this.reverse().first(e)},ee.prototype.filter=function(e){var t;return yt(this._ctx,function(n){return e(n.value)}),(t=this._ctx).isMatch=F(t.isMatch,e),this},ee.prototype.and=function(e){return this.filter(e)},ee.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},ee.prototype.reverse=function(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},ee.prototype.desc=function(){return this.reverse()},ee.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.key,r)})},ee.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},ee.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each(function(n,r){e(r.primaryKey,r)})},ee.prototype.keys=function(e){var t=this._ctx,n=(t.keysOnly=!t.isMatch,[]);return this.each(function(r,a){n.push(a.key)}).then(function(){return n}).then(e)},ee.prototype.primaryKeys=function(e){var t=this._ctx;if(t.dir==="next"&&Ae(t,!0)&&0<t.limit)return this._read(function(r){var a=ct(t,t.table.core.schema);return t.table.core.query({trans:r,values:!1,limit:t.limit,query:{index:a,range:t.range}})}).then(function(r){return r.result}).then(e);t.keysOnly=!t.isMatch;var n=[];return this.each(function(r,a){n.push(a.primaryKey)}).then(function(){return n}).then(e)},ee.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},ee.prototype.firstKey=function(e){return this.limit(1).keys(function(t){return t[0]}).then(e)},ee.prototype.lastKey=function(e){return this.reverse().firstKey(e)},ee.prototype.distinct=function(){var e,t=this._ctx,t=t.index&&t.table.schema.idxByName[t.index];return t&&t.multi&&(e={},yt(this._ctx,function(r){var r=r.primaryKey.toString(),a=ie(e,r);return e[r]=!0,!a})),this},ee.prototype.modify=function(e){var t=this,n=this._ctx;return this._write(function(r){function a(v,$){var _=$.failures;f+=v-$.numFailures;for(var k=0,B=me(_);k<B.length;k++){var O=B[k];d.push(_[O])}}var s=typeof e=="function"?e:function(v){return Ne(v,e)},i=n.table.core,p=i.schema.primaryKey,u=p.outbound,h=p.extractKey,x=200,p=t.db._options.modifyChunkSize,d=(p&&(x=typeof p=="object"?p[i.name]||p["*"]||200:p),[]),f=0,C=[],m=e===Le;return t.clone().primaryKeys().then(function(v){function $(k){var B=Math.min(x,v.length-k),O=v.slice(k,k+B);return(m?Promise.resolve([]):i.getMany({trans:r,keys:O,cache:"immutable"})).then(function(K){var q=[],M=[],V=u?[]:null,Y=m?O:[];if(!m)for(var I=0;I<B;++I){var z=K[I],he={value:en(z),primKey:v[k+I]};s.call(he,he.value,he)!==!1&&(he.value==null?Y.push(v[k+I]):u||W(h(z),h(he.value))===0?(M.push(he.value),u&&V.push(v[k+I])):(Y.push(v[k+I]),q.push(he.value)))}return Promise.resolve(0<q.length&&i.mutate({trans:r,type:"add",values:q}).then(function(ve){for(var Q in ve.failures)Y.splice(parseInt(Q),1);a(q.length,ve)})).then(function(){return(0<M.length||_&&typeof e=="object")&&i.mutate({trans:r,type:"put",keys:V,values:M,criteria:_,changeSpec:typeof e!="function"&&e,isAdditionalChunk:0<k}).then(function(ve){return a(M.length,ve)})}).then(function(){return(0<Y.length||_&&m)&&i.mutate({trans:r,type:"delete",keys:Y,criteria:_,isAdditionalChunk:0<k}).then(function(ve){return Fe(n.table,Y,ve)}).then(function(ve){return a(Y.length,ve)})}).then(function(){return v.length>k+B&&$(k+x)})})}var _=Ae(n)&&n.limit===1/0&&(typeof e!="function"||m)&&{index:n.index,range:n.range};return $(0).then(function(){if(0<d.length)throw new xn("Error modifying one or more objects",d,f,C);return v.length})})})},ee.prototype.delete=function(){var e=this._ctx,t=e.range;return!Ae(e)||e.table.schema.yProps||!e.isPrimKey&&t.type!==3?this.modify(Le):this._write(function(n){var r=e.table.core.schema.primaryKey,a=t;return e.table.core.count({trans:n,query:{index:r,range:a}}).then(function(s){return e.table.core.mutate({trans:n,type:"deleteRange",range:a}).then(function(h){var u=h.failures,h=h.numFailures;if(h)throw new xn("Could not delete some values",Object.keys(u).map(function(x){return u[x]}),s-h);return s-h})})})};var dt=ee;function ee(){}var Le=function(e,t){return t.value=null};function je(e,t){return e<t?-1:e===t?0:1}function wt(e,t){return t<e?-1:e===t?0:1}function De(e,t,n){return e=e instanceof ye?new e.Collection(e):e,e._ctx.error=new(n||TypeError)(t),e}function rt(e){return new e.Collection(e,function(){return Pt("")}).limit(0)}function xt(C,t,n,r){var a,s,i,u,h,x,p,d=n.length;if(!n.every(function(v){return typeof v=="string"}))return De(C,y);function f(v){a=v==="next"?function(_){return _.toUpperCase()}:function(_){return _.toLowerCase()},s=v==="next"?function(_){return _.toLowerCase()}:function(_){return _.toUpperCase()},i=v==="next"?je:wt;var $=n.map(function(_){return{lower:s(_),upper:a(_)}}).sort(function(_,k){return i(_.lower,k.lower)});u=$.map(function(_){return _.upper}),h=$.map(function(_){return _.lower}),p=(x=v)==="next"?"":r}f("next");var C=new C.Collection(C,function(){return ft(u[0],h[d-1]+r)}),m=(C._ondirectionchange=function(v){f(v)},0);return C._addAlgorithm(function(v,$,_){var k=v.key;if(typeof k=="string"){var B=s(k);if(t(B,h,m))return!0;for(var O=null,K=m;K<d;++K){var q=((M,V,Y,I,z,he)=>{for(var ve=Math.min(M.length,I.length),Q=-1,oe=0;oe<ve;++oe){var Oe=V[oe];if(Oe!==I[oe])return z(M[oe],Y[oe])<0?M.substr(0,oe)+Y[oe]+Y.substr(oe+1):z(M[oe],I[oe])<0?M.substr(0,oe)+I[oe]+Y.substr(oe+1):0<=Q?M.substr(0,Q)+V[Q]+Y.substr(Q+1):null;z(M[oe],Oe)<0&&(Q=oe)}return ve<I.length&&he==="next"?M+Y.substr(M.length):ve<M.length&&he==="prev"?M.substr(0,Y.length):Q<0?null:M.substr(0,Q)+I[Q]+Y.substr(Q+1)})(k,B,u[K],h[K],i,x);q===null&&O===null?m=K+1:(O===null||0<i(O,q))&&(O=q)}$(O!==null?function(){v.continue(O+p)}:_)}return!1}),C}function ft(e,t,n,r){return{type:2,lower:e,upper:t,lowerOpen:n,upperOpen:r}}function Pt(e){return{type:1,lower:e,upper:e}}Object.defineProperty(ne.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!1,configurable:!0}),ne.prototype.between=function(e,t,n,r){n=n!==!1,r=r===!0;try{return 0<this._cmp(e,t)||this._cmp(e,t)===0&&(n||r)&&(!n||!r)?rt(this):new this.Collection(this,function(){return ft(e,t,!n,!r)})}catch{return De(this,b)}},ne.prototype.equals=function(e){return e==null?De(this,b):new this.Collection(this,function(){return Pt(e)})},ne.prototype.above=function(e){return e==null?De(this,b):new this.Collection(this,function(){return ft(e,void 0,!0)})},ne.prototype.aboveOrEqual=function(e){return e==null?De(this,b):new this.Collection(this,function(){return ft(e,void 0,!1)})},ne.prototype.below=function(e){return e==null?De(this,b):new this.Collection(this,function(){return ft(void 0,e,!1,!0)})},ne.prototype.belowOrEqual=function(e){return e==null?De(this,b):new this.Collection(this,function(){return ft(void 0,e)})},ne.prototype.startsWith=function(e){return typeof e!="string"?De(this,y):this.between(e,e+c,!0,!0)},ne.prototype.startsWithIgnoreCase=function(e){return e===""?this.startsWith(e):xt(this,function(t,n){return t.indexOf(n[0])===0},[e],c)},ne.prototype.equalsIgnoreCase=function(e){return xt(this,function(t,n){return t===n[0]},[e],"")},ne.prototype.anyOfIgnoreCase=function(){var e=_t.apply(fn,arguments);return e.length===0?rt(this):xt(this,function(t,n){return n.indexOf(t)!==-1},e,"")},ne.prototype.startsWithAnyOfIgnoreCase=function(){var e=_t.apply(fn,arguments);return e.length===0?rt(this):xt(this,function(t,n){return n.some(function(r){return t.indexOf(r)===0})},e,c)},ne.prototype.anyOf=function(){var e,t,n=this,r=_t.apply(fn,arguments),a=this._cmp;try{r.sort(a)}catch{return De(this,b)}return r.length===0?rt(this):((e=new this.Collection(this,function(){return ft(r[0],r[r.length-1])}))._ondirectionchange=function(s){a=s==="next"?n._ascending:n._descending,r.sort(a)},t=0,e._addAlgorithm(function(s,i,u){for(var h=s.key;0<a(h,r[t]);)if(++t===r.length)return i(u),!1;return a(h,r[t])===0||(i(function(){s.continue(r[t])}),!1)}),e)},ne.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},ne.prototype.noneOf=function(){var e=_t.apply(fn,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return De(this,b)}var t=e.reduce(function(n,r){return n?n.concat([[n[n.length-1][1],r]]):[[-1/0,r]]},null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},ne.prototype.inAnyRange=function(e,_){var n=this,r=this._cmp,a=this._ascending,s=this._descending,i=this._min,u=this._max;if(e.length===0)return rt(this);if(!e.every(function(k){return k[0]!==void 0&&k[1]!==void 0&&a(k[0],k[1])<=0}))return De(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",H.InvalidArgument);var h=!_||_.includeLowers!==!1,x=_&&_.includeUppers===!0,p,d=a;function f(k,B){return d(k[0],B[0])}try{(p=e.reduce(function(k,B){for(var O=0,K=k.length;O<K;++O){var q=k[O];if(r(B[0],q[1])<0&&0<r(B[1],q[0])){q[0]=i(q[0],B[0]),q[1]=u(q[1],B[1]);break}}return O===K&&k.push(B),k},[])).sort(f)}catch{return De(this,b)}var C=0,m=x?function(k){return 0<a(k,p[C][1])}:function(k){return 0<=a(k,p[C][1])},v=h?function(k){return 0<s(k,p[C][0])}:function(k){return 0<=s(k,p[C][0])},$=m,_=new this.Collection(this,function(){return ft(p[0][0],p[p.length-1][1],!h,!x)});return _._ondirectionchange=function(k){d=k==="next"?($=m,a):($=v,s),p.sort(f)},_._addAlgorithm(function(k,B,O){for(var K,q=k.key;$(q);)if(++C===p.length)return B(O),!1;return!m(K=q)&&!v(K)||(n._cmp(q,p[C][1])===0||n._cmp(q,p[C][0])===0||B(function(){d===a?k.continue(p[C][0]):k.continue(p[C][1])}),!1)}),_},ne.prototype.startsWithAnyOf=function(){var e=_t.apply(fn,arguments);return e.every(function(t){return typeof t=="string"})?e.length===0?rt(this):this.inAnyRange(e.map(function(t){return[t,t+c]})):De(this,"startsWithAnyOf() only works with strings")};var ye=ne;function ne(){}function be(e){return we(function(t){return S(t),e(t.target.error),!1})}function S(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var A="storagemutated",at="x-storagemutated-1",ot=qe(null,A),Wn=(Ue.prototype._lock=function(){return dn(!J.global),++this._reculock,this._reculock!==1||J.global||(J.lockOwnerFor=this),this},Ue.prototype._unlock=function(){if(dn(!J.global),--this._reculock==0)for(J.global||(J.lockOwnerFor=null);0<this._blockedFuncs.length&&!this._locked();){var e=this._blockedFuncs.shift();try{an(e[1],e[0])}catch{}}return this},Ue.prototype._locked=function(){return this._reculock&&J.lockOwnerFor!==this},Ue.prototype.create=function(e){var t=this;if(this.mode){var n=this.db.idbdb,r=this.db._state.dbOpenError;if(dn(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new H.DatabaseClosed(r);case"MissingAPIError":throw new H.MissingAPI(r.message,r);default:throw new H.OpenFailed(r)}if(!this.active)throw new H.TransactionInactive;dn(this._completion._state===null),(e=this.idbtrans=e||(this.db.core||n).transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability})).onerror=we(function(a){S(a),t._reject(e.error)}),e.onabort=we(function(a){S(a),t.active&&t._reject(new H.Abort(e.error)),t.active=!1,t.on("abort").fire(a)}),e.oncomplete=we(function(){t.active=!1,t._resolve(),"mutatedParts"in e&&ot.storagemutated.fire(e.mutatedParts)})}return this},Ue.prototype._promise=function(e,t,n){var r,a=this;return e==="readwrite"&&this.mode!=="readwrite"?l(new H.ReadOnly("Transaction is readonly")):this.active?this._locked()?new R(function(s,i){a._blockedFuncs.push([function(){a._promise(e,t,n).then(s,i)},J])}):n?Ut(function(){var s=new R(function(i,u){a._lock();var h=t(i,u,a);h&&h.then&&h.then(i,u)});return s.finally(function(){return a._unlock()}),s._lib=!0,s}):((r=new R(function(s,i){var u=t(s,i,a);u&&u.then&&u.then(s,i)}))._lib=!0,r):l(new H.TransactionInactive)},Ue.prototype._root=function(){return this.parent?this.parent._root():this},Ue.prototype.waitFor=function(e){var t,n=this._root(),r=R.resolve(e),a=(n._waitingFor?n._waitingFor=n._waitingFor.then(function(){return r}):(n._waitingFor=r,n._waitingQueue=[],t=n.idbtrans.objectStore(n.storeNames[0]),(function s(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(t.get(-1/0).onsuccess=s)})()),n._waitingFor);return new R(function(s,i){r.then(function(u){return n._waitingQueue.push(we(s.bind(null,u)))},function(u){return n._waitingQueue.push(we(i.bind(null,u)))}).finally(function(){n._waitingFor===a&&(n._waitingFor=null)})})},Ue.prototype.abort=function(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new H.Abort))},Ue.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(ie(t,e))return t[e];var n=this.schema[e];if(n)return(n=new this.db.Table(e,n,this)).core=this.db.core.table(e),t[e]=n;throw new H.NotFound("Table "+e+" not part of transaction")},Ue);function Ue(){}function Ft(e,t,n,r,a,s,i,u){return{name:e,keyPath:t,unique:n,multi:r,auto:a,compound:s,src:(n&&!i?"&":"")+(r?"*":"")+(a?"++":"")+Jt(t),type:u}}function Jt(e){return typeof e=="string"?e:e?"["+[].join.call(e,"+")+"]":""}function ke(e,t,n){return{name:e,primKey:t,indexes:n,mappedClass:null,idxByName:(r=function(a){return[a.name,a]},n.reduce(function(a,s,i){return s=r(s,i),s&&(a[s[0]]=s[1]),a},{}))};var r}var sn=function(e){try{return e.only([[]]),sn=function(){return[[]]},[[]]}catch{return sn=function(){return c},c}};function Ht(e){return e==null?function(){}:typeof e=="string"?(t=e).split(".").length===1?function(n){return n[t]}:function(n){return $t(n,t)}:function(n){return $t(n,e)};var t}function Jn(e){return[].slice.call(e)}var Ge=0;function Xt(e){return e==null?":id":typeof e=="string"?e:"[".concat(e.join("+"),"]")}function Ir(e,t,h){function r(m){if(m.type===3)return null;if(m.type===4)throw new Error("Cannot convert never type to IDBKeyRange");var d=m.lower,f=m.upper,C=m.lowerOpen,m=m.upperOpen;return d===void 0?f===void 0?null:t.upperBound(f,!!m):f===void 0?t.lowerBound(d,!!C):t.bound(d,f,!!C,!!m)}function a(p){var d,f=p.name;return{name:f,schema:p,mutate:function(C){var m=C.trans,v=C.type,$=C.keys,_=C.values,k=C.range;return new Promise(function(B,O){B=we(B);var K=m.objectStore(f),q=K.keyPath==null,M=v==="put"||v==="add";if(!M&&v!=="delete"&&v!=="deleteRange")throw new Error("Invalid operation type: "+v);var V,Y=($||_||{length:1}).length;if($&&_&&$.length!==_.length)throw new Error("Given keys array must have same length as given values array.");if(Y===0)return B({numFailures:0,failures:{},results:[],lastResult:void 0});function I(Ie){++ve,S(Ie)}var z=[],he=[],ve=0;if(v==="deleteRange"){if(k.type===4)return B({numFailures:ve,failures:he,results:[],lastResult:void 0});k.type===3?z.push(V=K.clear()):z.push(V=K.delete(r(k)))}else{var q=M?q?[_,$]:[_,null]:[$,null],Q=q[0],oe=q[1];if(M)for(var Oe=0;Oe<Y;++Oe)z.push(V=oe&&oe[Oe]!==void 0?K[v](Q[Oe],oe[Oe]):K[v](Q[Oe])),V.onerror=I;else for(Oe=0;Oe<Y;++Oe)z.push(V=K[v](Q[Oe])),V.onerror=I}function Mt(Ie){Ie=Ie.target.result,z.forEach(function(In,oa){return In.error!=null&&(he[oa]=In.error)}),B({numFailures:ve,failures:he,results:v==="delete"?$:z.map(function(In){return In.result}),lastResult:Ie})}V.onerror=function(Ie){I(Ie),Mt(Ie)},V.onsuccess=Mt})},getMany:function(C){var m=C.trans,v=C.keys;return new Promise(function($,_){$=we($);for(var k,B=m.objectStore(f),O=v.length,K=new Array(O),q=0,M=0,V=function(z){z=z.target,K[z._pos]=z.result,++M===q&&$(K)},Y=be(_),I=0;I<O;++I)v[I]!=null&&((k=B.get(v[I]))._pos=I,k.onsuccess=V,k.onerror=Y,++q);q===0&&$(K)})},get:function(C){var m=C.trans,v=C.key;return new Promise(function($,_){$=we($);var k=m.objectStore(f).get(v);k.onsuccess=function(B){return $(B.target.result)},k.onerror=be(_)})},query:(d=u,function(C){return new Promise(function(m,v){m=we(m);var $,_,k,M=C.trans,B=C.values,O=C.limit,q=C.query,K=O===1/0?void 0:O,V=q.index,q=q.range,M=M.objectStore(f),M=V.isPrimaryKey?M:M.index(V.name),V=r(q);if(O===0)return m({result:[]});d?((q=B?M.getAll(V,K):M.getAllKeys(V,K)).onsuccess=function(Y){return m({result:Y.target.result})},q.onerror=be(v)):($=0,_=!B&&"openKeyCursor"in M?M.openKeyCursor(V):M.openCursor(V),k=[],_.onsuccess=function(Y){var I=_.result;return!I||(k.push(B?I.value:I.primaryKey),++$===O)?m({result:k}):void I.continue()},_.onerror=be(v))})}),openCursor:function(C){var m=C.trans,v=C.values,$=C.query,_=C.reverse,k=C.unique;return new Promise(function(B,O){B=we(B);var M=$.index,K=$.range,q=m.objectStore(f),q=M.isPrimaryKey?q:q.index(M.name),M=_?k?"prevunique":"prev":k?"nextunique":"next",V=!v&&"openKeyCursor"in q?q.openKeyCursor(r(K),M):q.openCursor(r(K),M);V.onerror=be(O),V.onsuccess=we(function(Y){var I,z,he,ve,Q=V.result;Q?(Q.___id=++Ge,Q.done=!1,I=Q.continue.bind(Q),z=(z=Q.continuePrimaryKey)&&z.bind(Q),he=Q.advance.bind(Q),ve=function(){throw new Error("Cursor not stopped")},Q.trans=m,Q.stop=Q.continue=Q.continuePrimaryKey=Q.advance=function(){throw new Error("Cursor not started")},Q.fail=we(O),Q.next=function(){var oe=this,Oe=1;return this.start(function(){return Oe--?oe.continue():oe.stop()}).then(function(){return oe})},Q.start=function(oe){function Oe(){if(V.result)try{oe()}catch(Ie){Q.fail(Ie)}else Q.done=!0,Q.start=function(){throw new Error("Cursor behind last entry")},Q.stop()}var Mt=new Promise(function(Ie,In){Ie=we(Ie),V.onerror=be(In),Q.fail=In,Q.stop=function(oa){Q.stop=Q.continue=Q.continuePrimaryKey=Q.advance=ve,Ie(oa)}});return V.onsuccess=we(function(Ie){V.onsuccess=Oe,Oe()}),Q.continue=I,Q.continuePrimaryKey=z,Q.advance=he,Oe(),Mt},B(Q)):B(null)},O)})},count:function(C){var m=C.query,v=C.trans,$=m.index,_=m.range;return new Promise(function(k,B){var O=v.objectStore(f),O=$.isPrimaryKey?O:O.index($.name),K=r(_),K=K?O.count(K):O.count();K.onsuccess=we(function(q){return k(q.target.result)}),K.onerror=be(B)})}}}s=h,i=Jn((h=e).objectStoreNames);var s,h={schema:{name:h.name,tables:i.map(function(p){return s.objectStore(p)}).map(function(p){var d=p.keyPath,f=p.autoIncrement,m=ae(d),C={},m={name:p.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:d==null,compound:m,keyPath:d,autoIncrement:f,unique:!0,extractKey:Ht(d)},indexes:Jn(p.indexNames).map(function(v){return p.index(v)}).map(function(k){var B=k.name,$=k.unique,_=k.multiEntry,k=k.keyPath,B={name:B,compound:ae(k),keyPath:k,unique:$,multiEntry:_,extractKey:Ht(k)};return C[Xt(k)]=B}),getIndexByKeyPath:function(v){return C[Xt(v)]}};return C[":id"]=m.primaryKey,d!=null&&(C[Xt(d)]=m.primaryKey),m})},hasGetAll:0<i.length&&"getAll"in s.objectStore(i[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)},i=h.schema,u=h.hasGetAll,h=i.tables.map(a),x={};return h.forEach(function(p){return x[p.name]=p}),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(p){if(x[p])return x[p];throw new Error("Table '".concat(p,"' not found"))},MIN_KEY:-1/0,MAX_KEY:sn(t),schema:i}}function Fr(e,t,n,r){return n=n.IDBKeyRange,t=Ir(t,n,r),{dbcore:e.dbcore.reduce(function(a,s){return s=s.create,G(G({},a),s(a))},t)}}function Pn(e,t){var n=t.db,n=Fr(e._middlewares,n,e._deps,t);e.core=n.dbcore,e.tables.forEach(function(r){var a=r.name;e.core.schema.tables.some(function(s){return s.name===a})&&(r.core=e.core.table(a),e[a]instanceof e.Table)&&(e[a].core=r.core)})}function Hn(e,t,n,r){n.forEach(function(a){var s=r[a];t.forEach(function(i){var u=(function h(x,p){return Wr(x,p)||(x=He(x))&&h(x,p)})(i,a);(!u||"value"in u&&u.value===void 0)&&(i===e.Transaction.prototype||i instanceof e.Transaction?vt(i,a,{get:function(){return this.table(a)},set:function(h){Ze(this,a,{value:h,writable:!0,configurable:!0,enumerable:!0})}}):i[a]=new e.Table(a,s))})})}function pr(e,t){t.forEach(function(n){for(var r in n)n[r]instanceof e.Table&&delete n[r]})}function na(e,t){return e._cfg.version-t._cfg.version}function ra(e,t,n,r){var a=e._dbSchema,s=(n.objectStoreNames.contains("$meta")&&!a.$meta&&(a.$meta=ke("$meta",Nr("")[0],[]),e._storeNames.push("$meta")),e._createTransaction("readwrite",e._storeNames,a)),i=(s.create(n),s._completion.catch(r),s._reject.bind(s)),u=J.transless||J;Ut(function(){if(J.trans=s,J.transless=u,t!==0)return Pn(e,n),x=t,((h=s).storeNames.includes("$meta")?h.table("$meta").get("version").then(function(p){return p??x}):R.resolve(x)).then(function($){var d=e,f=$,C=s,m=n,v=[],$=d._versions,_=d._dbSchema=On(0,d.idbdb,m);return($=$.filter(function(k){return k._cfg.version>=f})).length===0?R.resolve():($.forEach(function(k){v.push(function(){var B,O,K,q=_,M=k._cfg.dbschema,V=(Qn(d,q,m),Qn(d,M,m),_=d._dbSchema=M,vr(q,M)),Y=(V.add.forEach(function(I){mr(m,I[0],I[1].primKey,I[1].indexes)}),V.change.forEach(function(I){if(I.recreate)throw new H.Upgrade("Not yet support for changing primary key");var z=m.objectStore(I.name);I.add.forEach(function(he){return Xn(z,he)}),I.change.forEach(function(he){z.deleteIndex(he.name),Xn(z,he)}),I.del.forEach(function(he){return z.deleteIndex(he)})}),k._cfg.contentUpgrade);if(Y&&k._cfg.version>f)return Pn(d,m),C._memoizedTables={},B=Tt(M),V.del.forEach(function(I){B[I]=q[I]}),pr(d,[d.Transaction.prototype]),Hn(d,[d.Transaction.prototype],me(B),B),C.schema=B,(O=sr(Y))&&rn(),M=R.follow(function(){var I;(K=Y(C))&&O&&(I=Gt.bind(null,null),K.then(I,I))}),K&&typeof K.then=="function"?R.resolve(K):M.then(function(){return K})}),v.push(function(B){var O,K,q=k._cfg.dbschema;O=q,K=B,[].slice.call(K.db.objectStoreNames).forEach(function(M){return O[M]==null&&K.db.deleteObjectStore(M)}),pr(d,[d.Transaction.prototype]),Hn(d,[d.Transaction.prototype],d._storeNames,d._dbSchema),C.schema=d._dbSchema}),v.push(function(B){d.idbdb.objectStoreNames.contains("$meta")&&(Math.ceil(d.idbdb.version/10)===k._cfg.version?(d.idbdb.deleteObjectStore("$meta"),delete d._dbSchema.$meta,d._storeNames=d._storeNames.filter(function(O){return O!=="$meta"})):B.objectStore("$meta").put(k._cfg.version,"version"))})}),(function k(){return v.length?R.resolve(v.shift()(C.idbtrans)).then(k):R.resolve()})().then(function(){bn(_,m)}))}).catch(i);var h,x;me(a).forEach(function(p){mr(n,p,a[p].primKey,a[p].indexes)}),Pn(e,n),R.follow(function(){return e.on.populate.fire(s)}).catch(i)})}function aa(e,t){bn(e._dbSchema,t),t.db.version%10!=0||t.objectStoreNames.contains("$meta")||t.db.createObjectStore("$meta").add(Math.ceil(t.db.version/10-1),"version");var n=On(0,e.idbdb,t);Qn(e,e._dbSchema,t);for(var r=0,a=vr(n,e._dbSchema).change;r<a.length;r++){var s=(i=>{if(i.change.length||i.recreate)return console.warn("Unable to patch indexes of table ".concat(i.name," because it has changes on the type of index or primary key.")),{value:void 0};var u=t.objectStore(i.name);i.add.forEach(function(h){mt&&console.debug("Dexie upgrade patch: Creating missing index ".concat(i.name,".").concat(h.src)),Xn(u,h)})})(a[r]);if(typeof s=="object")return s.value}}function vr(e,t){var n,r={del:[],add:[],change:[]};for(n in e)t[n]||r.del.push(n);for(n in t){var a=e[n],s=t[n];if(a){var i={name:n,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(a.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||a.primKey.auto!==s.primKey.auto)i.recreate=!0,r.change.push(i);else{var u=a.idxByName,h=s.idxByName,x=void 0;for(x in u)h[x]||i.del.push(x);for(x in h){var p=u[x],d=h[x];p?p.src!==d.src&&i.change.push(d):i.add.push(d)}(0<i.del.length||0<i.add.length||0<i.change.length)&&r.change.push(i)}}else r.add.push([n,s])}return r}function mr(e,t,n,r){var a=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});r.forEach(function(s){return Xn(a,s)})}function bn(e,t){me(e).forEach(function(n){t.db.objectStoreNames.contains(n)||(mt&&console.debug("Dexie: Creating missing table",n),mr(t,n,e[n].primKey,e[n].indexes))})}function Xn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function On(e,t,n){var r={};return Kn(t.objectStoreNames,0).forEach(function(a){for(var s=n.objectStore(a),i=Ft(Jt(x=s.keyPath),x||"",!0,!1,!!s.autoIncrement,x&&typeof x!="string",!0),u=[],h=0;h<s.indexNames.length;++h){var p=s.index(s.indexNames[h]),x=p.keyPath,p=Ft(p.name,x,!!p.unique,!!p.multiEntry,!1,x&&typeof x!="string",!1);u.push(p)}r[a]=ke(a,i,u)}),r}function Qn(e,t,n){for(var r=n.db.objectStoreNames,a=0;a<r.length;++a){var s=r[a],i=n.objectStore(s);e._hasGetAll="getAll"in i;for(var u=0;u<i.indexNames.length;++u){var h,x=i.indexNames[u],p=i.index(x).keyPath,p=typeof p=="string"?p:"["+Kn(p).join("+")+"]";t[s]&&(h=t[s].idxByName[p])&&(h.name=x,delete t[s].idxByName[p],t[s].idxByName[x]=h)}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&re.WorkerGlobalScope&&re instanceof re.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}function Nr(e){return e.split(",").map(function(t,n){var a=t.split(":"),r=(r=a[1])==null?void 0:r.trim(),a=(t=a[0].trim()).replace(/([&*]|\+\+)/g,""),s=/^\[/.test(a)?a.match(/^\[(.*)\]$/)[1].split("+"):a;return Ft(a,s||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),ae(s),n===0,r)})}Nt.prototype._createTableSchema=ke,Nt.prototype._parseIndexSyntax=Nr,Nt.prototype._parseStoresSpec=function(e,t){var n=this;me(e).forEach(function(r){if(e[r]!==null){var a=n._parseIndexSyntax(e[r]),s=a.shift();if(!s)throw new H.Schema("Invalid schema for table "+r+": "+e[r]);if(s.unique=!0,s.multi)throw new H.Schema("Primary key cannot be multiEntry*");a.forEach(function(i){if(i.auto)throw new H.Schema("Only primary key can be marked as autoIncrement (++)");if(!i.keyPath)throw new H.Schema("Index must have a name and cannot be an empty string")}),s=n._createTableSchema(r,s,a),t[r]=s}})},Nt.prototype.stores=function(n){var t=this.db,n=(this._cfg.storesSource=this._cfg.storesSource?de(this._cfg.storesSource,n):n,t._versions),r={},a={};return n.forEach(function(s){de(r,s._cfg.storesSource),a=s._cfg.dbschema={},s._parseStoresSpec(r,a)}),t._dbSchema=a,pr(t,[t._allTables,t,t.Transaction.prototype]),Hn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],me(a),a),t._storeNames=me(a),this},Nt.prototype.upgrade=function(e){return this._cfg.contentUpgrade=$n(this._cfg.contentUpgrade||ge,e),this};var ht=Nt;function Nt(){}function Re(e,t){var n=e._dbNamesDB;return n||(n=e._dbNamesDB=new $e(T,{addons:[],indexedDB:e,IDBKeyRange:t})).version(1).stores({dbnames:"name"}),n.table("dbnames")}function gr(e){return e&&typeof e.databases=="function"}function Kt(e){return Ut(function(){return J.letThrough=!0,e()})}function on(e){return!("from"in e)}var We=function(e,t){var n;if(!this)return n=new We,e&&"d"in e&&de(n,e),n;de(this,arguments.length?{d:1,from:e,to:1<arguments.length?t:e}:{d:0})};function Mn(e,t,n){var r=W(t,n);if(!isNaN(r)){if(0<r)throw RangeError();if(on(e))return de(e,{from:t,to:n,d:1});var r=e.l,a=e.r;if(W(n,e.from)<0)return r?Mn(r,t,n):e.l={from:t,to:n,d:1,l:null,r:null},yr(e);if(0<W(t,e.to))return a?Mn(a,t,n):e.r={from:t,to:n,d:1,l:null,r:null},yr(e);W(t,e.from)<0&&(e.from=t,e.l=null,e.d=a?a.d+1:1),0<W(n,e.to)&&(e.to=n,e.r=null,e.d=e.l?e.l.d+1:1),t=!e.r,r&&!e.l&&ln(e,r),a&&t&&ln(e,a)}}function ln(e,t){on(t)||(function n(r,a){var s=a.from,i=a.l,u=a.r;Mn(r,s,a.to),i&&n(r,i),u&&n(r,u)})(e,t)}function br(e,t){var n=An(t),r=n.next();if(!r.done)for(var a=r.value,s=An(e),i=s.next(a.from),u=i.value;!r.done&&!i.done;){if(W(u.from,a.to)<=0&&0<=W(u.to,a.from))return!0;W(a.from,u.from)<0?a=(r=n.next(u.from)).value:u=(i=s.next(a.from)).value}return!1}function An(e){var t=on(e)?null:{s:0,n:e};return{next:function(n){for(var r=0<arguments.length;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&W(n,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||W(n,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function yr(e){var t,n,r,a=(((a=e.r)==null?void 0:a.d)||0)-(((a=e.l)==null?void 0:a.d)||0),a=1<a?"r":a<-1?"l":"";a&&(t=a=="r"?"l":"r",n=G({},e),r=e[a],e.from=r.from,e.to=r.to,e[a]=r[a],n[a]=r[t],(e[t]=n).d=Kr(n)),e.d=Kr(e)}function Kr(n){var t=n.r,n=n.l;return(t?n?Math.max(t.d,n.d):t.d:n?n.d:0)+1}function Ye(e,t){return me(t).forEach(function(n){e[n]?ln(e[n],t[n]):e[n]=(function r(a){var s,i,u={};for(s in a)ie(a,s)&&(i=a[s],u[s]=!i||typeof i!="object"||xe.has(i.constructor)?i:r(i));return u})(t[n])}),e}function Cr(e,t){return e.all||t.all||Object.keys(e).some(function(n){return t[n]&&br(t[n],e[n])})}Qe(We.prototype,((Ve={add:function(e){return ln(this,e),this},addKey:function(e){return Mn(this,e,e),this},addKeys:function(e){var t=this;return e.forEach(function(n){return Mn(t,n,n)}),this},hasKey:function(e){var t=An(this).next(e).value;return t&&W(t.from,e)<=0&&0<=W(t.to,e)}})[qn]=function(){return An(this)},Ve));var Qt={},wr={},xr=!1;function Zn(e){Ye(wr,e),xr||(xr=!0,setTimeout(function(){xr=!1,qt(wr,!(wr={}))},0))}function qt(e,t){t===void 0&&(t=!1);var n=new Set;if(e.all)for(var r=0,a=Object.values(Qt);r<a.length;r++)Zt(u=a[r],e,n,t);else for(var s in e){var i,u,s=/^idb\:\/\/(.*)\/(.*)\//.exec(s);s&&(i=s[1],s=s[2],u=Qt["idb://".concat(i,"/").concat(s)])&&Zt(u,e,n,t)}n.forEach(function(h){return h()})}function Zt(e,t,n,r){for(var a=[],s=0,i=Object.entries(e.queries.query);s<i.length;s++){for(var u=i[s],h=u[0],x=[],p=0,d=u[1];p<d.length;p++){var f=d[p];Cr(t,f.obsSet)?f.subscribers.forEach(function($){return n.add($)}):r&&x.push(f)}r&&a.push([h,x])}if(r)for(var C=0,m=a;C<m.length;C++){var v=m[C],h=v[0],x=v[1];e.queries.query[h]=x}}function sa(e){var t=e._state,n=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then(function(){return t.dbOpenError?l(t.dbOpenError):e});t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var r=t.openCanceller,a=Math.round(10*e.verno),s=!1;function i(){if(t.openCanceller!==r)throw new H.DatabaseClosed("db.open() was cancelled")}function u(){return new R(function(f,C){if(i(),!n)throw new H.MissingAPI;var m=e.name,v=t.autoSchema||!a?n.open(m):n.open(m,a);if(!v)throw new H.MissingAPI;v.onerror=be(C),v.onblocked=we(e._fireOnBlocked),v.onupgradeneeded=we(function($){var _;p=v.transaction,t.autoSchema&&!e._options.allowEmptyDB?(v.onerror=S,p.abort(),v.result.close(),(_=n.deleteDatabase(m)).onsuccess=_.onerror=we(function(){C(new H.NoSuchDatabase("Database ".concat(m," doesnt exist")))})):(p.onerror=be(C),_=$.oldVersion>Math.pow(2,62)?0:$.oldVersion,d=_<1,e.idbdb=v.result,s&&aa(e,p),ra(e,_/10,p,C))},C),v.onsuccess=we(function(){p=null;var $,_,k,B,O,K,q=e.idbdb=v.result,M=Kn(q.objectStoreNames);if(0<M.length)try{var V=q.transaction((O=M).length===1?O[0]:O,"readonly");if(t.autoSchema)K=q,B=V,(k=e).verno=K.version/10,B=k._dbSchema=On(0,K,B),k._storeNames=Kn(K.objectStoreNames,0),Hn(k,[k._allTables],me(B),B);else if(Qn(e,e._dbSchema,V),_=V,((_=vr(On(0,($=e).idbdb,_),$._dbSchema)).add.length||_.change.some(function(Y){return Y.add.length||Y.change.length}))&&!s)return console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Dexie will add missing parts and increment native version number to workaround this."),q.close(),a=q.version+1,s=!0,f(u());Pn(e,V)}catch{}w.push(e),q.onversionchange=we(function(Y){t.vcFired=!0,e.on("versionchange").fire(Y)}),q.onclose=we(function(){e.close({disableAutoOpen:!1})}),d&&(M=e._deps,O=m,gr(K=M.indexedDB)||O===T||Re(K,M.IDBKeyRange).put({name:O}).catch(ge)),f()},C)}).catch(function(f){switch(f?.name){case"UnknownError":if(0<t.PR1398_maxLoop)return t.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),u();break;case"VersionError":if(0<a)return a=0,u()}return R.reject(f)})}var h,x=t.dbReadyResolve,p=null,d=!1;return R.race([r,(typeof navigator>"u"?R.resolve():!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(f){function C(){return indexedDB.databases().finally(f)}h=setInterval(C,100),C()}).finally(function(){return clearInterval(h)}):Promise.resolve()).then(u)]).then(function(){return i(),t.onReadyBeingFired=[],R.resolve(Kt(function(){return e.on.ready.fire(e.vip)})).then(function f(){var C;if(0<t.onReadyBeingFired.length)return C=t.onReadyBeingFired.reduce($n,ge),t.onReadyBeingFired=[],R.resolve(Kt(function(){return C(e.vip)})).then(f)})}).finally(function(){t.openCanceller===r&&(t.onReadyBeingFired=null,t.isBeingOpened=!1)}).catch(function(f){t.dbOpenError=f;try{p&&p.abort()}catch{}return r===t.openCanceller&&e._close(),l(f)}).finally(function(){t.openComplete=!0,x()}).then(function(){var f;return d&&(f={},e.tables.forEach(function(C){C.schema.indexes.forEach(function(m){m.name&&(f["idb://".concat(e.name,"/").concat(C.name,"/").concat(m.name)]=new We(-1/0,[[[]]]))}),f["idb://".concat(e.name,"/").concat(C.name,"/")]=f["idb://".concat(e.name,"/").concat(C.name,"/:dels")]=new We(-1/0,[[[]]])}),ot(A).fire(f),qt(f,!0)),e})}function kr(e){function t(s){return e.next(s)}var n=a(t),r=a(function(s){return e.throw(s)});function a(s){return function(u){var u=s(u),h=u.value;return u.done?h:h&&typeof h.then=="function"?h.then(n,r):ae(h)?Promise.all(h).then(n,r):n(h)}}return a(t)()}function yn(e,t,n){for(var r=ae(e)?e.slice():[e],a=0;a<n;++a)r.push(t);return r}var qr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return G(G({},e),{table:function(r){var n=e.table(r),r=n.schema,a={},s=[];function i(f,C,m){var k=Xt(f),v=a[k]=a[k]||[],$=f==null?0:typeof f=="string"?1:f.length,_=0<C,k=G(G({},m),{name:_?"".concat(k,"(virtual-from:").concat(m.name,")"):m.name,lowLevelIndex:m,isVirtual:_,keyTail:C,keyLength:$,extractKey:Ht(f),unique:!_&&m.unique});return v.push(k),k.isPrimaryKey||s.push(k),1<$&&i($===2?f[0]:f.slice(0,$-1),C+1,m),v.sort(function(B,O){return B.keyTail-O.keyTail}),k}var u=i(r.primaryKey.keyPath,0,r.primaryKey);a[":id"]=[u];for(var h=0,x=r.indexes;h<x.length;h++){var p=x[h];i(p.keyPath,0,p)}function d(f){var C,m=f.query.index;return m.isVirtual?G(G({},f),{query:{index:m.lowLevelIndex,range:(C=f.query.range,m=m.keyTail,{type:C.type===1?2:C.type,lower:yn(C.lower,C.lowerOpen?e.MAX_KEY:e.MIN_KEY,m),lowerOpen:!0,upper:yn(C.upper,C.upperOpen?e.MIN_KEY:e.MAX_KEY,m),upperOpen:!0})}}):f}return G(G({},n),{schema:G(G({},r),{primaryKey:u,indexes:s,getIndexByKeyPath:function(f){return(f=a[Xt(f)])&&f[0]}}),count:function(f){return n.count(d(f))},query:function(f){return n.query(d(f))},openCursor:function(f){var C=f.query.index,m=C.keyTail,v=C.keyLength;return C.isVirtual?n.openCursor(d(f)).then(function(_){return _&&$(_)}):n.openCursor(f);function $(_){return Object.create(_,{continue:{value:function(k){k!=null?_.continue(yn(k,f.reverse?e.MAX_KEY:e.MIN_KEY,m)):f.unique?_.continue(_.key.slice(0,v).concat(f.reverse?e.MIN_KEY:e.MAX_KEY,m)):_.continue()}},continuePrimaryKey:{value:function(k,B){_.continuePrimaryKey(yn(k,e.MAX_KEY,m),B)}},primaryKey:{get:function(){return _.primaryKey}},key:{get:function(){var k=_.key;return v===1?k[0]:k.slice(0,v)}},value:{get:function(){return _.value}}})}}})}})}};function er(e,t,n,r){return n=n||{},r=r||"",me(e).forEach(function(a){var s,i,u;ie(t,a)?(s=e[a],i=t[a],typeof s=="object"&&typeof i=="object"&&s&&i?(u=ar(s))!==ar(i)?n[r+a]=t[a]:u==="Object"?er(s,i,n,r+a+"."):s!==i&&(n[r+a]=t[a]):s!==i&&(n[r+a]=t[a])):n[r+a]=void 0}),me(t).forEach(function(a){ie(e,a)||(n[r+a]=t[a])}),n}function tr(e,t){return t.type==="delete"?t.keys:t.keys||t.values.map(e.extractKey)}var Lr={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return G(G({},e),{table:function(t){var n=e.table(t),r=n.schema.primaryKey;return G(G({},n),{mutate:function(a){var s=J.trans,i=s.table(t).hook,u=i.deleting,h=i.creating,x=i.updating;switch(a.type){case"add":if(h.fire===ge)break;return s._promise("readwrite",function(){return p(a)},!0);case"put":if(h.fire===ge&&x.fire===ge)break;return s._promise("readwrite",function(){return p(a)},!0);case"delete":if(u.fire===ge)break;return s._promise("readwrite",function(){return p(a)},!0);case"deleteRange":if(u.fire===ge)break;return s._promise("readwrite",function(){return(function d(f,C,m){return n.query({trans:f,values:!1,query:{index:r,range:C},limit:m}).then(function(v){var $=v.result;return p({type:"delete",keys:$,trans:f}).then(function(_){return 0<_.numFailures?Promise.reject(_.failures[0]):$.length<m?{failures:[],numFailures:0,lastResult:void 0}:d(f,G(G({},C),{lower:$[$.length-1],lowerOpen:!0}),m)})})})(a.trans,a.range,1e4)},!0)}return n.mutate(a);function p(d){var f,C,m,v=J.trans,$=d.keys||tr(r,d);if($)return(d=d.type==="add"||d.type==="put"?G(G({},d),{keys:$}):G({},d)).type!=="delete"&&(d.values=ce([],d.values)),d.keys&&(d.keys=ce([],d.keys)),f=n,m=$,((C=d).type==="add"?Promise.resolve([]):f.getMany({trans:C.trans,keys:m,cache:"immutable"})).then(function(_){var k=$.map(function(B,O){var K,q,M,V=_[O],Y={onerror:null,onsuccess:null};return d.type==="delete"?u.fire.call(Y,B,V,v):d.type==="add"||V===void 0?(K=h.fire.call(Y,B,d.values[O],v),B==null&&K!=null&&(d.keys[O]=B=K,r.outbound||st(d.values[O],r.keyPath,B))):(K=er(V,d.values[O]),(q=x.fire.call(Y,K,B,V,v))&&(M=d.values[O],Object.keys(q).forEach(function(I){ie(M,I)?M[I]=q[I]:st(M,I,q[I])}))),Y});return n.mutate(d).then(function(B){for(var O=B.failures,K=B.results,q=B.numFailures,B=B.lastResult,M=0;M<$.length;++M){var V=(K||$)[M],Y=k[M];V==null?Y.onerror&&Y.onerror(O[M]):Y.onsuccess&&Y.onsuccess(d.type==="put"&&_[M]?d.values[M]:V)}return{failures:O,results:K,numFailures:q,lastResult:B}}).catch(function(B){return k.forEach(function(O){return O.onerror&&O.onerror(B)}),Promise.reject(B)})});throw new Error("Keys missing")}}})}})}};function un(e,t,n){try{if(!t||t.keys.length<e.length)return null;for(var r=[],a=0,s=0;a<t.keys.length&&s<e.length;++a)W(t.keys[a],e[s])===0&&(r.push(n?en(t.values[a]):t.values[a]),++s);return r.length===e.length?r:null}catch{return null}}var jr={stack:"dbcore",level:-1,create:function(e){return{table:function(t){var n=e.table(t);return G(G({},n),{getMany:function(r){var a;return r.cache?(a=un(r.keys,r.trans._cache,r.cache==="clone"))?R.resolve(a):n.getMany(r).then(function(s){return r.trans._cache={keys:r.keys,values:r.cache==="clone"?en(s):s},s}):n.getMany(r)},mutate:function(r){return r.type!=="add"&&(r.trans._cache=null),n.mutate(r)}})}}}};function Rr(e,t){return e.trans.mode==="readonly"&&!!e.subscr&&!e.trans.explicit&&e.trans.db._options.cache!=="disabled"&&!t.schema.primaryKey.outbound}function Yr(e,t){switch(e){case"query":return t.values&&!t.unique;case"get":case"getMany":case"count":case"openCursor":return!1}}var ia={stack:"dbcore",level:0,name:"Observability",create:function(e){var t=e.schema.name,n=new We(e.MIN_KEY,e.MAX_KEY);return G(G({},e),{transaction:function(r,a,s){if(J.subscr&&a!=="readonly")throw new H.ReadOnly("Readwrite transaction in liveQuery context. Querier source: ".concat(J.querier));return e.transaction(r,a,s)},table:function(r){function a($){var v,$=$.query;return[v=$.index,new We((v=($=$.range).lower)!=null?v:e.MIN_KEY,(v=$.upper)!=null?v:e.MAX_KEY)]}var s=e.table(r),i=s.schema,u=i.primaryKey,h=i.indexes,x=u.extractKey,p=u.outbound,d=u.autoIncrement&&h.filter(function(m){return m.compound&&m.keyPath.includes(u.keyPath)}),f=G(G({},s),{mutate:function(m){function v(z){return z="idb://".concat(t,"/").concat(r,"/").concat(z),O[z]||(O[z]=new We)}var $,_,k,B=m.trans,O=m.mutatedParts||(m.mutatedParts={}),K=v(""),q=v(":dels"),M=m.type,Y=m.type==="deleteRange"?[m.range]:m.type==="delete"?[m.keys]:m.values.length<50?[tr(u,m).filter(function(z){return z}),m.values]:[],V=Y[0],Y=Y[1],I=m.trans._cache;return ae(V)?(K.addKeys(V),(M=M==="delete"||V.length===Y.length?un(V,I):null)||q.addKeys(V),(M||Y)&&($=v,_=M,k=Y,i.indexes.forEach(function(z){var he=$(z.name||"");function ve(oe){return oe!=null?z.extractKey(oe):null}function Q(oe){z.multiEntry&&ae(oe)?oe.forEach(function(Oe){return he.addKey(Oe)}):he.addKey(oe)}(_||k).forEach(function(oe,Ie){var Mt=_&&ve(_[Ie]),Ie=k&&ve(k[Ie]);W(Mt,Ie)!==0&&(Mt!=null&&Q(Mt),Ie!=null)&&Q(Ie)})}))):V?(Y={from:(I=V.lower)!=null?I:e.MIN_KEY,to:(M=V.upper)!=null?M:e.MAX_KEY},q.add(Y),K.add(Y)):(K.add(n),q.add(n),i.indexes.forEach(function(z){return v(z.name).add(n)})),s.mutate(m).then(function(z){return!V||m.type!=="add"&&m.type!=="put"||(K.addKeys(z.results),d&&d.forEach(function(he){for(var ve=m.values.map(function(Mt){return he.extractKey(Mt)}),Q=he.keyPath.findIndex(function(Mt){return Mt===u.keyPath}),oe=0,Oe=z.results.length;oe<Oe;++oe)ve[oe][Q]=z.results[oe];v(he.name).addKeys(ve)})),B.mutatedParts=Ye(B.mutatedParts||{},O),z})}}),C={get:function(m){return[u,new We(m.key)]},getMany:function(m){return[u,new We().addKeys(m.keys)]},count:a,query:a,openCursor:a};return me(C).forEach(function(m){f[m]=function(v){var $=J.subscr,_=!!$,k=Rr(J,s)&&Yr(m,v)?v.obsSet={}:$;if(_){var B,$=function(Y){return Y="idb://".concat(t,"/").concat(r,"/").concat(Y),k[Y]||(k[Y]=new We)},O=$(""),K=$(":dels"),_=C[m](v),q=_[0],_=_[1];if((m==="query"&&q.isPrimaryKey&&!v.values?K:$(q.name||"")).add(_),!q.isPrimaryKey){if(m!=="count")return B=m==="query"&&p&&v.values&&s.query(G(G({},v),{values:!1})),s[m].apply(this,arguments).then(function(Y){if(m==="query"){if(p&&v.values)return B.then(function(ve){return ve=ve.result,O.addKeys(ve),Y});var I=v.values?Y.result.map(x):Y.result;(v.values?O:K).addKeys(I)}else{var z,he;if(m==="openCursor")return he=v.values,(z=Y)&&Object.create(z,{key:{get:function(){return K.addKey(z.primaryKey),z.key}},primaryKey:{get:function(){var ve=z.primaryKey;return K.addKey(ve),ve}},value:{get:function(){return he&&O.addKey(z.primaryKey),z.value}}})}return Y});K.add(n)}}return s[m].apply(this,arguments)}}),f}})}};function Vr(e,t,n){var r;return n.numFailures===0?t:t.type==="deleteRange"||(r=t.keys?t.keys.length:"values"in t&&t.values?t.values.length:1,n.numFailures===r)?null:(r=G({},t),ae(r.keys)&&(r.keys=r.keys.filter(function(a,s){return!(s in n.failures)})),"values"in r&&ae(r.values)&&(r.values=r.values.filter(function(a,s){return!(s in n.failures)})),r)}function nr(e,t){return n=e,((r=t).lower===void 0||(r.lowerOpen?0<W(n,r.lower):0<=W(n,r.lower)))&&(n=e,(r=t).upper===void 0||(r.upperOpen?W(n,r.upper)<0:W(n,r.upper)<=0));var n,r}function zr(e,t,n,r,a,s){var i,u,h,x,p,d;return!n||n.length===0||(i=t.query.index,u=i.multiEntry,h=t.query.range,x=r.schema.primaryKey.extractKey,p=i.extractKey,d=(i.lowLevelIndex||i).extractKey,(r=n.reduce(function(f,C){var m=f,v=[];if(C.type==="add"||C.type==="put")for(var $=new We,_=C.values.length-1;0<=_;--_){var k,B=C.values[_],O=x(B);!$.hasKey(O)&&(k=p(B),u&&ae(k)?k.some(function(Y){return nr(Y,h)}):nr(k,h))&&($.addKey(O),v.push(B))}switch(C.type){case"add":var K=new We().addKeys(t.values?f.map(function(I){return x(I)}):f),m=f.concat(t.values?v.filter(function(I){return I=x(I),!K.hasKey(I)&&(K.addKey(I),!0)}):v.map(function(I){return x(I)}).filter(function(I){return!K.hasKey(I)&&(K.addKey(I),!0)}));break;case"put":var q=new We().addKeys(C.values.map(function(I){return x(I)}));m=f.filter(function(I){return!q.hasKey(t.values?x(I):I)}).concat(t.values?v:v.map(function(I){return x(I)}));break;case"delete":var M=new We().addKeys(C.keys);m=f.filter(function(I){return!M.hasKey(t.values?x(I):I)});break;case"deleteRange":var V=C.range;m=f.filter(function(I){return!nr(x(I),V)})}return m},e))===e)?e:(r.sort(function(f,C){return W(d(f),d(C))||W(x(f),x(C))}),t.limit&&t.limit<1/0&&(r.length>t.limit?r.length=t.limit:e.length===t.limit&&r.length<t.limit&&(a.dirty=!0)),s?Object.freeze(r):r)}function o(e,t){return W(e.lower,t.lower)===0&&W(e.upper,t.upper)===0&&!!e.lowerOpen==!!t.lowerOpen&&!!e.upperOpen==!!t.upperOpen}function D(e,t){return((n,r,a,s)=>{if(n===void 0)return r!==void 0?-1:0;if(r===void 0)return 1;if((n=W(n,r))===0){if(a&&s)return 0;if(a)return 1;if(s)return-1}return n})(e.lower,t.lower,e.lowerOpen,t.lowerOpen)<=0&&0<=((n,r,a,s)=>{if(n===void 0)return r!==void 0?1:0;if(r===void 0)return-1;if((n=W(n,r))===0){if(a&&s)return 0;if(a)return-1;if(s)return 1}return n})(e.upper,t.upper,e.upperOpen,t.upperOpen)}function te(e,t,n,r){e.subscribers.add(n),r.addEventListener("abort",function(){var a,s;e.subscribers.delete(n),e.subscribers.size===0&&(a=e,s=t,setTimeout(function(){a.subscribers.size===0&&Vt(s,a)},3e3))})}var pe={stack:"dbcore",level:0,name:"Cache",create:function(e){var t=e.schema.name;return G(G({},e),{transaction:function(n,r,a){var s,i,u=e.transaction(n,r,a);return r==="readwrite"&&(a=(s=new AbortController).signal,u.addEventListener("abort",(i=function(h){return function(){if(s.abort(),r==="readwrite"){for(var x=new Set,p=0,d=n;p<d.length;p++){var f=d[p],C=Qt["idb://".concat(t,"/").concat(f)];if(C){var m=e.table(f),v=C.optimisticOps.filter(function(z){return z.trans===u});if(u._explicit&&h&&u.mutatedParts)for(var $=0,_=Object.values(C.queries.query);$<_.length;$++)for(var k=0,B=(q=_[$]).slice();k<B.length;k++)Cr((M=B[k]).obsSet,u.mutatedParts)&&(Vt(q,M),M.subscribers.forEach(function(z){return x.add(z)}));else if(0<v.length){C.optimisticOps=C.optimisticOps.filter(function(z){return z.trans!==u});for(var O=0,K=Object.values(C.queries.query);O<K.length;O++)for(var q,M,V,Y=0,I=(q=K[O]).slice();Y<I.length;Y++)(M=I[Y]).res!=null&&u.mutatedParts&&(h&&!M.dirty?(V=Object.isFrozen(M.res),V=zr(M.res,M.req,v,m,M,V),M.dirty?(Vt(q,M),M.subscribers.forEach(function(z){return x.add(z)})):V!==M.res&&(M.res=V,M.promise=R.resolve({result:V}))):(M.dirty&&Vt(q,M),M.subscribers.forEach(function(z){return x.add(z)})))}}}x.forEach(function(z){return z()})}}})(!1),{signal:a}),u.addEventListener("error",i(!1),{signal:a}),u.addEventListener("complete",i(!0),{signal:a})),u},table:function(n){var r=e.table(n),a=r.schema.primaryKey;return G(G({},r),{mutate:function(s){var i,u=J.trans;return!a.outbound&&u.db._options.cache!=="disabled"&&!u.explicit&&u.idbtrans.mode==="readwrite"&&(i=Qt["idb://".concat(t,"/").concat(n)])?(u=r.mutate(s),s.type!=="add"&&s.type!=="put"||!(50<=s.values.length||tr(a,s).some(function(h){return h==null}))?(i.optimisticOps.push(s),s.mutatedParts&&Zn(s.mutatedParts),u.then(function(h){0<h.numFailures&&(Vt(i.optimisticOps,s),(h=Vr(0,s,h))&&i.optimisticOps.push(h),s.mutatedParts)&&Zn(s.mutatedParts)}),u.catch(function(){Vt(i.optimisticOps,s),s.mutatedParts&&Zn(s.mutatedParts)})):u.then(function(h){var x=Vr(0,G(G({},s),{values:s.values.map(function(p,d){var f;return h.failures[d]?p:(st(f=(f=a.keyPath)!=null&&f.includes(".")?en(p):G({},p),a.keyPath,h.results[d]),f)})}),h);i.optimisticOps.push(x),queueMicrotask(function(){return s.mutatedParts&&Zn(s.mutatedParts)})}),u):r.mutate(s)},query:function(s){var i,u,h,x,p,d,f;return Rr(J,r)&&Yr("query",s)?(i=((h=J.trans)==null?void 0:h.db._options.cache)==="immutable",u=(h=J).requery,h=h.signal,d=((C,m,v,$)=>{var _=Qt["idb://".concat(C,"/").concat(m)];if(!_)return[];if(!(C=_.queries[v]))return[null,!1,_,null];var k=C[($.query?$.query.index.name:null)||""];if(!k)return[null,!1,_,null];switch(v){case"query":var B=k.find(function(O){return O.req.limit===$.limit&&O.req.values===$.values&&o(O.req.query.range,$.query.range)});return B?[B,!0,_,k]:[k.find(function(O){return("limit"in O.req?O.req.limit:1/0)>=$.limit&&(!$.values||O.req.values)&&D(O.req.query.range,$.query.range)}),!1,_,k];case"count":return B=k.find(function(O){return o(O.req.query.range,$.query.range)}),[B,!!B,_,k]}})(t,n,"query",s),f=d[0],x=d[2],p=d[3],f&&d[1]?f.obsSet=s.obsSet:(d=r.query(s).then(function(C){var m=C.result;if(f&&(f.res=m),i){for(var v=0,$=m.length;v<$;++v)Object.freeze(m[v]);Object.freeze(m)}else C.result=en(m);return C}).catch(function(C){return p&&f&&Vt(p,f),Promise.reject(C)}),f={obsSet:s.obsSet,promise:d,subscribers:new Set,type:"query",req:s,dirty:!1},p?p.push(f):(p=[f],(x=x||(Qt["idb://".concat(t,"/").concat(n)]={queries:{query:{},count:{}},objs:new Map,optimisticOps:[],unsignaledParts:{}})).queries.query[s.query.index.name||""]=p)),te(f,p,u,h),f.promise.then(function(C){return{result:zr(C.result,s,x?.optimisticOps,r,f,i)}})):r.query(s)}})}})}};function Ee(e,t){return new Proxy(e,{get:function(n,r,a){return r==="db"?t:Reflect.get(n,r,a)}})}Ce.prototype.version=function(e){if(isNaN(e)||e<.1)throw new H.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new H.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,n=t.filter(function(r){return r._cfg.version===e})[0];return n||(n=new this.Version(e),t.push(n),t.sort(na),n.stores({}),this._state.autoSchema=!1),n},Ce.prototype._whenReady=function(e){var t=this;return this.idbdb&&(this._state.openComplete||J.letThrough||this._vip)?e():new R(function(n,r){if(t._state.openComplete)return r(new H.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._state.autoOpen)return void r(new H.DatabaseClosed);t.open().catch(ge)}t._state.dbReadyPromise.then(n,r)}).then(e)},Ce.prototype.use=function(a){var t=a.stack,n=a.create,r=a.level,a=a.name,s=(a&&this.unuse({stack:t,name:a}),this._middlewares[t]||(this._middlewares[t]=[]));return s.push({stack:t,create:n,level:r??10,name:a}),s.sort(function(i,u){return i.level-u.level}),this},Ce.prototype.unuse=function(e){var t=e.stack,n=e.name,r=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter(function(a){return r?a.create!==r:!!n&&a.name!==n})),this},Ce.prototype.open=function(){var e=this;return an(Dt,function(){return sa(e)})},Ce.prototype._close=function(){this.on.close.fire(new CustomEvent("close"));var e=this._state,t=w.indexOf(this);if(0<=t&&w.splice(t,1),this.idbdb){try{this.idbdb.close()}catch{}this.idbdb=null}e.isBeingOpened||(e.dbReadyPromise=new R(function(n){e.dbReadyResolve=n}),e.openCanceller=new R(function(n,r){e.cancelOpen=r}))},Ce.prototype.close=function(t){var t=(t===void 0?{disableAutoOpen:!0}:t).disableAutoOpen,n=this._state;t?(n.isBeingOpened&&n.cancelOpen(new H.DatabaseClosed),this._close(),n.autoOpen=!1,n.dbOpenError=new H.DatabaseClosed):(this._close(),n.autoOpen=this._options.autoOpen||n.isBeingOpened,n.openComplete=!1,n.dbOpenError=null)},Ce.prototype.delete=function(e){var t=this,n=(e===void 0&&(e={disableAutoOpen:!0}),0<arguments.length&&typeof arguments[0]!="object"),r=this._state;return new R(function(a,s){function i(){t.close(e);var u=t._deps.indexedDB.deleteDatabase(t.name);u.onsuccess=we(function(){var h,x,p;h=t._deps,x=t.name,gr(p=h.indexedDB)||x===T||Re(p,h.IDBKeyRange).delete(x).catch(ge),a()}),u.onerror=be(s),u.onblocked=t._fireOnBlocked}if(n)throw new H.InvalidArgument("Invalid closeOptions argument to db.delete()");r.isBeingOpened?r.dbReadyPromise.then(i):i()})},Ce.prototype.backendDB=function(){return this.idbdb},Ce.prototype.isOpen=function(){return this.idbdb!==null},Ce.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"},Ce.prototype.hasFailed=function(){return this._state.dbOpenError!==null},Ce.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(Ce.prototype,"tables",{get:function(){var e=this;return me(this._allTables).map(function(t){return e._allTables[t]})},enumerable:!1,configurable:!0}),Ce.prototype.transaction=function(){var e=(function(t,n,r){var a=arguments.length;if(a<2)throw new H.InvalidArgument("Too few arguments");for(var s=new Array(a-1);--a;)s[a-1]=arguments[a];return r=s.pop(),[t,ut(s),r]}).apply(this,arguments);return this._transaction.apply(this,e)},Ce.prototype._transaction=function(e,t,n){var r,a,s=this,i=J.trans,u=(i&&i.db===this&&e.indexOf("!")===-1||(i=null),e.indexOf("?")!==-1);e=e.replace("!","").replace("?","");try{if(a=t.map(function(x){if(x=x instanceof s.Table?x.name:x,typeof x!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return x}),e=="r"||e===L)r=L;else{if(e!="rw"&&e!=j)throw new H.InvalidArgument("Invalid transaction mode: "+e);r=j}if(i){if(i.mode===L&&r===j){if(!u)throw new H.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(function(x){if(i&&i.storeNames.indexOf(x)===-1){if(!u)throw new H.SubTransaction("Table "+x+" not included in parent transaction.");i=null}}),u&&i&&!i.active&&(i=null)}}catch(x){return i?i._promise(null,function(p,d){d(x)}):l(x)}var h=(function x(p,d,f,C,m){return R.resolve().then(function(){var k=J.transless||J,v=p._createTransaction(d,f,p._dbSchema,C),k=(v.explicit=!0,{trans:v,transless:k});if(C)v.idbtrans=C.idbtrans;else try{v.create(),v.idbtrans._explicit=!0,p._state.PR1398_maxLoop=3}catch(B){return B.name===ir.InvalidState&&p.isOpen()&&0<--p._state.PR1398_maxLoop?(console.warn("Dexie: Need to reopen db"),p.close({disableAutoOpen:!1}),p.open().then(function(){return x(p,d,f,null,m)})):l(B)}var $,_=sr(m),k=(_&&rn(),R.follow(function(){var B;($=m.call(v,v))&&(_?(B=Gt.bind(null,null),$.then(B,B)):typeof $.next=="function"&&typeof $.throw=="function"&&($=kr($)))},k));return($&&typeof $.then=="function"?R.resolve($).then(function(B){return v.active?B:l(new H.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):k.then(function(){return $})).then(function(B){return C&&v._resolve(),v._completion.then(function(){return B})}).catch(function(B){return v._reject(B),l(B)})})}).bind(null,this,r,a,i,n);return i?i._promise(r,h,"lock"):J.trans?an(J.transless,function(){return s._whenReady(h)}):this._whenReady(h)},Ce.prototype.table=function(e){if(ie(this._allTables,e))return this._allTables[e];throw new H.InvalidTable("Table ".concat(e," does not exist"))};var $e=Ce;function Ce(e,t){var n,r,a,s,i,u=this,h=(this._middlewares={},this.verno=0,Ce.dependencies),h=(this._options=t=G({addons:Ce.addons,autoOpen:!0,indexedDB:h.indexedDB,IDBKeyRange:h.IDBKeyRange,cache:"cloned"},t),this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange},t.addons),x=(this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this,{dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ge,dbReadyPromise:null,cancelOpen:ge,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3,autoOpen:t.autoOpen}),p=(x.dbReadyPromise=new R(function(d){x.dbReadyResolve=d}),x.openCanceller=new R(function(d,f){x.cancelOpen=f}),this._state=x,this.name=e,this.on=qe(this,"populate","blocked","versionchange","close",{ready:[$n,ge]}),this.once=function(d,f){var C=function(){for(var m=[],v=0;v<arguments.length;v++)m[v]=arguments[v];u.on(d).unsubscribe(C),f.apply(u,m)};return u.on(d,C)},this.on.ready.subscribe=_r(this.on.ready.subscribe,function(d){return function(f,C){Ce.vip(function(){var m,v=u._state;v.openComplete?(v.dbOpenError||R.resolve().then(f),C&&d(f)):v.onReadyBeingFired?(v.onReadyBeingFired.push(f),C&&d(f)):(d(f),m=u,C||d(function $(){m.on.ready.unsubscribe(f),m.on.ready.unsubscribe($)}))})}}),this.Collection=(n=this,N(dt.prototype,function($,v){this.db=n;var C=X,m=null;if(v)try{C=v()}catch(k){m=k}var v=$._ctx,$=v.table,_=$.hook.reading.fire;this._ctx={table:$,index:v.index,isPrimKey:!v.index||$.schema.primKey.keyPath&&v.index===$.schema.primKey.name,range:C,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:m,or:v.or,valueMapper:_!==zt?_:null}})),this.Table=(r=this,N(ze.prototype,function(d,f,C){this.db=r,this._tx=C,this.name=d,this.schema=f,this.hook=r._allTables[d]?r._allTables[d].hook:qe(null,{creating:[Ln,ge],reading:[Ke,zt],updating:[Xr,ge],deleting:[jn,ge]})})),this.Transaction=(a=this,N(Wn.prototype,function(d,f,C,m,v){var $=this;d!=="readonly"&&f.forEach(function(_){_=(_=C[_])==null?void 0:_.yProps,_&&(f=f.concat(_.map(function(k){return k.updatesTable})))}),this.db=a,this.mode=d,this.storeNames=f,this.schema=C,this.chromeTransactionDurability=m,this.idbtrans=null,this.on=qe(this,"complete","error","abort"),this.parent=v||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new R(function(_,k){$._resolve=_,$._reject=k}),this._completion.then(function(){$.active=!1,$.on.complete.fire()},function(_){var k=$.active;return $.active=!1,$.on.error.fire(_),$.parent?$.parent._reject(_):k&&$.idbtrans&&$.idbtrans.abort(),l(_)})})),this.Version=(s=this,N(ht.prototype,function(d){this.db=s,this._cfg={version:d,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})),this.WhereClause=(i=this,N(ye.prototype,function(d,f,C){if(this.db=i,this._ctx={table:d,index:f===":id"?null:f,or:C},this._cmp=this._ascending=W,this._descending=function(m,v){return W(v,m)},this._max=function(m,v){return 0<W(m,v)?m:v},this._min=function(m,v){return W(m,v)<0?m:v},this._IDBKeyRange=i._deps.IDBKeyRange,!this._IDBKeyRange)throw new H.MissingAPI})),this.on("versionchange",function(d){0<d.newVersion?console.warn("Another connection wants to upgrade database '".concat(u.name,"'. Closing db now to resume the upgrade.")):console.warn("Another connection wants to delete database '".concat(u.name,"'. Closing db now to resume the delete request.")),u.close({disableAutoOpen:!1})}),this.on("blocked",function(d){!d.newVersion||d.newVersion<d.oldVersion?console.warn("Dexie.delete('".concat(u.name,"') was blocked")):console.warn("Upgrade '".concat(u.name,"' blocked by other connection holding version ").concat(d.oldVersion/10))}),this._maxKey=sn(t.IDBKeyRange),this._createTransaction=function(d,f,C,m){return new u.Transaction(d,f,C,u._options.chromeTransactionDurability,m)},this._fireOnBlocked=function(d){u.on("blocked").fire(d),w.filter(function(f){return f.name===u.name&&f!==u&&!f._state.vcFired}).map(function(f){return f.on("versionchange").fire(d)})},this.use(jr),this.use(pe),this.use(ia),this.use(qr),this.use(Lr),new Proxy(this,{get:function(d,f,C){var m;return f==="_vip"||(f==="table"?function(v){return Ee(u.table(v),p)}:(m=Reflect.get(d,f,C))instanceof ze?Ee(m,p):f==="tables"?m.map(function(v){return Ee(v,p)}):f==="_createTransaction"?function(){return Ee(m.apply(this,arguments),p)}:m)}}));this.vip=p,h.forEach(function(d){return d(u)})}var Je,Lt=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable",Tn=(Cn.prototype.subscribe=function(e,t,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:t,complete:n})},Cn.prototype[Lt]=function(){return this},Cn);function Cn(e){this._subscribe=e}try{Je={indexedDB:re.indexedDB||re.mozIndexedDB||re.webkitIndexedDB||re.msIndexedDB,IDBKeyRange:re.IDBKeyRange||re.webkitIDBKeyRange}}catch{Je={indexedDB:null,IDBKeyRange:null}}function Dn(e){var t,n=!1,r=new Tn(function(a){var s=sr(e),i,u=!1,h={},x={},p={get closed(){return u},unsubscribe:function(){u||(u=!0,i&&i.abort(),d&&ot.storagemutated.unsubscribe(C))}},d=(a.start&&a.start(p),!1),f=function(){return hr(m)},C=function(v){Ye(h,v),Cr(x,h)&&f()},m=function(){var v,$,_;!u&&Je.indexedDB&&(h={},v={},i&&i.abort(),i=new AbortController,_=(k=>{var B=mn();try{s&&rn();var O=Ut(e,k);return O=s?O.finally(Gt):O}finally{B&&gn()}})($={subscr:v,signal:i.signal,requery:f,querier:e,trans:null}),Promise.resolve(_).then(function(k){n=!0,t=k,u||$.signal.aborted||(h={},(B=>{for(var O in B)if(ie(B,O))return;return 1})(x=v)||d||(ot(A,C),d=!0),hr(function(){return!u&&a.next&&a.next(k)}))},function(k){n=!1,["DatabaseClosedError","AbortError"].includes(k?.name)||u||hr(function(){u||a.error&&a.error(k)})}))};return setTimeout(f,0),p});return r.hasValue=function(){return n},r.getValue=function(){return t},r}var Ot=$e;function wn(e){var t=jt;try{jt=!0,ot.storagemutated.fire(e),qt(e,!0)}finally{jt=t}}Qe(Ot,G(G({},Et),{delete:function(e){return new Ot(e,{addons:[]}).delete()},exists:function(e){return new Ot(e,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(e){try{return t=Ot.dependencies,n=t.indexedDB,t=t.IDBKeyRange,(gr(n)?Promise.resolve(n.databases()).then(function(r){return r.map(function(a){return a.name}).filter(function(a){return a!==T})}):Re(n,t).toCollection().primaryKeys()).then(e)}catch{return l(new H.MissingAPI)}var t,n},defineClass:function(){return function(e){de(this,e)}},ignoreTransaction:function(e){return J.trans?an(J.transless,e):e()},vip:Kt,async:function(e){return function(){try{var t=kr(e.apply(this,arguments));return t&&typeof t.then=="function"?t:R.resolve(t)}catch(n){return l(n)}}},spawn:function(e,t,n){try{var r=kr(e.apply(n,t||[]));return r&&typeof r.then=="function"?r:R.resolve(r)}catch(a){return l(a)}},currentTransaction:{get:function(){return J.trans||null}},waitFor:function(e,t){return e=R.resolve(typeof e=="function"?Ot.ignoreTransaction(e):e).timeout(t||6e4),J.trans?J.trans.waitFor(e):e},Promise:R,debug:{get:function(){return mt},set:function(e){Or(e)}},derive:kt,extend:de,props:Qe,override:_r,Events:qe,on:ot,liveQuery:Dn,extendObservabilitySet:Ye,getByKeyPath:$t,setByKeyPath:st,delByKeyPath:function(e,t){typeof t=="string"?st(e,t,void 0):"length"in t&&[].map.call(t,function(n){st(e,n,void 0)})},shallowClone:Tt,deepClone:en,getObjectDiff:er,cmp:W,asap:Er,minKey:-1/0,addons:[],connections:w,errnames:ir,dependencies:Je,cache:Qt,semVer:"4.3.0",version:"4.3.0".split(".").map(function(e){return parseInt(e)}).reduce(function(e,t,n){return e+t/Math.pow(10,2*n)})})),Ot.maxKey=sn(Ot.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ot(A,function(e){jt||(e=new CustomEvent(at,{detail:e}),jt=!0,dispatchEvent(e),jt=!1)}),addEventListener(at,function(e){e=e.detail,jt||wn(e)}));var cn,jt=!1,$r=function(){};return typeof BroadcastChannel<"u"&&(($r=function(){(cn=new BroadcastChannel(at)).onmessage=function(e){return e.data&&wn(e.data)}})(),typeof cn.unref=="function"&&cn.unref(),ot(A,function(e){jt||cn.postMessage(e)})),typeof addEventListener<"u"&&(addEventListener("pagehide",function(e){if(!$e.disableBfCache&&e.persisted){mt&&console.debug("Dexie: handling persisted pagehide"),cn?.close();for(var t=0,n=w;t<n.length;t++)n[t].close({disableAutoOpen:!1})}}),addEventListener("pageshow",function(e){!$e.disableBfCache&&e.persisted&&(mt&&console.debug("Dexie: handling persisted pageshow"),$r(),wn({all:new We(-1/0,[[]])}))})),R.rejectionMapper=function(e,t){return!e||e instanceof hn||e instanceof TypeError||e instanceof SyntaxError||!e.name||!kn[e.name]?e:(t=new kn[e.name](t||e.message,e),"stack"in e&&vt(t,"stack",{get:function(){return this.inner.stack}}),t)},Or(mt),G($e,Object.freeze({__proto__:null,Dexie:$e,Entity:Z,PropModification:fe,RangeSet:We,add:function(e){return new fe({add:e})},cmp:W,default:$e,liveQuery:Dn,mergeRanges:ln,rangesOverlap:br,remove:function(e){return new fe({remove:e})},replacePrefix:function(e,t){return new fe({replacePrefix:[e,t]})}}),{default:$e}),$e})})(Ur)),Ur.exports}var Oa=Pa();const la=Sa(Oa),ga=Symbol.for("Dexie"),Gr=globalThis[ga]||(globalThis[ga]=la);if(la.semVer!==Gr.semVer)throw new Error(`Two different versions of Dexie loaded in the same app: ${la.semVer} and ${Gr.semVer}`);const{liveQuery:Ra,mergeRanges:Ya,rangesOverlap:Va,RangeSet:za,cmp:Ua,Entity:Ga,PropModification:Wa,replacePrefix:Ja,add:Ha,remove:Xa,DexieYProvider:Qa}=Gr,At=new Gr("haushaltsbuch-db");At.version(1).stores({years:"year",fixedTemplateState:"id"});const ua="singleton";function Ca(){return new Date().toISOString()}async function Nn(){return At.years.orderBy("year").toArray()}async function Ma(P){return At.years.get(P)}async function Fn(P){await At.years.put(P)}async function ca(){const P=await At.fixedTemplateState.get(ua);if(!P){const g={id:ua,templates:[],version:Ca(),updatedAt:new Date().toISOString()};return await At.fixedTemplateState.put(g),{templates:[],version:g.version}}return{templates:P.templates,version:P.version}}async function da(P){const g=Ca();return await At.fixedTemplateState.put({id:ua,templates:P,version:g,updatedAt:new Date().toISOString()}),g}async function Aa(){const P=await Nn(),g=await ca();return{exportedAt:new Date().toISOString(),years:P,fixedTemplates:g.templates}}async function Ta(P){await At.transaction("rw",[At.years,At.fixedTemplateState],async()=>{await At.years.clear(),await At.years.bulkPut(P.years),await da(P.fixedTemplates)})}function Me(P){const g=P.replace(",",".").trim();if(!g)return 0;const Se=Number.parseFloat(g);return Number.isNaN(Se)?0:Math.round(Se*100)}const Da=new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2,useGrouping:!0});function E(P){return Da.format(P/100)}function pt(P){return(P/100).toFixed(2)}function lt(P){return new Date(2026,P-1,1).toLocaleDateString("de-DE",{month:"long"})}const wa=["light","dark","forest","sage-light","mint-light","pine-light","pine-dark","midnight","graphite","violet-night","ocean-dark","ember-dark","neon-dark","slate-dark","plum-dark","moss-dark","cyber-dark"];function ba(P){return wa.includes(P)}function Ia(P){switch(P){case"light":return"Light";case"dark":return"Dark";case"forest":return"Forest";case"sage-light":return"Sage Light";case"mint-light":return"Mint Light";case"pine-light":return"Pine Light";case"pine-dark":return"Pine Dark";case"midnight":return"Midnight";case"graphite":return"Graphite";case"violet-night":return"Violet Night";case"ocean-dark":return"Ocean Dark";case"ember-dark":return"Ember Dark";case"neon-dark":return"Neon Dark";case"slate-dark":return"Slate Dark";case"plum-dark":return"Plum Dark";case"moss-dark":return"Moss Dark";case"cyber-dark":return"Cyber Dark"}}function Fa(P){const g={years:[],selectedYear:null,selectedMonth:1,fixedTemplates:[],fixedTemplateVersion:"",editingFixedTemplateId:null,theme:"light",hasUnexportedChanges:!1,unexportedChangeLog:[],showUnexportedChangeLogModal:!1,lastBackupFileName:null,topModal:null,dashboardTab:"year",dashboardYear:null,recurringBudgetDefaults:{foodBudgetCents:null,goingOutBudgetCents:null,fixedBudgetCents:null,variableBudgetCents:null,miscBudgetCents:null}},Se="habu-theme",G="habu-backup-dirty",ce="habu-unexported-change-log",re="habu-last-backup-filename",me="habu-recurring-budget-defaults";let ae=null,de=null,He=null,Xe=!1,ie=!1;const Qe=new WeakMap;function Ze(){const l=P.querySelectorAll("[data-budget-vs-canvas]");if(l.length===0)return;const c=getComputedStyle(document.documentElement),b=c.getPropertyValue("--text-main").trim(),y=c.getPropertyValue("--text-muted").trim(),w=c.getPropertyValue("--table-stripe").trim(),T=c.getPropertyValue("--table-border").trim(),L=c.getPropertyValue("--budget-under").trim(),j=c.getPropertyValue("--danger-2").trim(),F=96,X=250,U=Z=>1-Math.pow(1-Math.max(0,Math.min(1,Z)),3);l.forEach(Z=>{Z.dataset.hoverBound!=="1"&&(Z.dataset.hoverBound="1",Z.addEventListener("mouseenter",()=>{Z.dataset.hovering="1",Ze()}),Z.addEventListener("mouseleave",()=>{delete Z.dataset.hovering,delete Z.dataset.hoverX,Ze()}),Z.addEventListener("mousemove",ye=>{const ne=Z.getBoundingClientRect(),be=Math.round(ye.clientX-ne.left);Z.dataset.hoverX=String(be),Ze()}));const W=Number.parseInt(Z.dataset.budgetCents??"0",10),Pe=Number.parseInt(Z.dataset.actualCents??"0",10),tt=Z.dataset.label??"Kategorie",Fe=Z.dataset.hovering==="1",fe=`${tt}|${W}|${Pe}`,bt=Z.dataset.lastRenderSignature!==fe;Z.dataset.lastRenderSignature=fe;const Ne=Math.max(120,Math.floor(Z.clientWidth||120)),ze=window.devicePixelRatio||1,le=Math.floor(Ne*ze),qe=Math.floor(F*ze);(Z.width!==le||Z.height!==qe)&&(Z.width=le,Z.height=qe);const N=Z.getContext("2d");if(!N)return;const Ae=Math.max(1,W,Pe),yt=Math.min(1,Math.max(0,W/Ae)),It=Math.min(1,Math.max(0,Pe/Ae)),ct=W-Pe,nt=W>0?Pe/W*100:Pe>0?100:0,it=8,Te=it,dt=34,ee=Ne-it*2,Le=22,je=Number.parseInt(Z.dataset.hoverX??"-1",10),wt=(ye,ne,be,S,A)=>{N.beginPath(),N.moveTo(ye+A,ne),N.lineTo(ye+be-A,ne),N.quadraticCurveTo(ye+be,ne,ye+be,ne+A),N.lineTo(ye+be,ne+S-A),N.quadraticCurveTo(ye+be,ne+S,ye+be-A,ne+S),N.lineTo(ye+A,ne+S),N.quadraticCurveTo(ye,ne+S,ye,ne+S-A),N.lineTo(ye,ne+A),N.quadraticCurveTo(ye,ne,ye+A,ne),N.closePath()},De=ye=>{N.setTransform(1,0,0,1,0,0),N.clearRect(0,0,Z.width,Z.height),N.scale(ze,ze),wt(Te,dt,ee,Le,8),N.fillStyle=w,N.fill(),N.strokeStyle=T,N.lineWidth=1,N.stroke();const ne=[.6,.25,.15],be=[.1,.16,.24];let S=0;ne.forEach((Ue,Ft)=>{const Jt=ee*Ue;N.save(),N.globalAlpha=be[Ft]??.1,N.fillStyle=y,N.fillRect(Te+S,dt,Jt,Le),N.restore(),S+=Jt});const A=W>0&&Pe>W?j:L,at=ee*It*ye;wt(Te,dt+3,at,Le-6,6),N.fillStyle=A,N.fill(),Fe&&(N.save(),N.strokeStyle=A,N.lineWidth=1.5,N.globalAlpha=.8,wt(Te-1,dt+2,Math.max(2,at+2),Le-4,7),N.stroke(),N.restore());const ot=Te+ee*yt;N.strokeStyle=b,N.lineWidth=Fe?3:2,N.beginPath(),N.moveTo(ot,dt-3),N.lineTo(ot,dt+Le+3),N.stroke(),Fe&&je>=Te&&je<=Te+ee&&(N.save(),N.strokeStyle=b,N.globalAlpha=.35,N.lineWidth=1,N.beginPath(),N.moveTo(je,dt-8),N.lineTo(je,dt+Le+8),N.stroke(),N.restore()),N.fillStyle=b,N.font="600 12px system-ui, -apple-system, sans-serif",N.textAlign="left",N.textBaseline="top",N.fillText(tt,Te,10);const Wn=nt*ye;if(N.fillStyle=nt>100?j:nt<100?L:y,N.textAlign="right",N.fillText(`${Wn.toFixed(0)}%`,Te+ee,10),N.fillStyle=y,N.font="500 11px system-ui, -apple-system, sans-serif",N.textAlign="left",N.textBaseline="top",N.fillText(`Ist ${E(Pe)} Â· Ziel ${E(W)} Â· Î ${ct>=0?"+":""}${E(ct)}`,Te,64),Fe){const Ue=`Nutzung ${nt.toFixed(1)}%`;N.font="600 11px system-ui, -apple-system, sans-serif";const Ft=8,Jt=5,ke=22,Ht=N.measureText(Ue).width+Ft*2,Jn=Number.isFinite(je)?je-Ht/2:Te+ee-Ht,Ge=Math.min(Te+ee-Ht,Math.max(Te,Jn)),Xt=dt-ke-8;N.save(),N.fillStyle=b,N.globalAlpha=.92,wt(Ge,Xt,Ht,ke,6),N.fill(),N.restore(),N.fillStyle=w,N.textAlign="left",N.textBaseline="top",N.fillText(Ue,Ge+Ft,Xt+Jt)}},rt=Qe.get(Z);if(rt&&window.cancelAnimationFrame(rt),!bt){De(1);return}const xt=performance.now(),ft=ye=>{const ne=ye-xt,be=Math.min(1,ne/X);if(De(U(be)),be<1){const S=window.requestAnimationFrame(ft);Qe.set(Z,S);return}Qe.delete(Z)},Pt=window.requestAnimationFrame(ft);Qe.set(Z,Pt)})}function vt(l){if(l==="dashboard"){const c=g.years.slice().sort((y,w)=>w.year-y.year);c.some(y=>y.year===g.dashboardYear)||(g.dashboardYear=g.selectedYear??c[0]?.year??null)}g.topModal=l,se()}function kt(){g.topModal&&(g.topModal=null,se())}function Wr(){g.showUnexportedChangeLogModal=!0,se()}function rr(){g.showUnexportedChangeLogModal&&(g.showUnexportedChangeLogModal=!1,se())}function Kn(){Xe||(Xe=!0,window.addEventListener("keydown",l=>{if(l.key==="Escape"){if(g.showUnexportedChangeLogModal){l.preventDefault(),rr();return}g.topModal&&(l.preventDefault(),kt())}}))}function _r(){const l=Math.max(0,document.documentElement.scrollHeight-window.innerHeight);if(l<=0)return!1;const c=l/6;return window.scrollY>c}function dn(){const l=P.querySelector("#scroll-up-btn");l&&l.classList.toggle("is-visible",_r())}function Er(){if(ie)return;ie=!0;const l=()=>{dn(),Ze()};window.addEventListener("scroll",l,{passive:!0}),window.addEventListener("resize",l)}function $t(){if(ae&&document.body.contains(ae))return ae;const l=document.getElementById("toast-root");if(l instanceof HTMLDivElement)return ae=l,l;const c=document.createElement("div");return c.id="toast-root",c.className="toast-root",c.setAttribute("aria-live","polite"),c.setAttribute("aria-atomic","true"),document.body.appendChild(c),ae=c,c}function st(){if(de&&document.body.contains(de))return de;const l=document.getElementById("amount-modal-root");if(l instanceof HTMLDivElement)return de=l,l;const c=document.createElement("div");return c.id="amount-modal-root",document.body.appendChild(c),de=c,c}function Tt(){if(!de){He=null;return}de.innerHTML="",He=null}function Sr(l,c){let b=l;const y=c.min;if(y){const T=Number.parseFloat(y);if(!Number.isNaN(T)){const L=Math.round(T*100);b=Math.max(b,L)}}const w=c.max;if(w){const T=Number.parseFloat(w);if(!Number.isNaN(T)){const L=Math.round(T*100);b=Math.min(b,L)}}return b}function ut(l){if(l.disabled)return;const c=st();Tt(),He=l;const b=Me(l.value||"0"),y="Betrag anpassen";c.innerHTML=`
      <div class="amount-modal-backdrop" role="dialog" aria-modal="true" aria-label="${y}">
        <div class="amount-modal card">
          <h3>${y}</h3>
          <div class="amount-modal-body">
            <div class="amount-modal-meta">
              <div>Aktuell: <strong>${E(b)} â¬</strong></div>
              <div>Neu (verrechnen): <strong id="amount-modal-next-delta">${E(b)} â¬</strong></div>
              <div>Neu (korrigieren): <strong id="amount-modal-next-overwrite">${E(b)} â¬</strong></div>
            </div>
            <label>
              Betrag (â¬)
              <input id="amount-modal-delta" type="number" step="0.01" value="0.00" />
            </label>
            <div class="amount-modal-actions">
              <button class="btn btn-quiet" id="amount-modal-cancel" type="button">Abbrechen</button>
              <button class="btn" id="amount-modal-overwrite" type="button">Korrigieren</button>
              <button class="btn btn-primary" id="amount-modal-apply" type="button">Verrechnen</button>
            </div>
          </div>
        </div>
      </div>
    `;const w=c.querySelector(".amount-modal-backdrop"),T=c.querySelector("#amount-modal-delta"),L=c.querySelector("#amount-modal-next-delta"),j=c.querySelector("#amount-modal-next-overwrite"),F=c.querySelector("#amount-modal-cancel"),X=c.querySelector("#amount-modal-overwrite"),U=c.querySelector("#amount-modal-apply");function Z(){const fe=Me(T?.value??"0");return Sr(b+fe,l)}function W(){const fe=Me(T?.value??"0");return Sr(fe,l)}function Pe(){L&&(L.textContent=`${E(Z())} â¬`),j&&(j.textContent=`${E(W())} â¬`)}function tt(){const fe=He;if(!fe){Tt();return}const bt=Z();Tt(),fe.value=pt(bt),fe.dispatchEvent(new Event("change",{bubbles:!0}))}function Fe(){const fe=He;if(!fe){Tt();return}const bt=W();Tt(),fe.value=pt(bt),fe.dispatchEvent(new Event("change",{bubbles:!0}))}F?.addEventListener("click",()=>{Tt()}),X?.addEventListener("click",()=>{Fe()}),U?.addEventListener("click",()=>{tt()}),T?.addEventListener("input",()=>{Pe()}),T?.addEventListener("keydown",fe=>{if(fe.key==="Escape"){fe.preventDefault(),Tt();return}fe.key==="Enter"&&(fe.preventDefault(),tt())}),w?.addEventListener("click",fe=>{fe.target===w&&Tt()}),window.setTimeout(()=>{T?.focus(),T?.select(),Pe()},0)}function xe(l,c="success"){const b=$t(),y=document.createElement("div");y.className=`toast toast-${c}`,y.textContent=l,b.appendChild(y),requestAnimationFrame(()=>{y.classList.add("toast-visible")});const w=c==="error"?5e3:3e3;window.setTimeout(()=>{y.classList.remove("toast-visible"),window.setTimeout(()=>{y.remove()},220)},w)}function Yt(){return new Date().getMonth()+1}function en(){return new Date().getFullYear()}function Br(l){const c=en(),b=l.find(y=>y.year===c);return b?b.year:l[0]?.year??null}function ar(){return new Date().toISOString().slice(0,10)}function qn(l){return l.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;")}function Jr(){const l=localStorage.getItem(Se);return l&&ba(l)?l:"light"}function Vt(l){g.theme=l,document.documentElement.setAttribute("data-theme",l),localStorage.setItem(Se,l)}function fn(){return localStorage.getItem(G)==="1"}function _t(l){localStorage.setItem(G,l?"1":"0")}function sr(){const l=localStorage.getItem(ce);if(!l)return[];try{const c=JSON.parse(l);return Array.isArray(c)?c.filter(b=>{if(!b||typeof b!="object")return!1;const y=b;return typeof y.id=="string"&&typeof y.timestampIso=="string"&&typeof y.message=="string"}).slice(-200):[]}catch{return[]}}function Et(l){localStorage.setItem(ce,JSON.stringify(l.slice(-200)))}function Hr(){const l=localStorage.getItem(re);if(!l)return null;const c=l.trim();return c||null}function hn(){const l={foodBudgetCents:null,goingOutBudgetCents:null,fixedBudgetCents:null,variableBudgetCents:null,miscBudgetCents:null},c=localStorage.getItem(me);if(!c)return l;try{const b=JSON.parse(c),y=w=>typeof w=="number"&&Number.isFinite(w)?w:null;return{foodBudgetCents:y(b.foodBudgetCents),goingOutBudgetCents:y(b.goingOutBudgetCents),fixedBudgetCents:y(b.fixedBudgetCents),variableBudgetCents:y(b.variableBudgetCents),miscBudgetCents:y(b.miscBudgetCents)}}catch{return l}}function Pr(l){localStorage.setItem(me,JSON.stringify(l))}function xn(l){l.months.forEach(c=>{const{recurringBudgetDefaults:b}=g;typeof b.foodBudgetCents=="number"&&(c.foodBudgetCents=b.foodBudgetCents),typeof b.goingOutBudgetCents=="number"&&(c.goingOutBudgetCents=b.goingOutBudgetCents),typeof b.fixedBudgetCents=="number"&&(c.fixedBudgetCents=b.fixedBudgetCents),typeof b.variableBudgetCents=="number"&&(c.variableBudgetCents=b.variableBudgetCents),typeof b.miscBudgetCents=="number"&&(c.miscBudgetCents=b.miscBudgetCents)})}function pn(l){const c=l.trim();c&&localStorage.setItem(re,c)}async function ir(){$t(),Vt(Jr()),g.hasUnexportedChanges=fn(),g.unexportedChangeLog=sr(),g.lastBackupFileName=Hr(),g.recurringBudgetDefaults=hn(),Kn(),Er();const[l,c]=await Promise.all([Nn(),ca()]);g.years=l,or(g.years),g.fixedTemplates=c.templates,g.fixedTemplateVersion=c.version,await ge(g.years),l.length>0&&(g.selectedYear=Br(l),g.selectedMonth=Yt()),se()}function or(l){const c=b=>b==="balance"||b==="fresh"||b==="salary"?b:void 0;l.forEach(b=>{b.months.forEach(y=>{typeof y.foodBudgetCents!="number"&&(y.foodBudgetCents=0),typeof y.goingOutBudgetCents!="number"&&(y.goingOutBudgetCents=0),Array.isArray(y.incomes)?y.incomes=y.incomes.map(w=>{const T=c(w.incomeSource);if(!T){const{incomeSource:L,...j}=w;return j}return{...w,incomeSource:T}}):y.incomes=[],typeof y.fixedBudgetCents!="number"&&(y.fixedBudgetCents=y.fixedCosts.reduce((w,T)=>w+T.plannedCents,0)),typeof y.variableBudgetCents!="number"&&(y.variableBudgetCents=y.variablePositions.reduce((w,T)=>w+T.budgetCents,0)),Array.isArray(y.variablePositions)||(y.variablePositions=[]),typeof y.miscBudgetCents!="number"&&(y.miscBudgetCents=0)})})}function H(l){return l==="balance"?"Bestandsguthaben":l==="salary"?"Gehalt":l==="fresh"?"Neues Einkommen":"Nicht zugeordnet"}function kn(l){return l==="fresh"||l==="salary"||!l}async function ge(l){for(const c of l)await Fn(c)}function zt(){if(g.selectedYear)return g.years.find(l=>l.year===g.selectedYear)}function Ke(){const l=zt();if(l)return l.months.find(c=>c.month===g.selectedMonth)}function St(l){const c=l.days.reduce((j,F)=>j+F.foodCents,0),b=l.days.reduce((j,F)=>j+F.goingOutCents,0),y=l.fixedCosts.reduce((j,F)=>j+F.actualCents,0),w=l.variableCosts.reduce((j,F)=>j+F.amountCents,0)+l.variablePositions.reduce((j,F)=>j+F.actualCents,0),T=l.miscCosts.reduce((j,F)=>j+F.amountCents,0),L=c+b+y+w+T;return{foodCents:c,goingOutCents:b,fixedCents:y,variableCents:w,miscCents:T,totalCents:L}}function Ln(l){const c=l.foodBudgetCents??0,b=l.goingOutBudgetCents??0,y=l.fixedBudgetCents??l.fixedCosts.reduce((L,j)=>L+j.plannedCents,0),w=l.variablePositions.reduce((L,j)=>L+j.budgetCents,0),T=l.miscBudgetCents??0;return c+b+y+(l.variableBudgetCents??w)+T}function jn(l){return l.months.reduce((c,b)=>{const y=St(b);return{foodCents:c.foodCents+y.foodCents,goingOutCents:c.goingOutCents+y.goingOutCents,fixedCents:c.fixedCents+y.fixedCents,variableCents:c.variableCents+y.variableCents,miscCents:c.miscCents+y.miscCents,totalCents:c.totalCents+y.totalCents}},{foodCents:0,goingOutCents:0,fixedCents:0,variableCents:0,miscCents:0,totalCents:0})}function Xr(l){return l.months.slice().sort((c,b)=>c.month-b.month).map(c=>({month:c.month,summary:St(c)}))}function lr(l){const c=l.months.reduce((L,j)=>L+(j.foodBudgetCents??0),0),b=l.months.reduce((L,j)=>L+(j.goingOutBudgetCents??0),0),y=l.months.reduce((L,j)=>L+(j.fixedBudgetCents??j.fixedCosts.reduce((F,X)=>F+X.plannedCents,0)),0),w=l.months.reduce((L,j)=>L+(j.variableBudgetCents??j.variablePositions.reduce((F,X)=>F+X.budgetCents,0)),0),T=l.months.reduce((L,j)=>L+(j.miscBudgetCents??0),0);return{foodCents:c,goingOutCents:b,fixedCents:y,variableCents:w,miscCents:T,totalCents:c+b+y+w+T}}function $n(l){return l.months.reduce((c,b)=>c+b.incomes.reduce((y,w)=>y+(kn(w.incomeSource)?w.amountCents:0),0),0)}function mt(l,c){const b=l.months.slice().sort((y,w)=>y.month-w.month)[0];return b?c.get(ue(l.year,b.month))?.carriedFromPreviousCents??0:0}function Or(){const l=g.years.slice().sort((y,w)=>y.year-w.year).flatMap(y=>y.months.slice().sort((w,T)=>w.month-T.month).map(w=>({year:y.year,month:w}))),c=new Map;let b=0;return l.forEach(({year:y,month:w},T)=>{const L=w.carryoverOverrideCents,j=typeof L=="number",F=j?L:b,X=T>0||j,U=w.incomes.reduce((tt,Fe)=>tt+(kn(Fe.incomeSource)?Fe.amountCents:0),0),Z=Ln(w),W=U+F,Pe=W-Z;c.set(ue(y,w.month),{hasPreviousMonth:X,carriedFromPreviousCents:F,recordedIncomeCents:U,effectiveIncomeCents:W,plannedBudgetCents:Z,netCents:Pe}),b=Pe}),c}function et(l,c){return c<=0?"":l>c?"budget-over":l<c?"budget-under":""}function vn(l,c){const b=l!==null,y=b?l-c:null,w=b?et(c,l):"";return`<div class="column-overview">
      <div class="column-overview-row">
        <span>Budget</span>
        <strong>${b?`${E(l)} â¬`:"-"}</strong>
      </div>
      <div class="column-overview-row">
        <span>Ausgegeben</span>
        <strong>${E(c)} â¬</strong>
      </div>
      <div class="column-overview-row ${w}">
        <span>Diff</span>
        <strong>${y===null?"-":`${E(y)} â¬`}</strong>
      </div>
    </div>`}async function _n(l){if(await Ma(l)){alert(`Jahr ${l} existiert bereits.`);return}const b=ha(l,g.fixedTemplates,g.fixedTemplateVersion);xn(b),await Fn(b),g.years=await Nn(),Ve(`Jahr ${l} wurde angelegt`),g.selectedYear=l,g.selectedMonth=Yt(),xe(`Jahr ${l} wurde angelegt.`),se()}function Ve(l="Ãnderung an den Daten"){g.hasUnexportedChanges=!0,_t(!0);const c=g.selectedYear?`${g.selectedYear}-${String(g.selectedMonth).padStart(2,"0")}`:"ohne Zeitraum",b={id:Rt("change"),timestampIso:new Date().toISOString(),message:`${l} (${c})`};g.unexportedChangeLog=[...g.unexportedChangeLog,b].slice(-200),Et(g.unexportedChangeLog)}function tn(l){const c=l.trim();c&&(g.lastBackupFileName=c,pn(c))}function Rn(l){g.hasUnexportedChanges=!1,_t(!1),g.unexportedChangeLog=[],Et([]),g.showUnexportedChangeLogModal=!1,tn(l)}async function Be(l){const c=zt();c&&(await Fn(c),g.years=await Nn(),Ve(l))}async function Ct(l){for(const c of g.years)await Fn(c);g.years=await Nn(),Ve(l)}function ue(l,c){return l*100+c}function gt(l){l.fixedBudgetCents=l.fixedCosts.reduce((c,b)=>c+b.plannedCents,0)}function Bt(l){l.variableBudgetCents=l.variablePositions.reduce((c,b)=>c+b.budgetCents,0)}function ur(){if(g.selectedYear)return`${g.selectedYear}-${String(g.selectedMonth).padStart(2,"0")}`;const l=new Date;return`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}`}function Dt(){const l=prompt("Ab wann soll die Ãnderung gelten? Format: YYYY-MM",ur());if(!l)return null;const c=l.trim().match(/^(\d{4})-(0[1-9]|1[0-2])$/);if(!c)return alert("UngÃ¼ltiges Format. Bitte YYYY-MM verwenden."),null;const b=c[1],y=c[2];return!b||!y?null:{year:Number.parseInt(b,10),month:Number.parseInt(y,10)}}function J(l,c){const b=ue(c.year,c.month);g.years.forEach(y=>{y.months.forEach(w=>{if(ue(y.year,w.month)<b)return;w.fixedCosts.some(L=>L.templateId===l.id)||(w.fixedCosts.push({id:Rt("fixed"),templateId:l.id,name:l.name,plannedCents:l.plannedCents,actualCents:0}),gt(w))})})}function En(l,c,b){const y=ue(b.year,b.month);g.years.forEach(w=>{w.months.forEach(T=>{ue(w.year,T.month)<y||(T.fixedCosts=T.fixedCosts.map(L=>L.templateId!==c.id?L:{...L,name:c.name,plannedCents:c.plannedCents,actualCents:L.actualCents===l.plannedCents?c.plannedCents:L.actualCents}),gt(T))})})}function nn(l,c){const b=ue(c.year,c.month);g.years.forEach(y=>{y.months.forEach(w=>{ue(y.year,w.month)<b||(w.fixedCosts=w.fixedCosts.filter(T=>T.templateId!==l),gt(w))})})}async function Yn(l,c){const b=l.trim();if(!b)return;const y=Dt();if(!y)return;const w=!!g.editingFixedTemplateId;if(g.editingFixedTemplateId){const T=g.fixedTemplates.find(j=>j.id===g.editingFixedTemplateId);if(!T)return;const L={...T,name:b,plannedCents:c};g.fixedTemplates=g.fixedTemplates.map(j=>j.id===g.editingFixedTemplateId?L:j),En(T,L,y)}else{const T={id:Rt("tpl"),name:b,plannedCents:c};g.fixedTemplates=[...g.fixedTemplates,T],J(T,y)}g.fixedTemplateVersion=await da(g.fixedTemplates),g.editingFixedTemplateId=null,await Ct(w?`Fixkosten-Vorlage aktualisiert: ${b} (${E(c)} â¬)`:`Fixkosten-Vorlage hinzugefÃ¼gt: ${b} (${E(c)} â¬)`),xe(w?"Fixkosten-Vorlage wurde aktualisiert.":"Fixkosten-Vorlage wurde hinzugefÃ¼gt."),se()}function R(l){g.editingFixedTemplateId=l,se()}function cr(){g.editingFixedTemplateId=null,se()}async function Mr(l){if(!confirm("Fixkosten-Vorlage wirklich lÃ¶schen?"))return;const b=Dt();if(!b)return;const y=g.fixedTemplates.find(w=>w.id===l);g.fixedTemplates=g.fixedTemplates.filter(w=>w.id!==l),nn(l,b),g.editingFixedTemplateId===l&&(g.editingFixedTemplateId=null),g.fixedTemplateVersion=await da(g.fixedTemplates),await Ct(`Fixkosten-Vorlage gelÃ¶scht: ${y?.name??"Unbekannt"}`),xe("Fixkosten-Vorlage wurde gelÃ¶scht."),se()}async function Vn(l,c,b){const y=Ke();y&&(y.days=y.days.map(w=>w.isoDate===l?{...w,[c]:b}:w),await Be(`${c==="foodCents"?"Essen":"Ausgehen"} am ${l} angepasst auf ${E(b)} â¬`),se())}async function Ar(l,c){const b=Ke();if(!b)return;const y=b.fixedCosts.find(w=>w.id===l);b.fixedCosts=b.fixedCosts.map(w=>w.id===l?{...w,actualCents:c}:w),await Be(`Fixkosten-Ist angepasst: ${y?.name??"Unbekannt"} auf ${E(c)} â¬`),se()}async function dr(l,c){const b=Ke();if(!b)return;const y=b.fixedCosts.find(w=>w.id===l);y&&(b.fixedCosts=b.fixedCosts.map(w=>w.id===l?{...w,plannedCents:c}:w),gt(b),await Be(`Fixkosten-Budget angepasst: ${y.name} auf ${E(c)} â¬`),se())}async function Qr(l,c){const b=Ke();if(!b)return;const y=l.trim();if(!y){alert("Bitte Namen fÃ¼r die Fixkosten-Position eingeben.");return}if(c<=0){alert("Bitte einen positiven Betrag eingeben.");return}const w={id:Rt("fixed"),templateId:Rt("fixed-local"),name:y,plannedCents:c,actualCents:0};b.fixedCosts=[w,...b.fixedCosts],gt(b),await Be(`Fixkosten-Position hinzugefÃ¼gt: ${y} (${E(c)} â¬)`),xe("Fixkosten-Position wurde hinzugefÃ¼gt."),se()}async function Zr(l){if(!confirm("Fixkosten-Position wirklich lÃ¶schen?"))return;const b=Ke();if(!b)return;const y=b.fixedCosts.find(w=>w.id===l);y&&(b.fixedCosts=b.fixedCosts.filter(w=>w.id!==l),gt(b),await Be(`Fixkosten-Position gelÃ¶scht: ${y.name}`),xe("Fixkosten-Position wurde gelÃ¶scht."),se())}async function mn(l){await _e("fixedBudgetCents",l,"Fixkosten")}async function gn(l){await _e("foodBudgetCents",l,"Essen")}async function fr(l){await _e("goingOutBudgetCents",l,"Ausgehen")}async function zn(l){await _e("miscBudgetCents",l,"Sonstiges")}async function we(l){await _e("variableBudgetCents",l,"Variable Kosten")}async function _e(l,c,b){const y=Ke(),w=g.selectedYear;if(!y||!w||y[l]===c)return;if(y[l]=c,confirm(`Soll das Budget "${b}" auch fÃ¼r zukÃ¼nftige Monate Ã¼bernommen werden?`)){const L=ue(w,g.selectedMonth);g.years.forEach(j=>{j.months.forEach(F=>{ue(j.year,F.month)<=L||(F[l]=c)})}),g.recurringBudgetDefaults[l]=c,Pr(g.recurringBudgetDefaults),await Ct(`Budget "${b}" auf ${E(c)} â¬ gesetzt (inkl. zukÃ¼nftiger Monate)`),xe(`Budget "${b}" wurde fÃ¼r zukÃ¼nftige Monate Ã¼bernommen.`),se();return}await Be(`Budget "${b}" auf ${E(c)} â¬ gesetzt`),se()}async function Tr(l){const c=Ke();c&&(l===null?c.carryoverOverrideCents=null:c.carryoverOverrideCents=l,await Be(l===null?"Ãbernahme aus Vormonat zurÃ¼ckgesetzt":`Ãbernahme aus Vormonat auf ${E(l)} â¬ gesetzt`),se())}async function Sn(l,c,b){const y=Ke(),w=g.selectedYear;if(!y||!w)return;const T=l.trim();if(!T){alert("Bitte Bezeichnung fÃ¼r die Position angeben.");return}if(y.variablePositions=[{id:Rt("varpos"),name:T,budgetCents:c,actualCents:0},...y.variablePositions],Bt(y),b){const L=ue(w,g.selectedMonth);g.years.forEach(j=>{j.months.forEach(F=>{ue(j.year,F.month)<=L||(F.variablePositions=[{id:Rt("varpos"),name:T,budgetCents:c,actualCents:0},...F.variablePositions],Bt(F))})}),await Ct(`Variable Position hinzugefÃ¼gt: ${T} (${E(c)} â¬) fÃ¼r zukÃ¼nftige Monate`),xe("Variable Position wurde fÃ¼r zukÃ¼nftige Monate hinzugefÃ¼gt."),se();return}await Be(`Variable Position hinzugefÃ¼gt: ${T} (${E(c)} â¬)`),xe("Variable Position wurde hinzugefÃ¼gt."),se()}async function Un(l,c){const b=Ke();if(!b)return;const y=b.variablePositions.find(w=>w.id===l);b.variablePositions=b.variablePositions.map(w=>w.id===l?{...w,actualCents:c}:w),await Be(`Istwert Variable Position angepasst: ${y?.name??"Unbekannt"} auf ${E(c)} â¬`),se()}async function Gn(l,c){const b=Ke();if(!b)return;const y=b.variablePositions.find(w=>w.id===l);b.variablePositions=b.variablePositions.map(w=>w.id===l?{...w,budgetCents:c}:w),Bt(b),await Be(`Budget Variable Position angepasst: ${y?.name??"Unbekannt"} auf ${E(c)} â¬`),se()}async function ea(l){if(!confirm("Variable Position wirklich lÃ¶schen?"))return;const b=Ke(),y=g.selectedYear;if(!b||!y)return;const w=b.variablePositions.find(F=>F.id===l);if(!w)return;const T=ue(y,g.selectedMonth),j=g.years.some(F=>F.months.some(X=>ue(F.year,X.month)>T&&X.variablePositions.some(U=>U.name===w.name&&U.budgetCents===w.budgetCents)))?confirm("Soll das LÃ¶schen auch fÃ¼r zukÃ¼nftige Monate gelten?"):!1;if(b.variablePositions=b.variablePositions.filter(F=>F.id!==l),Bt(b),j){g.years.forEach(F=>{F.months.forEach(X=>{ue(F.year,X.month)<=T||(X.variablePositions=X.variablePositions.filter(U=>!(U.name===w.name&&U.budgetCents===w.budgetCents)),Bt(X))})}),await Ct(`Variable Position gelÃ¶scht: ${w.name} (inkl. zukÃ¼nftiger Monate)`),xe("Variable Position wurde auch in zukÃ¼nftigen Monaten gelÃ¶scht."),se();return}await Be(`Variable Position gelÃ¶scht: ${w.name}`),xe("Variable Position wurde gelÃ¶scht."),se()}async function Ut(l){const c=Ke(),b=g.selectedYear;if(!c||!b)return;const y=c.variablePositions.find(U=>U.id===l);if(!y)return;const w={year:g.selectedMonth===12?b+1:b,month:g.selectedMonth===12?1:g.selectedMonth+1};let T=g.years.find(U=>U.year===w.year);if(!T){const U=ha(w.year,g.fixedTemplates,g.fixedTemplateVersion);xn(U),await Fn(U),g.years=[...g.years,U].sort((Z,W)=>Z.year-W.year),T=U}const L=T.months.find(U=>U.month===w.month);if(!L)return;const j=L.variablePositions.some(U=>U.id===y.id||U.name===y.name&&U.budgetCents===y.budgetCents);if(c.variablePositions=c.variablePositions.filter(U=>U.id!==l),Bt(c),!j){const Z=L.variablePositions.some(W=>W.id===y.id)?{...y,id:Rt("varpos")}:y;L.variablePositions=[Z,...L.variablePositions],Bt(L)}const F=`${lt(w.month)} ${w.year}`,X=`Variable Position verschoben: ${y.name} â ${F}`;if(w.year===b)await Be(X);else{const U=zt();if(!U)return;await Fn(U),await Fn(T),g.years=await Nn(),or(g.years),Ve(X)}xe(j?`Position entfernt (im Folgemonat schon vorhanden: ${F}).`:`Position in den Folgemonat verschoben: ${F}.`),se()}async function rn(l,c,b){const y=Ke(),w=g.selectedYear;if(!y||!w)return;const T=l.trim();if(!T){alert("Bitte Bezeichnung fÃ¼r Sonstiges eingeben.");return}if(c<=0){alert("Bitte einen positiven Betrag eingeben.");return}const L=pa(T,c);if(y.miscCosts=[L,...y.miscCosts],b){const j=ue(w,g.selectedMonth);g.years.forEach(F=>{F.months.forEach(X=>{ue(F.year,X.month)<=j||(X.miscCosts=[pa(T,c),...X.miscCosts])})}),await Ct(`Sonstige Position hinzugefÃ¼gt: ${T} (${E(c)} â¬) fÃ¼r zukÃ¼nftige Monate`),xe("Sonstige Position wurde fÃ¼r zukÃ¼nftige Monate hinzugefÃ¼gt."),se();return}await Be(`Sonstige Position hinzugefÃ¼gt: ${T} (${E(c)} â¬)`),xe("Sonstige Position wurde hinzugefÃ¼gt."),se()}async function Gt(l){if(!confirm("Sonstiges-Position wirklich lÃ¶schen?"))return;const b=Ke(),y=g.selectedYear;if(!b||!y)return;const w=b.miscCosts.find(F=>F.id===l);if(!w)return;const T=ue(y,g.selectedMonth),j=g.years.some(F=>F.months.some(X=>ue(F.year,X.month)>T&&X.miscCosts.some(U=>U.description===w.description&&U.amountCents===w.amountCents)))?confirm("Soll das LÃ¶schen auch fÃ¼r zukÃ¼nftige Monate gelten?"):!1;if(b.miscCosts=b.miscCosts.filter(F=>F.id!==l),j){g.years.forEach(F=>{F.months.forEach(X=>{ue(F.year,X.month)<=T||(X.miscCosts=X.miscCosts.filter(U=>!(U.description===w.description&&U.amountCents===w.amountCents)))})}),await Ct(`Sonstige Position gelÃ¶scht: ${w.description} (${E(w.amountCents)} â¬) inkl. zukÃ¼nftiger Monate`),xe("Sonstige Position wurde auch in zukÃ¼nftigen Monaten gelÃ¶scht."),se();return}await Be(`Sonstige Position gelÃ¶scht: ${w.description} (${E(w.amountCents)} â¬)`),xe("Sonstige Position wurde gelÃ¶scht."),se()}async function Bn(l,c,b,y){const w=Ke(),T=g.selectedYear;if(!w||!T)return;const L=l.trim();if(!L){alert("Bitte Einkommens-Bezeichnung eingeben.");return}if(c<=0){alert("Bitte einen positiven Einkommensbetrag eingeben.");return}const j=va(L,c,b);if(w.incomes=[j,...w.incomes],y){const F=ue(T,g.selectedMonth);g.years.forEach(X=>{X.months.forEach(U=>{ue(X.year,U.month)<=F||(U.incomes=[va(L,c,b),...U.incomes])})}),await Ct(`Einkommen hinzugefÃ¼gt: ${L} (${E(c)} â¬, ${H(b)}) fÃ¼r zukÃ¼nftige Monate`),xe("Einkommen wurde fÃ¼r zukÃ¼nftige Monate hinzugefÃ¼gt."),se();return}await Be(`Einkommen hinzugefÃ¼gt: ${L} (${E(c)} â¬, ${H(b)})`),xe("Einkommen wurde hinzugefÃ¼gt."),se()}async function ta(l,c){const b=Ke();if(!b)return;const y=b.incomes.find(w=>w.id===l);y&&(b.incomes=b.incomes.map(w=>{if(w.id!==l)return w;if(!c){const{incomeSource:T,...L}=w;return L}return{...w,incomeSource:c}}),await Be(`Einkommensart angepasst: ${y.description} â ${H(c)}`),se())}async function Wt(l){if(!confirm("Einkommens-Eintrag wirklich lÃ¶schen?"))return;const b=Ke(),y=g.selectedYear;if(!b||!y)return;const w=b.incomes.find(F=>F.id===l);if(!w)return;const T=ue(y,g.selectedMonth),j=g.years.some(F=>F.months.some(X=>ue(F.year,X.month)>T&&X.incomes.some(U=>U.description===w.description&&U.amountCents===w.amountCents)))?confirm("Soll das LÃ¶schen auch fÃ¼r zukÃ¼nftige Monate gelten?"):!1;if(b.incomes=b.incomes.filter(F=>F.id!==l),j){g.years.forEach(F=>{F.months.forEach(X=>{ue(F.year,X.month)<=T||(X.incomes=X.incomes.filter(U=>!(U.description===w.description&&U.amountCents===w.amountCents)))})}),await Ct(`Einkommen gelÃ¶scht: ${w.description} (${E(w.amountCents)} â¬) inkl. zukÃ¼nftiger Monate`),xe("Einkommen wurde auch in zukÃ¼nftigen Monaten gelÃ¶scht."),se();return}await Be(`Einkommen gelÃ¶scht: ${w.description} (${E(w.amountCents)} â¬)`),xe("Einkommen wurde gelÃ¶scht."),se()}async function Dr(){const l=await Aa(),c=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),b=URL.createObjectURL(c),y=`haushaltsbuch-backup-${new Date().toISOString().slice(0,10)}.json`,w=document.createElement("a");w.href=b,w.download=y,w.click(),URL.revokeObjectURL(b),Rn(y),se(),xe("Backup wurde exportiert.")}async function an(l){const c=await l.text(),b=JSON.parse(c);await Ta(b);const[y,w]=await Promise.all([Nn(),ca()]);g.years=y,or(g.years),g.fixedTemplates=w.templates,g.fixedTemplateVersion=w.version,await ge(g.years),g.selectedYear=Br(y),g.selectedMonth=Yt(),Rn(l.name),xe("Backup wurde importiert."),se()}function se(){const l=zt(),c=Ke(),b=ar(),y=c?St(c):{foodCents:0,goingOutCents:0,fixedCents:0,variableCents:0,miscCents:0,totalCents:0},w=l?jn(l):{foodCents:0,goingOutCents:0,fixedCents:0,variableCents:0,miscCents:0,totalCents:0},T=l?Xr(l):[],L=c?c.foodBudgetCents??0:0,j=c?c.goingOutBudgetCents??0:0,F=c?c.fixedBudgetCents??c.fixedCosts.reduce((o,D)=>o+D.plannedCents,0):0,X=c?c.variableBudgetCents??c.variablePositions.reduce((o,D)=>o+D.budgetCents,0):0,U=c?c.miscBudgetCents??0:0,Z=l?l.months.reduce((o,D)=>o+(D.foodBudgetCents??0),0):0,W=l?l.months.reduce((o,D)=>o+(D.goingOutBudgetCents??0),0):0,Pe=l?l.months.reduce((o,D)=>o+(D.fixedBudgetCents??D.fixedCosts.reduce((te,pe)=>te+pe.plannedCents,0)),0):0,tt=l?l.months.reduce((o,D)=>o+(D.variableBudgetCents??D.variablePositions.reduce((te,pe)=>te+pe.budgetCents,0)),0):0,Fe=l?l.months.reduce((o,D)=>o+(D.miscBudgetCents??0),0):0,fe=c?c.incomes.reduce((o,D)=>o+(kn(D.incomeSource)?D.amountCents:0),0):0,bt=c?c.incomes.reduce((o,D)=>o+(D.incomeSource==="salary"?D.amountCents:0),0):0,Ne=Or(),ze=l?Ne.get(ue(l.year,g.selectedMonth)):void 0,le=l?l.months.slice().sort((o,D)=>o.month-D.month)[0]:void 0,qe=ze?.carriedFromPreviousCents??0,N=ze?.hasPreviousMonth??!1,Ae=ze?.effectiveIncomeCents??fe,yt=c?Ln(c):0,It=ze?.netCents??fe-yt,ct=Ae-y.totalCents,nt=bt-y.totalCents,it=y.totalCents>0?`${(bt/y.totalCents*100).toFixed(1)} %`:"-",Te=qe<0?"danger":qe>0?"budget-under":"",dt=It<0?"danger":It>0?"budget-under":"",ee=ct<0?"danger":ct>0?"budget-under":"",Le=l?l.months.reduce((o,D)=>o+D.incomes.reduce((te,pe)=>te+(kn(pe.incomeSource)?pe.amountCents:0),0),0):0,je=l?l.months.reduce((o,D)=>o+D.incomes.reduce((te,pe)=>te+(pe.incomeSource==="salary"?pe.amountCents:0),0),0):0,wt=l&&le?Ne.get(ue(l.year,le.month))?.carriedFromPreviousCents??0:0,De=Le+wt,rt=De-w.totalCents,xt=je-w.totalCents,ft=w.totalCents>0?`${(je/w.totalCents*100).toFixed(1)} %`:"-",Pt=wt<0?"danger":wt>0?"budget-under":"",ye=rt<0?"danger":rt>0?"budget-under":"",ne=L+j+F+X+U,be=L+j,S=y.foodCents+y.goingOutCents,A=be-S,at=et(S,be),ot=Z+W+Pe+tt+Fe,Wn=Ae-ne,Ue=De-ot,Ft=ne-y.totalCents,Jt=ot-w.totalCents,ke=o=>o<0?"danger":o>0?"budget-under":"",sn=(o,D)=>D<=0?"muted":o>=D?"budget-under":"danger",Ht=sn(bt,y.totalCents),Jn=sn(je,w.totalCents),Ge=(o,D)=>{if(D<=0)return"0%";const pe=Math.max(0,o)/D*100;return`${Math.min(100,Math.max(0,pe)).toFixed(1)}%`},Xt=(o,D)=>{if(D<=0)return o>0?100:0;const te=Math.max(0,o)/D*100;return Math.max(0,te)},Ir=[{label:"Essen",budgetCents:L,actualCents:y.foodCents},{label:"Ausgehen",budgetCents:j,actualCents:y.goingOutCents},{label:"Fixkosten",budgetCents:F,actualCents:y.fixedCents},{label:"Variable",budgetCents:X,actualCents:y.variableCents},{label:"Sonstige",budgetCents:U,actualCents:y.miscCents}];Math.max(1,...Ir.flatMap(o=>[o.budgetCents,o.actualCents]));const Fr=(o,D)=>D<=0?"bar-positive":o<=0||D>o?"bar-negative":"bar-positive",Pn=[{label:"Einkommen gesamt",valueCents:Ae,className:"bar-income"},{label:"Echte Ausgaben",valueCents:y.totalCents,className:"bar-expense"},{label:"Netto",valueCents:ct,className:ct<0?"bar-negative":"bar-positive"}],Hn=Math.max(1,...Pn.map(o=>Math.abs(o.valueCents))),pr=Math.max(1,...T.map(o=>o.summary.totalCents)),na=et(y.fixedCents,F),ra=et(y.foodCents,L),aa=et(y.goingOutCents,j),vr=et(y.variableCents,X),mr=et(y.miscCents,U),bn=g.editingFixedTemplateId?g.fixedTemplates.find(o=>o.id===g.editingFixedTemplateId):null,Xn=g.hasUnexportedChanges,On=g.unexportedChangeLog.slice().reverse(),Qn=g.lastBackupFileName?qn(g.lastBackupFileName):"-",Nr={foodCents:0,goingOutCents:0,fixedCents:0,variableCents:0,miscCents:0,totalCents:0},ht=g.years.slice().sort((o,D)=>o.year-D.year),Nt=ht.some(o=>o.year===g.dashboardYear)?g.dashboardYear:g.selectedYear??ht[ht.length-1]?.year??null,Re=typeof Nt=="number"?ht.find(o=>o.year===Nt):void 0,gr=Re?Re.months.slice().sort((o,D)=>o.month-D.month):[],Kt=Re?jn(Re):Nr,on=Re?lr(Re):{foodCents:0,goingOutCents:0,fixedCents:0,variableCents:0,miscCents:0},We=Re?$n(Re):0,Mn=Re?mt(Re,Ne):0,ln=We+Mn,br=Re?Re.months.reduce((o,D)=>o+Ln(D),0):0,An=ln-br,yr=ln-Kt.totalCents,Kr=[{label:"Essen",budgetCents:on.foodCents,actualCents:Kt.foodCents},{label:"Ausgehen",budgetCents:on.goingOutCents,actualCents:Kt.goingOutCents},{label:"Fixkosten",budgetCents:on.fixedCents,actualCents:Kt.fixedCents},{label:"Variable",budgetCents:on.variableCents,actualCents:Kt.variableCents},{label:"Sonstige",budgetCents:on.miscCents,actualCents:Kt.miscCents}],Ye=gr.map(o=>{const D=Re?Ne.get(ue(Re.year,o.month)):void 0,te=St(o),pe=o.incomes.reduce((Ot,wn)=>Ot+wn.amountCents,0),Ee=D?.effectiveIncomeCents??pe,$e=D?.plannedBudgetCents??Ln(o),Ce=te.foodCents,Je=te.goingOutCents,Lt=Ce+Je,Tn=te.totalCents,Cn=Ee-$e,Dn=Ee-Tn;return{month:o.month,foodCents:Ce,goingOutCents:Je,foodAndGoingOutCents:Lt,effectiveIncomeCents:Ee,plannedBudgetCents:$e,actualCostCents:Tn,plannedNetCents:Cn,actualNetCents:Dn}}),Cr=Math.max(1,...Ye.map(o=>o.actualCostCents)),Qt=Math.max(1,...Ye.flatMap(o=>[Math.abs(o.plannedNetCents),Math.abs(o.actualNetCents)])),wr=Math.max(1,...Ye.map(o=>o.foodAndGoingOutCents)),xr=Math.max(1,...Ye.map(o=>o.foodCents)),Zn=Math.max(1,...Ye.map(o=>o.goingOutCents)),qt=ht.reduce((o,D)=>{const te=lr(D);return{foodCents:o.foodCents+te.foodCents,goingOutCents:o.goingOutCents+te.goingOutCents,fixedCents:o.fixedCents+te.fixedCents,variableCents:o.variableCents+te.variableCents,miscCents:o.miscCents+te.miscCents,totalCents:o.totalCents+te.totalCents}},{foodCents:0,goingOutCents:0,fixedCents:0,variableCents:0,miscCents:0,totalCents:0}),Zt=ht.reduce((o,D)=>{const te=jn(D);return{foodCents:o.foodCents+te.foodCents,goingOutCents:o.goingOutCents+te.goingOutCents,fixedCents:o.fixedCents+te.fixedCents,variableCents:o.variableCents+te.variableCents,miscCents:o.miscCents+te.miscCents,totalCents:o.totalCents+te.totalCents}},{foodCents:0,goingOutCents:0,fixedCents:0,variableCents:0,miscCents:0,totalCents:0}),sa=ht.reduce((o,D)=>o+$n(D),0),kr=ht[0]?mt(ht[0],Ne):0,yn=sa+kr,qr=yn-qt.totalCents,er=yn-Zt.totalCents,tr=[{label:"Essen",budgetCents:qt.foodCents,actualCents:Zt.foodCents},{label:"Ausgehen",budgetCents:qt.goingOutCents,actualCents:Zt.goingOutCents},{label:"Fixkosten",budgetCents:qt.fixedCents,actualCents:Zt.fixedCents},{label:"Variable",budgetCents:qt.variableCents,actualCents:Zt.variableCents},{label:"Sonstige",budgetCents:qt.miscCents,actualCents:Zt.miscCents}],Lr=Math.max(1,...tr.flatMap(o=>[o.budgetCents,o.actualCents])),un=ht.map(o=>{const D=jn(o),te=lr(o),pe=$n(o),Ee=mt(o,Ne),$e=pe+Ee;return{year:o.year,budgetTotalCents:te.totalCents,actualTotalCents:D.totalCents,effectiveIncomeCents:$e,plannedNetCents:$e-te.totalCents,actualNetCents:$e-D.totalCents}}),jr=Math.max(1,...un.flatMap(o=>[Math.abs(o.plannedNetCents),Math.abs(o.actualNetCents)])),Rr=Math.max(1,...un.map(o=>o.actualTotalCents)),Yr=`
      <div class="grid">
        <div class="inline" role="tablist" aria-label="Dashboard Ansichten">
          <button class="btn ${g.dashboardTab==="year"?"btn-primary":"btn-quiet"}" id="dashboard-tab-year" data-dashboard-tab="year" type="button">Jahr im Detail</button>
          <button class="btn ${g.dashboardTab==="food"?"btn-primary":"btn-quiet"}" id="dashboard-tab-food" data-dashboard-tab="food" type="button">Essen & Trinken</button>
          <button class="btn ${g.dashboardTab==="all"?"btn-primary":"btn-quiet"}" id="dashboard-tab-all" data-dashboard-tab="all" type="button">Alle Jahre</button>
        </div>

        ${ht.length===0?'<p class="muted">Noch keine Jahre vorhanden. Lege zuerst ein Jahr an.</p>':g.dashboardTab==="year"?`
              <div class="inline">
                <label>
                  Jahr
                  <select id="dashboard-year-select">
                    ${ht.map(o=>`<option value="${o.year}" ${o.year===Nt?"selected":""}>${o.year}</option>`).join("")}
                  </select>
                </label>
              </div>

              <div class="eval-grid">
                <section class="eval-tile">
                  <header class="eval-tile-header">
                    <h4>Kennzahlen ${Re?.year??""}</h4>
                    <div class="eval-tile-columns"><span>Wert</span><span></span></div>
                  </header>
                  <div class="eval-rows">
                    <div class="eval-row"><div class="eval-label">Einkommen effektiv</div><div class="eval-value">${E(ln)}</div><div class="eval-value"></div></div>
                    <div class="eval-row"><div class="eval-label">Budget gesamt</div><div class="eval-value">${E(br)}</div><div class="eval-value"></div></div>
                    <div class="eval-row"><div class="eval-label">Ausgaben gesamt</div><div class="eval-value">${E(Kt.totalCents)}</div><div class="eval-value"></div></div>
                    <div class="eval-row eval-strong"><div class="eval-label">Saldo (gegen Budget)</div><div class="eval-value ${ke(An)}">${E(An)}</div><div class="eval-value"></div></div>
                    <div class="eval-row eval-strong"><div class="eval-label">Saldo (gegen Ist)</div><div class="eval-value ${ke(yr)}">${E(yr)}</div><div class="eval-value"></div></div>
                  </div>
                </section>
              </div>

              <div class="chart-grid">
                <section class="chart-tile">
                  <header class="chart-tile-header">
                    <h4>Budget vs. Ist nach Kategorie (Jahr)</h4>
                    <div class="chart-legend">
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-budget"></span>Budget</span>
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-actual"></span>Ist</span>
                    </div>
                  </header>
                  <div class="circle-chart-container" aria-label="Budgetnutzung je Kategorie (Jahr)">
                    ${Kr.map(o=>{const D=Xt(o.actualCents,o.budgetCents),te=Math.min(100,D),pe=`${D.toFixed(0)}%`,Ee=o.budgetCents-o.actualCents,$e=Ee<0?"danger":Ee>0?"budget-under":"";return`
                          <div class="circle-chart-item">
                            <div class="circle-chart-ring ${Fr(o.budgetCents,o.actualCents)==="bar-negative"?"circle-negative":"circle-positive"}" style="--circle-pct:${te.toFixed(1)}%" title="${o.label}: ${E(o.actualCents)} von ${E(o.budgetCents)}">
                              <span class="circle-chart-value">${pe}</span>
                            </div>
                            <div class="circle-chart-label">${o.label}</div>
                            <div class="circle-chart-meta muted">B ${E(o.budgetCents)} / I ${E(o.actualCents)}</div>
                            <div class="circle-chart-meta ${$e}">${Ee>=0?"+":""}${E(Ee)}</div>
                          </div>
                        `}).join("")}
                  </div>
                </section>

                <section class="chart-tile">
                  <header class="chart-tile-header">
                    <h4>Monatliche Ausgaben (Jahr)</h4>
                    <div class="chart-legend">
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-expense"></span>Ist-Kosten</span>
                    </div>
                  </header>
                  <div class="spark-bars" style="grid-template-columns: repeat(${Math.max(Ye.length,1)}, minmax(0, 1fr));">
                    ${Ye.map(o=>{const D=Ge(o.actualCostCents,Cr);return`
                          <div class="spark-bar" title="${lt(o.month)}: ${E(o.actualCostCents)}">
                            <div class="spark-bar-fill" style="height:${D}"></div>
                            <div class="spark-bar-label">${lt(o.month).slice(0,3)}</div>
                          </div>
                        `}).join("")}
                  </div>
                </section>

                <section class="chart-tile">
                  <header class="chart-tile-header">
                    <h4>Saldo pro Monat (Budget vs. Ist)</h4>
                    <div class="chart-legend">
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-budget"></span>Budget-Saldo</span>
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-net"></span>Ist-Saldo</span>
                    </div>
                  </header>
                  <div class="bar-chart">
                    ${Ye.map(o=>{const D=Ge(Math.abs(o.plannedNetCents),Qt),te=Ge(Math.abs(o.actualNetCents),Qt),pe=o.plannedNetCents<0?"bar-negative":"bar-positive",Ee=o.actualNetCents<0?"bar-negative":"bar-positive";return`
                          <div class="bar-row">
                            <div class="bar-label">${lt(o.month)}</div>
                            <div class="bar-track" title="Budget-Saldo: ${E(o.plannedNetCents)} | Ist-Saldo: ${E(o.actualNetCents)}">
                              <div class="bar ${pe}" style="width:${D}; opacity: 0.35;"></div>
                              <div class="bar ${Ee}" style="width:${te}"></div>
                            </div>
                            <div class="bar-meta">
                              <span class="${ke(o.plannedNetCents)}">B ${E(o.plannedNetCents)}</span>
                              <span class="${ke(o.actualNetCents)}">I ${E(o.actualNetCents)}</span>
                            </div>
                          </div>
                        `}).join("")}
                  </div>
                </section>
              </div>

              <table>
                <thead>
                  <tr>
                    <th>Monat</th>
                    <th>Einkommen effektiv (â¬)</th>
                    <th>Budget gesamt (â¬)</th>
                    <th>Ist-Kosten (â¬)</th>
                    <th>Saldo Budget (â¬)</th>
                    <th>Saldo Ist (â¬)</th>
                  </tr>
                </thead>
                <tbody>
                  ${Ye.map(o=>`<tr>
                        <td>${lt(o.month)}</td>
                        <td>${E(o.effectiveIncomeCents)}</td>
                        <td>${E(o.plannedBudgetCents)}</td>
                        <td>${E(o.actualCostCents)}</td>
                        <td class="${ke(o.plannedNetCents)}">${E(o.plannedNetCents)}</td>
                        <td class="${ke(o.actualNetCents)}">${E(o.actualNetCents)}</td>
                      </tr>`).join("")}
                </tbody>
              </table>
            `:g.dashboardTab==="food"?`
              <div class="inline">
                <label>
                  Jahr
                  <select id="dashboard-year-select">
                    ${ht.map(o=>`<option value="${o.year}" ${o.year===Nt?"selected":""}>${o.year}</option>`).join("")}
                  </select>
                </label>
              </div>

              <div class="chart-grid">
                <section class="chart-tile">
                  <header class="chart-tile-header">
                    <h4>Essen + Ausgehen Gesamt</h4>
                    <div class="chart-legend">
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-expense"></span>Ist-Kosten</span>
                    </div>
                  </header>
                  <div class="spark-bars">
                    ${Ye.map(o=>{const D=Ge(o.foodAndGoingOutCents,wr);return`
                          <div class="spark-bar" title="${lt(o.month)}: ${E(o.foodAndGoingOutCents)}">
                            <div class="spark-bar-fill" style="height:${D}"></div>
                            <div class="spark-bar-label">${lt(o.month).slice(0,3)}</div>
                          </div>
                        `}).join("")}
                  </div>
                </section>

                <section class="chart-tile">
                  <header class="chart-tile-header">
                    <h4>Essen & Trinken</h4>
                    <div class="chart-legend">
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-expense"></span>Ist-Kosten</span>
                    </div>
                  </header>
                  <div class="spark-bars" style="grid-template-columns: repeat(${Math.max(Ye.length,1)}, minmax(0, 1fr));">
                    ${Ye.map(o=>{const D=Ge(o.foodCents,xr);return`
                          <div class="spark-bar" title="${lt(o.month)}: ${E(o.foodCents)}">
                            <div class="spark-bar-fill" style="height:${D}"></div>
                            <div class="spark-bar-label">${lt(o.month).slice(0,3)}</div>
                          </div>
                        `}).join("")}
                  </div>
                </section>

                <section class="chart-tile">
                  <header class="chart-tile-header">
                    <h4>Ausgehen</h4>
                    <div class="chart-legend">
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-expense"></span>Ist-Kosten</span>
                    </div>
                  </header>
                  <div class="spark-bars" style="grid-template-columns: repeat(${Math.max(Ye.length,1)}, minmax(0, 1fr));">
                    ${Ye.map(o=>{const D=Ge(o.goingOutCents,Zn);return`
                          <div class="spark-bar" title="${lt(o.month)}: ${E(o.goingOutCents)}">
                            <div class="spark-bar-fill" style="height:${D}"></div>
                            <div class="spark-bar-label">${lt(o.month).slice(0,3)}</div>
                          </div>
                        `}).join("")}
                  </div>
                </section>
              </div>
            `:`
              <div class="eval-grid">
                <section class="eval-tile">
                  <header class="eval-tile-header">
                    <h4>Kennzahlen Ã¼ber alle Jahre</h4>
                    <div class="eval-tile-columns"><span>Wert</span><span></span></div>
                  </header>
                  <div class="eval-rows">
                    <div class="eval-row"><div class="eval-label">Einkommen effektiv</div><div class="eval-value">${E(yn)}</div><div class="eval-value"></div></div>
                    <div class="eval-row"><div class="eval-label">Budget gesamt</div><div class="eval-value">${E(qt.totalCents)}</div><div class="eval-value"></div></div>
                    <div class="eval-row"><div class="eval-label">Ausgaben gesamt</div><div class="eval-value">${E(Zt.totalCents)}</div><div class="eval-value"></div></div>
                    <div class="eval-row eval-strong"><div class="eval-label">Saldo (gegen Budget)</div><div class="eval-value ${ke(qr)}">${E(qr)}</div><div class="eval-value"></div></div>
                    <div class="eval-row eval-strong"><div class="eval-label">Saldo (gegen Ist)</div><div class="eval-value ${ke(er)}">${E(er)}</div><div class="eval-value"></div></div>
                  </div>
                </section>
              </div>

              <div class="chart-grid">
                <section class="chart-tile">
                  <header class="chart-tile-header">
                    <h4>Kategorien Ã¼ber alle Jahre</h4>
                    <div class="chart-legend">
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-budget"></span>Budget</span>
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-actual"></span>Ist</span>
                    </div>
                  </header>
                  <div class="bar-chart">
                    ${tr.map(o=>{const D=Ge(o.budgetCents,Lr),te=Ge(o.actualCents,Lr),pe=Fr(o.budgetCents,o.actualCents);return`
                          <div class="bar-row">
                            <div class="bar-label">${o.label}</div>
                            <div class="bar-track" title="Budget: ${E(o.budgetCents)} | Ist: ${E(o.actualCents)}">
                              <div class="bar bar-budget" style="width:${D}"></div>
                              <div class="bar-marker" style="left:${D}" aria-hidden="true"></div>
                              <div class="bar bar-actual ${pe}" style="width:${te}"></div>
                            </div>
                            <div class="bar-meta">
                              <span class="muted">B ${E(o.budgetCents)}</span>
                              <span class="muted">I ${E(o.actualCents)}</span>
                            </div>
                          </div>
                        `}).join("")}
                  </div>
                </section>

                <section class="chart-tile">
                  <header class="chart-tile-header">
                    <h4>Ist-Kosten pro Jahr</h4>
                    <div class="chart-legend">
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-expense"></span>Ist-Kosten</span>
                    </div>
                  </header>
                  <div class="spark-bars" style="grid-template-columns: repeat(${Math.max(un.length,1)}, minmax(0, 1fr));">
                    ${un.map(o=>{const D=Ge(o.actualTotalCents,Rr);return`
                          <div class="spark-bar" title="${o.year}: ${E(o.actualTotalCents)}">
                            <div class="spark-bar-fill" style="height:${D}"></div>
                            <div class="spark-bar-label">${o.year}</div>
                          </div>
                        `}).join("")}
                  </div>
                </section>

                <section class="chart-tile">
                  <header class="chart-tile-header">
                    <h4>Saldo pro Jahr (Budget vs. Ist)</h4>
                    <div class="chart-legend">
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-budget"></span>Budget-Saldo</span>
                      <span class="chart-legend-item"><span class="chart-dot chart-dot-net"></span>Ist-Saldo</span>
                    </div>
                  </header>
                  <div class="bar-chart">
                    ${un.map(o=>{const D=Ge(Math.abs(o.plannedNetCents),jr),te=Ge(Math.abs(o.actualNetCents),jr),pe=o.plannedNetCents<0?"bar-negative":"bar-positive",Ee=o.actualNetCents<0?"bar-negative":"bar-positive";return`
                          <div class="bar-row">
                            <div class="bar-label">${o.year}</div>
                            <div class="bar-track" title="Budget-Saldo: ${E(o.plannedNetCents)} | Ist-Saldo: ${E(o.actualNetCents)}">
                              <div class="bar ${pe}" style="width:${D}; opacity: 0.35;"></div>
                              <div class="bar ${Ee}" style="width:${te}"></div>
                            </div>
                            <div class="bar-meta">
                              <span class="${ke(o.plannedNetCents)}">B ${E(o.plannedNetCents)}</span>
                              <span class="${ke(o.actualNetCents)}">I ${E(o.actualNetCents)}</span>
                            </div>
                          </div>
                        `}).join("")}
                  </div>
                </section>
              </div>

              <table>
                <thead>
                  <tr>
                    <th>Jahr</th>
                    <th>Einkommen effektiv (â¬)</th>
                    <th>Budget gesamt (â¬)</th>
                    <th>Ist-Kosten (â¬)</th>
                    <th>Saldo Budget (â¬)</th>
                    <th>Saldo Ist (â¬)</th>
                  </tr>
                </thead>
                <tbody>
                  ${un.map(o=>`<tr>
                        <td>${o.year}</td>
                        <td>${E(o.effectiveIncomeCents)}</td>
                        <td>${E(o.budgetTotalCents)}</td>
                        <td>${E(o.actualTotalCents)}</td>
                        <td class="${ke(o.plannedNetCents)}">${E(o.plannedNetCents)}</td>
                        <td class="${ke(o.actualNetCents)}">${E(o.actualNetCents)}</td>
                      </tr>`).join("")}
                </tbody>
              </table>
            `}
      </div>
    `,ia=`
      <div class="grid">
        <div class="inline">
          <label>
            Neues Jahr
            <input id="new-year" type="number" min="2000" max="2100" value="${new Date().getFullYear()}" />
          </label>
          <button class="btn btn-primary" id="create-year">Jahr anlegen (12 Monate automatisch)</button>
        </div>
      </div>
    `,Vr=`
      <div class="grid">
        <div class="inline">
          <label>
            Name
            <input id="fixed-template-name" type="text" placeholder="z.B. Miete" value="${bn?.name??""}" />
          </label>
          <label>
            Betrag (â¬)
            <input class="amount-input" id="fixed-template-amount" type="number" min="0" step="0.01" value="${bn?pt(bn.plannedCents):""}" />
          </label>
          <button class="btn btn-primary" id="add-fixed-template">${bn?"Ãnderung speichern":"Vorlage speichern"}</button>
          ${bn?'<button class="btn btn-quiet" id="cancel-fixed-template-edit">Abbrechen</button>':""}
        </div>
        <table>
          <thead>
            <tr><th>Name</th><th>Geplant (â¬)</th><th></th><th></th></tr>
          </thead>
          <tbody>
            ${g.fixedTemplates.map(o=>`<tr>
                    <td>${o.name}</td>
                    <td>${E(o.plannedCents)}</td>
                    <td><button class="btn btn-quiet" data-edit-fixed-template="${o.id}">Bearbeiten</button></td>
                    <td><button class="btn btn-quiet" data-remove-fixed-template="${o.id}">LÃ¶schen</button></td>
                  </tr>`).join("")}
          </tbody>
        </table>
      </div>
    `,nr=g.topModal==="years"?"Jahr hinzufÃ¼gen":g.topModal==="fixed"?"Fixe Kosten (zentral)":g.topModal==="dashboard"?"Dashboard":"",zr=g.topModal==="years"?ia:g.topModal==="fixed"?Vr:g.topModal==="dashboard"?Yr:"";P.innerHTML=`
      <div class="app grid">
        <div class="app-header inline">
          <h1 class="app-title">Haushaltsbuch (HaBu)</h1>
          <div class="header-actions inline">
            ${Xn?`<button class="export-warning export-warning-button" id="open-unexported-change-log" type="button">Ãnderungen noch nicht gesichert (${g.unexportedChangeLog.length})</button>`:""}
            <label>
              Theme
              <select id="theme-select">
                ${wa.map(o=>`<option value="${o}" ${g.theme===o?"selected":""}>${Ia(o)}</option>`).join("")}
              </select>
            </label>
          </div>
        </div>

        <div class="top-shortcuts" role="navigation" aria-label="Schnellzugriff">
          <button class="btn" id="open-years-modal" type="button">Jahr hinzufÃ¼gen</button>
          <button class="btn" id="open-fixed-modal" type="button">Fixe Kosten (zentral)</button>
          <button class="btn" id="open-dashboard-modal" type="button">Dashboard</button>
          <a class="btn" href="#section-food-costs">Essen</a>
          <a class="btn" href="#section-fixed-costs">Fixe</a>
          <a class="btn" href="#section-variable-costs">Variable</a>
          <a class="btn" href="#section-misc-costs">Sonstige</a>
        </div>

        ${g.topModal?`
            <div class="panel-modal-backdrop" id="panel-modal-backdrop" role="dialog" aria-modal="true" aria-label="${nr}">
              <div class="panel-modal card">
                <div class="panel-modal-header inline">
                  <h2>${nr}</h2>
                  <button class="btn btn-quiet" id="panel-modal-close" type="button">SchlieÃen</button>
                </div>
                <div class="panel-modal-body">
                  ${zr}
                </div>
              </div>
            </div>
          `:""}

        ${g.showUnexportedChangeLogModal?`
            <div class="panel-modal-backdrop" id="unexported-change-log-backdrop" role="dialog" aria-modal="true" aria-label="Ungesicherte Ãnderungen">
              <div class="panel-modal card">
                <div class="panel-modal-header inline">
                  <h2>Ungesicherte Ãnderungen</h2>
                  <button class="btn btn-quiet" id="unexported-change-log-close" type="button">SchlieÃen</button>
                </div>
                <div class="panel-modal-body">
                  ${On.length===0?'<p class="muted">Keine ungesicherten Ãnderungen vorhanden.</p>':`<ol class="change-log-list">${On.map(o=>`<li><strong>${new Date(o.timestampIso).toLocaleString("de-DE")}</strong><span>${qn(o.message)}</span></li>`).join("")}</ol>`}
                </div>
              </div>
            </div>
          `:""}

        <section class="card grid">
          <div class="month-year-sticky">
            <h2>Monat: ${l?`${lt(g.selectedMonth)} ${l.year}`:"-"}</h2>
            <div class="inline">
              <label>
                Jahr wÃ¤hlen
                <select id="year-select">
                  ${g.years.map(o=>`<option value="${o.year}" ${o.year===g.selectedYear?"selected":""}>${o.year}</option>`).join("")}
                </select>
              </label>
              <label>
                Monat wÃ¤hlen
                <select id="month-select" ${g.selectedYear?"":"disabled"}>
                  ${Array.from({length:12},(o,D)=>D+1).map(o=>`<option value="${o}" ${o===g.selectedMonth?"selected":""}>${lt(o)}</option>`).join("")}
                </select>
              </label>
            </div>
          </div>

          <article class="card">
            <h3>Auswertung (Monat & Jahr)</h3>
            <div class="chart-grid">
              <section class="chart-tile">
                <header class="chart-tile-header">
                  <h4>Budget vs. Ist (Monat)</h4>
                  <div class="chart-legend">
                    <span class="chart-legend-item"><span class="chart-dot chart-dot-budget"></span>Budget</span>
                    <span class="chart-legend-item"><span class="chart-dot chart-dot-actual"></span>Ist</span>
                  </div>
                </header>
                <div class="budget-canvas-grid">
                  ${Ir.map(o=>`
                        <div class="budget-canvas-card">
                          <canvas
                            class="budget-vs-canvas"
                            data-budget-vs-canvas="1"
                            data-label="${o.label}"
                            data-budget-cents="${o.budgetCents}"
                            data-actual-cents="${o.actualCents}"
                            role="img"
                            aria-label="${o.label}: Budget ${E(o.budgetCents)} â¬, Ist ${E(o.actualCents)} â¬"
                          ></canvas>
                        </div>
                      `).join("")}
                </div>
              </section>

              <section class="chart-tile">
                <header class="chart-tile-header">
                  <h4>Einkommen / Ausgaben / Netto (Monat)</h4>
                  <div class="chart-legend">
                    <span class="chart-legend-item"><span class="chart-dot chart-dot-income"></span>Einkommen</span>
                    <span class="chart-legend-item"><span class="chart-dot chart-dot-expense"></span>Ausgaben</span>
                    <span class="chart-legend-item"><span class="chart-dot chart-dot-net"></span>Netto</span>
                  </div>
                </header>
                <div class="bar-chart">
                  ${Pn.map(o=>{const D=Ge(Math.abs(o.valueCents),Hn),te=o.valueCents>=0?"+":"",pe=o.label==="Netto"?o.valueCents<0?"danger":o.valueCents>0?"budget-under":"":"";return`
                        <div class="bar-row">
                          <div class="bar-label">${o.label}</div>
                          <div class="bar-track" title="${E(o.valueCents)}">
                            <div class="bar ${o.className}" style="width:${D}"></div>
                          </div>
                          <div class="bar-meta"><span class="${pe}">${te}${E(o.valueCents)}</span></div>
                        </div>
                      `}).join("")}
                </div>
              </section>

              <section class="chart-tile">
                <header class="chart-tile-header">
                  <h4>Jahresverlauf Gesamtausgaben</h4>
                  <div class="chart-legend">
                    <span class="chart-legend-item"><span class="chart-dot chart-dot-expense"></span>Ausgaben</span>
                  </div>
                </header>
                ${l?`
                    <div class="spark-bars" aria-label="Jahresverlauf Gesamtausgaben">
                      ${T.map(o=>{const D=Ge(o.summary.totalCents,pr);return`
                            <div class="spark-bar" title="${lt(o.month)}: ${E(o.summary.totalCents)}">
                              <div class="spark-bar-fill" style="height:${D}"></div>
                              <div class="spark-bar-label">${lt(o.month).slice(0,3)}</div>
                            </div>
                          `}).join("")}
                    </div>
                  `:'<p class="muted">Kein Jahr gewÃ¤hlt.</p>'}
              </section>
            </div>
            <div class="eval-grid">
              <section class="eval-tile">
                <header class="eval-tile-header">
                  <h4>Einkommen</h4>
                  <div class="eval-tile-columns"><span>Monat</span><span>Jahr</span></div>
                </header>
                <div class="eval-rows">
                  <div class="eval-row">
                    <div class="eval-label">Einkommen (erfasst)</div>
                    <div class="eval-value">${E(fe)}</div>
                    <div class="eval-value">${E(Le)}</div>
                  </div>
                  <div class="eval-row">
                    <div class="eval-label">Ãbernahme aus Vormonat</div>
                    <div class="eval-value ${Te}">${N?E(qe):"-"}</div>
                    <div class="eval-value ${Pt}">${l?E(wt):"-"}</div>
                  </div>
                  <div class="eval-row eval-strong">
                    <div class="eval-label">Einkommen gesamt</div>
                    <div class="eval-value">${E(Ae)}</div>
                    <div class="eval-value">${E(De)}</div>
                  </div>
                </div>
              </section>

              <section class="eval-tile">
                <header class="eval-tile-header">
                  <h4>Budgets (geplant)</h4>
                  <div class="eval-tile-columns"><span>Monat</span><span>Jahr</span></div>
                </header>
                <div class="eval-rows">
                  <div class="eval-row">
                    <div class="eval-label">Essen</div>
                    <div class="eval-value">${E(L)}</div>
                    <div class="eval-value">${E(Z)}</div>
                  </div>
                  <div class="eval-row">
                    <div class="eval-label">Ausgehen</div>
                    <div class="eval-value">${E(j)}</div>
                    <div class="eval-value">${E(W)}</div>
                  </div>
                  <div class="eval-row">
                    <div class="eval-label">Fixkosten</div>
                    <div class="eval-value">${E(F)}</div>
                    <div class="eval-value">${E(Pe)}</div>
                  </div>
                  <div class="eval-row">
                    <div class="eval-label">Variable</div>
                    <div class="eval-value">${E(X)}</div>
                    <div class="eval-value">${E(tt)}</div>
                  </div>
                  <div class="eval-row">
                    <div class="eval-label">Sonstige</div>
                    <div class="eval-value">${E(U)}</div>
                    <div class="eval-value">${E(Fe)}</div>
                  </div>
                  <div class="eval-row eval-strong">
                    <div class="eval-label">Budgets gesamt</div>
                    <div class="eval-value">${E(ne)}</div>
                    <div class="eval-value">${E(ot)}</div>
                  </div>
                </div>
              </section>

              <section class="eval-tile">
                <header class="eval-tile-header">
                  <h4>Realkosten (Ist)</h4>
                  <div class="eval-tile-columns"><span>Monat</span><span>Jahr</span></div>
                </header>
                <div class="eval-rows">
                  <div class="eval-row">
                    <div class="eval-label">Essen</div>
                    <div class="eval-value ${ra}">${E(y.foodCents)}</div>
                    <div class="eval-value">${E(w.foodCents)}</div>
                  </div>
                  <div class="eval-row">
                    <div class="eval-label">Ausgehen</div>
                    <div class="eval-value ${aa}">${E(y.goingOutCents)}</div>
                    <div class="eval-value">${E(w.goingOutCents)}</div>
                  </div>
                  <div class="eval-row">
                    <div class="eval-label">Fixkosten</div>
                    <div class="eval-value ${na}">${E(y.fixedCents)}</div>
                    <div class="eval-value">${E(w.fixedCents)}</div>
                  </div>
                  <div class="eval-row">
                    <div class="eval-label">Variable</div>
                    <div class="eval-value ${vr}">${E(y.variableCents)}</div>
                    <div class="eval-value">${E(w.variableCents)}</div>
                  </div>
                  <div class="eval-row">
                    <div class="eval-label">Sonstige</div>
                    <div class="eval-value ${mr}">${E(y.miscCents)}</div>
                    <div class="eval-value">${E(w.miscCents)}</div>
                  </div>
                  <div class="eval-row eval-strong">
                    <div class="eval-label">Gesamt</div>
                    <div class="eval-value">${E(y.totalCents)}</div>
                    <div class="eval-value">${E(w.totalCents)}</div>
                  </div>
                </div>
              </section>

              <section class="eval-tile">
                <header class="eval-tile-header">
                  <h4>Salden</h4>
                  <div class="eval-tile-columns"><span>Monat</span><span>Jahr</span></div>
                </header>
                <div class="eval-rows">
                  <div class="eval-row eval-strong">
                    <div class="eval-label">Budget Ã¼brig</div>
                    <div class="eval-value ${ke(Ft)}">${E(Ft)}</div>
                    <div class="eval-value ${ke(Jt)}">${E(Jt)}</div>
                  </div>
                  <div class="eval-row eval-strong">
                    <div class="eval-label">Einkommen - Budgets gesamt</div>
                    <div class="eval-value ${ke(Wn)}">${E(Wn)}</div>
                    <div class="eval-value ${ke(Ue)}">${E(Ue)}</div>
                  </div>
                  <div class="eval-row eval-strong">
                    <div class="eval-label">Einnahmen - echte Ausgaben</div>
                    <div class="eval-value ${ee}">${E(ct)}</div>
                    <div class="eval-value ${ye}">${E(rt)}</div>
                  </div>
                  <div class="eval-row eval-strong">
                    <div class="eval-label">Gehalt - Ausgaben</div>
                    <div class="eval-value ${ke(nt)}">${E(nt)}</div>
                    <div class="eval-value ${ke(xt)}">${E(xt)}</div>
                  </div>
                  <div class="eval-row eval-strong">
                    <div class="eval-label">Gehalt vs. Ausgaben (%)</div>
                    <div class="eval-value ${Ht}">${it}</div>
                    <div class="eval-value ${Jn}">${ft}</div>
                  </div>
                </div>
              </section>
            </div>

            <h3>Jahresvergleich (Monat zu Monat)</h3>
            <table>
              <thead>
                <tr>
                  <th>Monat</th>
                  <th>Essen (â¬)</th>
                  <th>Ausgehen (â¬)</th>
                  <th>Fixe Kosten (â¬)</th>
                  <th>Variable (â¬)</th>
                  <th>Sonstige (â¬)</th>
                  <th>Gesamt (â¬)</th>
                  <th>Budget gesamt (â¬)</th>
                  <th>Kalkulierter Saldo (â¬)</th>
                </tr>
              </thead>
              <tbody>
                ${T.map((o,D,te)=>{const pe=l?Ne.get(ue(l.year,o.month)):void 0,Ee=pe?.plannedBudgetCents??0,$e=pe?.netCents??0,Ce=$e<0?"danger":$e>0?"budget-under":"",Je=te[D-1],Lt=Je?.summary.foodCents??null,Tn=Je?.summary.goingOutCents??null,Cn=Je?.summary.fixedCents??null,Dn=Je?.summary.variableCents??null,Ot=Je?.summary.miscCents??null,wn=Je?.summary.totalCents??null,cn=l&&Je?Ne.get(ue(l.year,Je.month))?.plannedBudgetCents??0:null,jt=Lt===null?null:o.summary.foodCents-Lt,$r=Tn===null?null:o.summary.goingOutCents-Tn,e=Cn===null?null:o.summary.fixedCents-Cn,t=Dn===null?null:o.summary.variableCents-Dn,n=Ot===null?null:o.summary.miscCents-Ot,r=wn===null?null:o.summary.totalCents-wn,a=cn===null?null:Ee-cn,s=f=>f===null?"muted":f>0?"danger":f<0?"budget-under":"muted",i=f=>f===null?"muted":f>0?"danger":f<0?"budget-under":"muted",u=f=>f===null?"(Î -)":`(Î ${f>0?"+":""}${E(f)})`,h=l&&Je?Ne.get(ue(l.year,Je.month))?.netCents??0:null,x=h===null?null:$e-h,p=x===null?"(Î -)":`(Î ${x>0?"+":""}${E(x)})`,d=x===null?"muted":x<0?"danger":x>0?"budget-under":"muted";return`<tr>
                  <td>${lt(o.month)}</td>
                  <td>${E(o.summary.foodCents)} <span class="${s(jt)}">${u(jt)}</span></td>
                  <td>${E(o.summary.goingOutCents)} <span class="${s($r)}">${u($r)}</span></td>
                  <td>${E(o.summary.fixedCents)} <span class="${s(e)}">${u(e)}</span></td>
                  <td>${E(o.summary.variableCents)} <span class="${s(t)}">${u(t)}</span></td>
                  <td>${E(o.summary.miscCents)} <span class="${s(n)}">${u(n)}</span></td>
                  <td>${E(o.summary.totalCents)} <span class="${s(r)}">${u(r)}</span></td>
                  <td>${E(Ee)} <span class="${i(a)}">${u(a)}</span></td>
                  <td class="${Ce}">${E($e)} <span class="${d}">${p}</span></td>
                </tr>`}).join("")}
              </tbody>
            </table>
          </article>

          <article class="card">
            <h3>Einkommen (Monat)</h3>
            <div class="inline">
              <label>
                Beschreibung
                <input id="income-description" type="text" placeholder="z.B. Gehalt" ${c?"":"disabled"} />
              </label>
              <label>
                Herkunft
                <select id="income-source" ${c?"":"disabled"}>
                  <option value="salary">Gehalt</option>
                  <option value="fresh">Neues Einkommen</option>
                  <option value="balance">Bestandsguthaben</option>
                </select>
              </label>
              <label>
                Betrag (â¬)
                <input class="amount-input" id="income-amount" type="number" min="0" step="0.01" placeholder="0.00" ${c?"":"disabled"} />
              </label>
              <button class="btn btn-primary" id="add-income" ${c?"":"disabled"}>Einkommen erfassen</button>
                <button class="btn" id="add-income-recurring" ${c?"":"disabled"}>Wiederkehrend erfassen</button>
            </div>
            <table>
              <thead>
                <tr><th>Beschreibung</th><th>Herkunft</th><th>Betrag (â¬)</th><th></th></tr>
              </thead>
              <tbody>
                ${c?`<tr>
                    <td>Ãbernahme aus Vormonat</td>
                    <td>-</td>
                    <td class="${Te}">
                      <input class="amount-input" id="carryover-override" type="number" step="0.01" value="${pt(qe)}" />
                    </td>
                    <td>-</td>
                  </tr>${c.incomes.map(o=>`<tr>
                    <td>${o.description}</td>
                    <td>
                      <select data-income-source="${o.id}">
                        <option value="" ${o.incomeSource?"":"selected"}>Nicht zugeordnet</option>
                        <option value="salary" ${o.incomeSource==="salary"?"selected":""}>Gehalt</option>
                        <option value="fresh" ${o.incomeSource==="fresh"?"selected":""}>Neues Einkommen</option>
                        <option value="balance" ${o.incomeSource==="balance"?"selected":""}>Bestandsguthaben</option>
                      </select>
                    </td>
                    <td>${E(o.amountCents)}</td>
                    <td><button class="btn btn-quiet" data-remove-income="${o.id}">LÃ¶schen</button></td>
                  </tr>`).join("")}`:""}
              </tbody>
            </table>
            <div class="column-overview income-flow-overview">
              <div class="column-overview-grid">
                <div class="column-overview-row">
                  <span>Erfasstes Einkommen</span>
                  <strong>${E(fe)} â¬</strong>
                </div>
                <div class="column-overview-row ${Te}">
                  <span>Ãbernahme Vormonat</span>
                  <strong>${c?`${E(qe)} â¬`:"-"}</strong>
                </div>
                <div class="column-overview-row">
                  <span>Einkommen gesamt (inkl. Ãbernahme)</span>
                  <strong>${E(Ae)} â¬</strong>
                </div>
                <div class="column-overview-row ${dt}">
                  <span>Monatsergebnis (Ãbernahme Folgemonat)</span>
                  <strong>${E(It)} â¬</strong>
                </div>
              </div>
            </div>
          </article>

          <div class="grid grid-4">
            <article class="card" id="section-food-costs">
              <h3>1) Essen, Trinken und Ausgehen (Tage)</h3>
              <div class="column-overview-grid">
                ${vn(L,y.foodCents)}
                ${vn(j,y.goingOutCents)}
                <div class="column-overview">
                  <div class="column-overview-row">
                    <span>Gesamt (Essen + Ausgehen)</span>
                    <strong>${E(be)} â¬</strong>
                  </div>
                  <div class="column-overview-row">
                    <span>Gesamtausgaben</span>
                    <strong>${E(S)} â¬</strong>
                  </div>
                  <div class="column-overview-row ${at}">
                    <span>Diff</span>
                    <strong>${E(A)} â¬</strong>
                  </div>
                </div>
              </div>
              <div class="inline">
                <label>
                  Budget Essen (â¬)
                  <input class="amount-input" id="food-budget" type="number" min="0" step="0.01" value="${pt(L)}" ${c?"":"disabled"} />
                </label>
                <label>
                  Budget Ausgehen (â¬)
                  <input class="amount-input" id="going-out-budget" type="number" min="0" step="0.01" value="${pt(j)}" ${c?"":"disabled"} />
                </label>
              </div>
              <table class="daily-table">
                <thead>
                  <tr><th>Datum</th><th>Essen (â¬)</th><th>Ausgehen (â¬)</th></tr>
                </thead>
                <tbody>
                  ${c?c.days.map(o=>{const D=o.foodCents>0,te=o.goingOutCents>0,pe=`${o.isoDate===b?"today-row":""} ${D||te?"day-has-entry":""}`.trim(),Ee=`amount-input ${D?"day-input-has-value":""}`.trim(),$e=`amount-input ${te?"day-input-has-value":""}`.trim();return`<tr class="${pe}">
                      <td>${new Date(o.isoDate).toLocaleDateString("de-DE",{weekday:"short",year:"numeric",month:"2-digit",day:"2-digit"})}</td>
                      <td><input class="${Ee}" data-day-food="${o.isoDate}" type="number" min="0" step="0.01" value="${pt(o.foodCents)}" /></td>
                      <td><input class="${$e}" data-day-going="${o.isoDate}" type="number" min="0" step="0.01" value="${pt(o.goingOutCents)}" /></td>
                    </tr>`}).join(""):""}
                </tbody>
              </table>
            </article>

            <article class="card" id="section-fixed-costs">
              <h3>2) Fixe Kosten (Monatssnapshot)</h3>
              ${vn(F,y.fixedCents)}
              <div class="inline">
                <label>
                  Budget Fixkosten (â¬)
                  <input class="amount-input" id="fixed-budget" type="number" min="0" step="0.01" value="${pt(F)}" ${c?"":"disabled"} />
                </label>
              </div>
              <div class="inline">
                <label>
                  Neue Position
                  <input id="fixed-cost-name" type="text" placeholder="z.B. Miete" ${c?"":"disabled"} />
                </label>
                <label>
                  Positionsbudget (â¬)
                  <input class="amount-input" id="fixed-cost-budget" type="number" min="0" step="0.01" placeholder="0.00" ${c?"":"disabled"} />
                </label>
                <button class="btn btn-primary" id="add-fixed-cost" ${c?"":"disabled"}>Position anlegen</button>
              </div>
              <table>
                <thead>
                  <tr><th>Name</th><th>Budget (â¬)</th><th>Ist (â¬)</th><th>Abweichung (â¬)</th><th></th></tr>
                </thead>
                <tbody>
                ${c?c.fixedCosts.map(o=>`<tr>
                    <td>${o.name}</td>
                    <td><input class="amount-input" data-fixed-planned="${o.id}" type="number" min="0" step="0.01" value="${pt(o.plannedCents)}" /></td>
                    <td class="${et(o.actualCents,o.plannedCents)}"><input class="amount-input" data-fixed-actual="${o.id}" type="number" min="0" step="0.01" value="${pt(o.actualCents)}" /></td>
                    <td class="${et(o.actualCents,o.plannedCents)}">${E(o.actualCents-o.plannedCents)}</td>
                    <td><button class="btn btn-quiet" data-remove-fixed="${o.id}">LÃ¶schen</button></td>
                  </tr>`).join(""):""}
                </tbody>
              </table>
            </article>

            <article class="card" id="section-variable-costs">
              <h3>3) Variable Kosten (>= 30â¬)</h3>
              ${vn(X,y.variableCents)}
              <div class="inline">
                <label>
                  Planbudget Variable (â¬)
                  <input class="amount-input" id="variable-budget" type="number" min="0" step="0.01" value="${pt(X)}" ${c?"":"disabled"} />
                </label>
              </div>
              <div class="inline">
                <label>
                  Neue Position
                  <input id="variable-position-name" type="text" placeholder="z.B. Urlaub" ${c?"":"disabled"} />
                </label>
                <label>
                  Positionsbudget (â¬)
                  <input class="amount-input" id="variable-position-budget" type="number" min="0" step="0.01" placeholder="500.00" ${c?"":"disabled"} />
                </label>
                <button class="btn btn-primary" id="add-variable-position" ${c?"":"disabled"}>Position anlegen</button>
                <button class="btn" id="add-variable-position-recurring" ${c?"":"disabled"}>Wiederkehrend erfassen</button>
              </div>
              <table>
                <thead>
                  <tr><th>Position</th><th>Budget (â¬)</th><th>Ist (â¬)</th><th>Abweichung (â¬)</th><th></th></tr>
                </thead>
                <tbody>
                ${c?c.variablePositions.map(o=>`<tr>
                    <td>${o.name}</td>
                    <td><input class="amount-input" data-variable-position-budget="${o.id}" type="number" min="0" step="0.01" value="${pt(o.budgetCents)}" /></td>
                    <td class="${et(o.actualCents,o.budgetCents)}"><input class="amount-input" data-variable-position-actual="${o.id}" type="number" min="0" step="0.01" value="${pt(o.actualCents)}" /></td>
                    <td class="${et(o.actualCents,o.budgetCents)}">${E(o.actualCents-o.budgetCents)}</td>
                    <td>
                      <button class="btn" data-move-variable-position-next="${o.id}">NÃ¤chster Monat</button>
                      <button class="btn btn-quiet" data-remove-variable-position="${o.id}">LÃ¶schen</button>
                    </td>
                  </tr>`).join(""):""}
                </tbody>
              </table>
            </article>

            <article class="card" id="section-misc-costs">
              <h3>4) Sonstige (unter 30â¬)</h3>
              ${vn(U,y.miscCents)}
              <div class="inline">
                <label>
                  Planbudget Sonstige (â¬)
                  <input class="amount-input" id="misc-budget" type="number" min="0" step="0.01" value="${pt(U)}" ${c?"":"disabled"} />
                </label>
              </div>
              <div class="inline">
                <label>
                  Neue Position
                  <input id="misc-description" type="text" placeholder="z.B. Kleinkram" ${c?"":"disabled"} />
                </label>
                <label>
                  Betrag (â¬)
                  <input class="amount-input" id="misc-amount" type="number" min="0" step="0.01" placeholder="0.00" ${c?"":"disabled"} />
                </label>
                <button class="btn btn-primary" id="add-misc" ${c?"":"disabled"}>Position anlegen</button>
                <button class="btn" id="add-misc-recurring" ${c?"":"disabled"}>Wiederkehrend erfassen</button>
              </div>
              <table>
                <thead>
                  <tr><th>Beschreibung</th><th>Betrag (â¬)</th><th></th></tr>
                </thead>
                <tbody>
                ${c?c.miscCosts.map(o=>`<tr>
                    <td>${o.description}</td>
                    <td>${E(o.amountCents)}</td>
                    <td><button class="btn btn-quiet" data-remove-misc="${o.id}">LÃ¶schen</button></td>
                  </tr>`).join(""):""}
                </tbody>
              </table>
            </article>
          </div>
        </section>

        <section class="card grid">
          <h2>Lokale Datensicherung</h2>
          <div class="inline">
            <button class="btn btn-primary" id="backup-export">Backup exportieren (JSON)</button>
            <label>
              Backup importieren (JSON)
              <input id="backup-import" type="file" accept="application/json" />
            </label>
          </div>
          <p class="muted">Letztes verwendetes Backup: ${Qn}</p>
          <p class="muted">Die Daten bleiben lokal im Browser (IndexedDB). ZusÃ¤tzlich kannst du Backups als Datei sichern und spÃ¤ter importieren.</p>
        </section>

        <button
          id="scroll-up-btn"
          class="scroll-up-btn"
          type="button"
          aria-label="Nach oben scrollen"
          title="Nach oben"
        >
          â
        </button>
      </div>
    `,document.body.classList.toggle("panel-modal-open",!!(g.topModal||g.showUnexportedChangeLogModal)),hr(),Ze(),dn()}function hr(){const l=P.querySelector("#theme-select"),c=P.querySelector("#open-years-modal"),b=P.querySelector("#open-fixed-modal"),y=P.querySelector("#open-dashboard-modal"),w=P.querySelector("#panel-modal-close"),T=P.querySelector("#panel-modal-backdrop"),L=P.querySelector("#open-unexported-change-log"),j=P.querySelector("#unexported-change-log-close"),F=P.querySelector("#unexported-change-log-backdrop"),X=P.querySelector("#new-year"),U=P.querySelector("#create-year"),Z=P.querySelector("#year-select"),W=P.querySelector("#month-select");l?.addEventListener("change",()=>{const S=l.value;ba(S)&&Vt(S)}),c?.addEventListener("click",()=>{vt("years")}),b?.addEventListener("click",()=>{vt("fixed")}),y?.addEventListener("click",()=>{vt("dashboard")}),L?.addEventListener("click",()=>{Wr()}),j?.addEventListener("click",()=>{rr()}),F?.addEventListener("click",S=>{S.target===F&&rr()}),P.querySelectorAll("[data-dashboard-tab]").forEach(S=>{S.addEventListener("click",()=>{const A=S.dataset.dashboardTab;A!=="year"&&A!=="food"&&A!=="all"||(g.dashboardTab=A,se())})});const Pe=P.querySelector("#dashboard-year-select");Pe?.addEventListener("change",()=>{const S=Number.parseInt(Pe.value,10);Number.isInteger(S)&&(g.dashboardYear=S,se())}),w?.addEventListener("click",()=>{kt()}),T?.addEventListener("click",S=>{S.target===T&&kt()}),g.topModal&&window.setTimeout(()=>{w?.focus()},0),g.showUnexportedChangeLogModal&&window.setTimeout(()=>{j?.focus()},0),U?.addEventListener("click",async()=>{const S=Number.parseInt(X?.value??"",10);if(!Number.isInteger(S)){alert("Bitte gÃ¼ltiges Jahr eingeben.");return}await _n(S)}),Z?.addEventListener("change",()=>{g.selectedYear=Number.parseInt(Z.value,10),g.selectedMonth=Yt(),se()}),W?.addEventListener("change",()=>{g.selectedMonth=Number.parseInt(W.value,10),se()});const tt=P.querySelector("#fixed-template-name"),Fe=P.querySelector("#fixed-template-amount"),fe=P.querySelector("#add-fixed-template"),bt=P.querySelector("#cancel-fixed-template-edit");fe?.addEventListener("click",async()=>{const S=tt?.value??"",A=Me(Fe?.value??"0");await Yn(S,A),tt&&(tt.value=""),Fe&&(Fe.value="")}),bt?.addEventListener("click",()=>{cr()}),P.querySelectorAll("[data-edit-fixed-template]").forEach(S=>{S.addEventListener("click",()=>{const A=S.dataset.editFixedTemplate;A&&R(A)})}),P.querySelectorAll("[data-remove-fixed-template]").forEach(S=>{S.addEventListener("click",async()=>{const A=S.dataset.removeFixedTemplate;A&&await Mr(A)})}),P.querySelectorAll("[data-day-food]").forEach(S=>{S.addEventListener("click",A=>{A.preventDefault(),S.blur(),ut(S)}),S.addEventListener("change",async()=>{const A=S.dataset.dayFood;A&&await Vn(A,"foodCents",Me(S.value))})}),P.querySelectorAll("[data-day-going]").forEach(S=>{S.addEventListener("click",A=>{A.preventDefault(),S.blur(),ut(S)}),S.addEventListener("change",async()=>{const A=S.dataset.dayGoing;A&&await Vn(A,"goingOutCents",Me(S.value))})}),P.querySelectorAll("[data-fixed-actual]").forEach(S=>{S.addEventListener("click",A=>{A.preventDefault(),S.blur(),ut(S)}),S.addEventListener("change",async()=>{const A=S.dataset.fixedActual;A&&await Ar(A,Me(S.value))})}),P.querySelectorAll("[data-fixed-planned]").forEach(S=>{S.addEventListener("click",A=>{A.preventDefault(),S.blur(),ut(S)}),S.addEventListener("change",async()=>{const A=S.dataset.fixedPlanned;A&&await dr(A,Me(S.value))})});const Ne=P.querySelector("#fixed-budget");Ne?.addEventListener("click",S=>{S.preventDefault(),Ne.blur(),ut(Ne)}),Ne?.addEventListener("change",async()=>{await mn(Me(Ne.value))});const ze=P.querySelector("#food-budget");ze?.addEventListener("click",S=>{S.preventDefault(),ze.blur(),ut(ze)}),ze?.addEventListener("change",async()=>{await gn(Me(ze.value))});const le=P.querySelector("#going-out-budget");le?.addEventListener("click",S=>{S.preventDefault(),le.blur(),ut(le)}),le?.addEventListener("change",async()=>{await fr(Me(le.value))});const qe=P.querySelector("#misc-budget");qe?.addEventListener("click",S=>{S.preventDefault(),qe.blur(),ut(qe)}),qe?.addEventListener("change",async()=>{await zn(Me(qe.value))});const N=P.querySelector("#variable-budget");N?.addEventListener("click",S=>{S.preventDefault(),N.blur(),ut(N)}),N?.addEventListener("change",async()=>{await we(Me(N.value))});const Ae=P.querySelector("#variable-position-name"),yt=P.querySelector("#variable-position-budget"),It=P.querySelector("#add-variable-position"),ct=P.querySelector("#add-variable-position-recurring"),nt=P.querySelector("#misc-description"),it=P.querySelector("#misc-amount"),Te=P.querySelector("#add-misc"),dt=P.querySelector("#add-misc-recurring"),ee=P.querySelector("#income-description"),Le=P.querySelector("#income-source"),je=P.querySelector("#income-amount"),wt=P.querySelector("#add-income"),De=P.querySelector("#add-income-recurring"),rt=P.querySelector("#fixed-cost-name"),xt=P.querySelector("#fixed-cost-budget"),ft=P.querySelector("#add-fixed-cost"),Pt=P.querySelector("#carryover-override");Pt?.addEventListener("click",S=>{S.preventDefault(),Pt.blur(),ut(Pt)}),Pt?.addEventListener("change",async()=>{const S=Pt.value;if(!S.trim()){await Tr(null);return}await Tr(Me(S))}),ft?.addEventListener("click",async()=>{const S=Me(xt?.value??"0");await Qr(rt?.value??"",S),rt&&(rt.value=""),xt&&(xt.value="")}),It?.addEventListener("click",async()=>{const S=Me(yt?.value??"0");await Sn(Ae?.value??"",S,!1),Ae&&(Ae.value=""),yt&&(yt.value="")}),ct?.addEventListener("click",async()=>{const S=Me(yt?.value??"0");await Sn(Ae?.value??"",S,!0),Ae&&(Ae.value=""),yt&&(yt.value="")}),Te?.addEventListener("click",async()=>{const S=Me(it?.value??"0");await rn(nt?.value??"",S,!1),nt&&(nt.value=""),it&&(it.value="")}),dt?.addEventListener("click",async()=>{const S=Me(it?.value??"0");await rn(nt?.value??"",S,!0),nt&&(nt.value=""),it&&(it.value="")}),wt?.addEventListener("click",async()=>{const S=Me(je?.value??"0"),A=Le?.value,at=A==="balance"||A==="fresh"||A==="salary"?A:void 0;await Bn(ee?.value??"",S,at,!1),ee&&(ee.value=""),je&&(je.value=""),Le&&(Le.value="salary")}),De?.addEventListener("click",async()=>{const S=Me(je?.value??"0"),A=Le?.value,at=A==="balance"||A==="fresh"||A==="salary"?A:void 0;await Bn(ee?.value??"",S,at,!0),ee&&(ee.value=""),je&&(je.value=""),Le&&(Le.value="salary")}),P.querySelectorAll("[data-income-source]").forEach(S=>{S.addEventListener("change",async()=>{const A=S.dataset.incomeSource;if(!A)return;const at=S.value;await ta(A,at==="balance"||at==="fresh"||at==="salary"?at:void 0)})}),P.querySelectorAll("[data-variable-position-budget]").forEach(S=>{S.addEventListener("click",A=>{A.preventDefault(),S.blur(),ut(S)}),S.addEventListener("change",async()=>{const A=S.dataset.variablePositionBudget;A&&await Gn(A,Me(S.value))})}),P.querySelectorAll("[data-variable-position-actual]").forEach(S=>{S.addEventListener("click",A=>{A.preventDefault(),S.blur(),ut(S)}),S.addEventListener("change",async()=>{const A=S.dataset.variablePositionActual;A&&await Un(A,Me(S.value))})}),P.querySelectorAll("[data-remove-variable-position]").forEach(S=>{S.addEventListener("click",async()=>{const A=S.dataset.removeVariablePosition;A&&await ea(A)})}),P.querySelectorAll("[data-move-variable-position-next]").forEach(S=>{S.addEventListener("click",async()=>{const A=S.dataset.moveVariablePositionNext;A&&await Ut(A)})}),P.querySelectorAll("[data-remove-fixed]").forEach(S=>{S.addEventListener("click",async()=>{const A=S.dataset.removeFixed;A&&await Zr(A)})}),P.querySelectorAll("[data-remove-income]").forEach(S=>{S.addEventListener("click",async()=>{const A=S.dataset.removeIncome;A&&await Wt(A)})}),P.querySelectorAll("[data-remove-misc]").forEach(S=>{S.addEventListener("click",async()=>{const A=S.dataset.removeMisc;A&&await Gt(A)})});const ye=P.querySelector("#backup-export"),ne=P.querySelector("#backup-import");P.querySelector("#scroll-up-btn")?.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}),ye?.addEventListener("click",async()=>{await Dr()}),ne?.addEventListener("change",async()=>{const S=ne.files?.[0];if(S){try{await an(S)}catch(A){console.error("Backup-Import fehlgeschlagen",A),xe("Backup konnte nicht importiert werden.","error")}ne.value=""}})}return{init:ir}}const Na="modulepreload",Ka=function(P){return"/habu26/"+P},ya={},qa=function(g,Se,G){let ce=Promise.resolve();if(Se&&Se.length>0){let He=function(Xe){return Promise.all(Xe.map(ie=>Promise.resolve(ie).then(Qe=>({status:"fulfilled",value:Qe}),Qe=>({status:"rejected",reason:Qe}))))};var me=He;document.getElementsByTagName("link");const ae=document.querySelector("meta[property=csp-nonce]"),de=ae?.nonce||ae?.getAttribute("nonce");ce=He(Se.map(Xe=>{if(Xe=Ka(Xe),Xe in ya)return;ya[Xe]=!0;const ie=Xe.endsWith(".css"),Qe=ie?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Xe}"]${Qe}`))return;const Ze=document.createElement("link");if(Ze.rel=ie?"stylesheet":Na,ie||(Ze.as="script"),Ze.crossOrigin="",Ze.href=Xe,de&&Ze.setAttribute("nonce",de),document.head.appendChild(Ze),ie)return new Promise((vt,kt)=>{Ze.addEventListener("load",vt),Ze.addEventListener("error",()=>kt(new Error(`Unable to preload CSS for ${Xe}`)))})}))}function re(ae){const de=new Event("vite:preloadError",{cancelable:!0});if(de.payload=ae,window.dispatchEvent(de),!de.defaultPrevented)throw ae}return ce.then(ae=>{for(const de of ae||[])de.status==="rejected"&&re(de.reason);return g().catch(re)})};function La(P={}){const{immediate:g=!1,onNeedRefresh:Se,onOfflineReady:G,onRegistered:ce,onRegisteredSW:re,onRegisterError:me}=P;let ae,de;const He=async(ie=!0)=>{await de};async function Xe(){if("serviceWorker"in navigator){if(ae=await qa(async()=>{const{Workbox:ie}=await import("./workbox-window.prod.es5-BIl4cyR9.js");return{Workbox:ie}},[]).then(({Workbox:ie})=>new ie("/habu26/sw.js",{scope:"/habu26/",type:"classic"})).catch(ie=>{me?.(ie)}),!ae)return;ae.addEventListener("activated",ie=>{(ie.isUpdate||ie.isExternal)&&window.location.reload()}),ae.addEventListener("installed",ie=>{ie.isUpdate||G?.()}),ae.register({immediate:g}).then(ie=>{re?re("/habu26/sw.js",ie):ce?.(ie)}).catch(ie=>{me?.(ie)})}}return de=Xe(),He}function ja(){La({immediate:!0})}const xa=document.getElementById("app");if(!xa)throw new Error("App-Container nicht gefunden.");Fa(xa).init();ja();
